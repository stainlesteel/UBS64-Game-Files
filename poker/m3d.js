m3dv="0.91";hst="local";rndr=2;mnButtonOver=0;
m3dcache={i:{chlang:!1,loadedall:!1,initApp:!1,initWnd:!1,loadedLangCore:!1,passport:!0,mouse:0,mousedn:!1,menu:"far",canverr:0,vw:860,vh:650,vw2:430,vh2:325,startPlaneTv:0,landobjects:1,stats:0,shop:!1,book:!1,vdist:700,vdist1:50,vdist2:3E3,lightD:!1,lightH:!1,idb:!1,blockinfo:!1,lng:"en",lngs:["","en","ru"],thm:"mat",thms:["","metal","neon","matrix"],camerafOn:!1,loggingon:!1,init3Dstart:!1,init3Dfail:!1,init3D:!1,rndriih:-1,ads:{w:0,h:0,side:""},antialias:!0,shadows:!0,locationStd:!1,gameLoadedNew:function(){return{landscapef:!1,
landscape:0,landscapeTotal:-1,textures:0,texturesTotal:-1,wnd:!1,app:!1,perc:0}},stdres:{langs:["en","ru"],images_core:["i/mat_mstd_","i/mat_v3d-2_"],images_menu:["i/m3dmenu_"],libs_std:[["css/style.css","","core_css"],["lng/lng_","m3dcache.d.lngc","core_lng"]]},parseConfig:function(){m3dcache.setup=m3dconf.setup;"undefined"==typeof m3dcache.setup.aspect?m3dcache.setup.aspect={scale:1,maximize:!1}:("undefined"==typeof m3dcache.setup.aspect.scale&&(m3dcache.setup.aspect.scale=1),"undefined"==typeof m3dcache.setup.aspect.maximize&&
(m3dcache.setup.aspect.maximize=!1));document.body.style.webkitTransform=document.body.style.msTransform=document.body.style.transform="scale("+m3dcache.setup.aspect.scale+")";var a=m3dcache.setup.hosts;m3dcache.i.aphost=a.aphost;m3dcache.i.appath=a.appath;m3dcache.i.corehost=a.corehost;m3dcache.i.corepath=a.corepath;"undefined"!==typeof m3dcache.setup.locationStd?1==m3dcache.setup.locationStd&&(m3dcache.i.locationStd=!0):m3dcache.i.locationStd=!1;m3dcache.i.loadLibs(m3dcache.setup.libs,{},function(a){"undefined"!==
typeof m3dcore?(a={browser:!0,storage:!0},"undefined"!==typeof m3dcache.setup.lang&&(a=m3dcache.setup.lang),"undefined"!==typeof par&&("undefined"!==typeof par.browser&&(a.browser=par.browser),"undefined"!==typeof par.storage&&(a.storage=par.storage)),m3d.lib.localeGet(m3dcache.i.stdres.langs,a),m3d.core.mnbk.mstd=new Image,m3d.core.mnbk.mstd.onload=function(){m3d.core.mnbk.bka3d=new Image;m3d.core.mnbk.bka3d.onload=function(){m3dcache.i.loadLibs(m3dcache.i.stdres.libs_std,{},function(a){m3d.core=
{};m3d.graph={};m3dcore.initApp()})};m3d.core.mnbk.bka3d.src=m3dcache.i.corepath+m3dcache.i.stdres.images_core[1]+m3dcache.v.lng+".png?v="+m3dconf.ver},m3d.core.mnbk.mstd.src=m3dcache.i.corepath+m3dcache.i.stdres.images_core[0]+m3dcache.v.lng+".png?v="+m3dconf.ver):(a={browser:!0,storage:!0},"undefined"!==typeof m3dcache.setup.lang&&(a=m3dcache.setup.lang),"undefined"!==typeof par&&("undefined"!==typeof par.browser&&(a.browser=par.browser),"undefined"!==typeof par.storage&&(a.storage=par.storage)),
m3d.lib.localeGet(m3dcache.i.stdres.langs,a),1==m3dcache.setup.loadStdRes?(a=m3dcache.i.stdres.libs_std,m3dcache.i.loadLibs(a,{},function(a){m3dcache.i.loadLibs(m3dcache.setup.main,{},function(a){1==m3dcache.setup.loadMenu?(m3d.core.mnbk.m3dmenu=new Image,m3d.core.mnbk.m3dmenu.onload=function(){m3dcache.setup.enterPoint()},m3d.core.mnbk.m3dmenu.src=m3dcache.i.corepath+m3dcache.i.stdres.images_menu[0]+m3dcache.v.lng+".png?v="+m3dconf.ver):m3dcache.setup.enterPoint()})})):(a=m3dcache.setup.main,m3dcache.i.loadLibs(a,
{},function(a){1==m3dcache.setup.loadMenu?(m3d.core.mnbk.m3dmenu=new Image,m3d.core.mnbk.m3dmenu.onload=function(){m3dcache.setup.enterPoint()},m3d.core.mnbk.m3dmenu.src=m3dcache.i.corepath+m3dcache.i.stdres.images_menu[0]+m3dcache.v.lng+".png?v="+m3dconf.ver):m3dcache.setup.enterPoint()})))})},loadLibsD:{},loadLibs:function(a,b,c){m3dcache.i.loadLibsD.libs=a;m3dcache.i.loadLibsD.par=b;m3dcache.i.loadLibsD.n=a.length;m3dcache.i.loadLibsD.i=0;m3dcache.i.loadLibsD.cb=c;m3dcache.i.loadLibs1()},loadLibs1:function(){if(m3dcache.i.loadLibsD.i>
m3dcache.i.loadLibsD.n-1)m3dcache.i.loadLibsD.cb(m3dcache.i.loadLibsD.par);else{var a=m3dcache.i.loadLibsD.libs[m3dcache.i.loadLibsD.i],b=a[0],c=a[1].split("."),d="",f=a[2].split("_"),d="core"==f[0]?m3dcache.i.corepath+b:m3dcache.i.appath+b;1<f.length?"css"==f[1]?(c=document.createElement("link"),c.id=a[1]+".css",c.type="text/css",c.async=!0,c.rel="stylesheet",c.media="all",c.href=d+"?v="+m3dconf.ver,document.getElementsByTagName("head")[0].appendChild(c),m3dcache.i.loadLibsD.i++,m3dcache.i.loadLibs1()):
"lng"==f[1]?(m3dcache.i.loadLibsD.objar=c,b=document.createElement("script"),b.id=a[1]+m3dcache.v.lng+".js",b.type="text/javascript",b.async=!0,b.src=d+m3dcache.v.lng+".js?v="+m3dconf.ver,document.getElementsByTagName("head")[0].appendChild(b),m3d.lib.keyWait({keys:c,iteration:100,timeout:0},function(a){m3dcache.i.loadLibsD.i++;m3dcache.i.loadLibs1()})):"bin"==f[1]&&(a=d,nw.Window.get().evalNWBin(null,a),m3d.lib.keyWait({keys:c,iteration:100,timeout:0},function(a){m3dcache.i.loadLibsD.i++;m3dcache.i.loadLibs1()})):
(m3dcache.i.loadLibsD.objar=c,b=document.createElement("script"),b.id=a[1]+".js",b.type="text/javascript",b.async=!0,b.src=d+"?v="+m3dconf.ver,document.getElementsByTagName("head")[0].appendChild(b),m3d.lib.keyWait({keys:c,iteration:100,timeout:0},function(a){m3dcache.i.loadLibsD.i++;m3dcache.i.loadLibs1()}))}},aphost:"",corehost:"",corepath:""},setup:{},v:{},d:{}};
m3d={core:{v:{},mnbk:{},levelx0:0,levely0:0,levelw20:0,initV:function(){m3dcache.v=m3dcache.i;m3dcache.v.curLoc="dion_center";m3dcache.v.curGame="";m3dcache.v.fullScreen=0;m3dcache.v.passport=!1;m3dcache.d.shopCat={cur:""};m3dcache.v.objTaken={n:-1,pos:[0,0,0]};m3dcache.d.landobj0=[];m3dcache.d.landobj=[];m3dcache.d.landobj1=[];m3dcache.d.collidableMeshList=[];m3dcache.d.intersObjects=[[],[]];m3dcache.d.intersCbs=[];m3dcache.d.intersObjectsToParse=[[],[]];m3dcache.v.person={name:"Name",gender:"Male",
city:"Dion"};m3dcache.d.userPointLights=[];m3dcache.d.loc_list=m3dcache.i.locList;m3dcache.v.game_list=m3dcache.i.gameList;m3dcache.wind={};m3dcache.wind.wmin=640;m3dcache.wind.hmin=460;m3dcache.d.tmp_trackAnim=[]},menuAddCore:function(){mnb={m3d_lang_var:[[25,17],[0,0,0,0,0,0],[470,326,470,326],[470,306,470,306]],m3d_lang:[[25,17],[0,0,0,0,0,0],[470,326,470,326]],tmap:[[0,0,[0,0]],[0,0,0,0,0,0],[0,0,0,0]],tmapb:[[150,22,[150,22]],[4,1286,164,1286,324,1286],[258,984,258,984],[258,1014,258,1014],[258,
1044,258,1044]],tmapc:[[24,24,[24,24]],[558,672,558,672,558,672],[532,646,558,646]],m3d_nav1:[[52,52,[52,52]],[0,0,0,0,0,0],[539,429,539,429],[593,429,593,429],[647,483,647,483],[539,483,539,483]],m3d_nav1_x2:[[102,102,[102,102]],[0,0,0,0,0,0],[9,429,9,429],[113,429,113,429],[217,533,217,533],[9,533,9,533]],m3d_nav2:[[52,52,[52,52]],[0,0,0,0,0,0],[755,483,755,483],[701,429,701,429],[755,429,755,429],[647,429,647,429]],m3d_nav2_x2:[[102,102,[102,102]],[0,0,0,0,0,0],[425,533,425,533],[321,429,321,429],
[425,429,425,429],[217,429,217,429]],m3d_nav1btd:[0,0,0,58,0,116,58,58],m3d_nav2btd:[58,0,58,58,58,116,0,58],m3d_navw:110,m3d_navh:168,m3d_navw2:55,m3d_navh2:84,m3d_nav1btd_x2:[0,0,0,108,0,216,108,108],m3d_nav2btd_x2:[108,0,108,108,108,216,0,108],m3d_navw_x2:212,m3d_navh_x2:328,m3d_navw2_x2:106,m3d_navh2_x2:164,info:[[],[],[]],m3d_slide1:[[50,48,[50,48]],[470,650,470,650,470,650],[470,650,470,650]],cross2:[[24,24,[50,48]],[558,672,558,672,558,672],[558,672,532,698],[532,724,558,724],[532,646,558,
646]],m3d_cameraf:[[52,52,[52,52]],[0,0,0,0,0,0],[540,540,540,600],[600,540,600,600],[660,540,660,600]],m3d_camerafzoom:[[40,38,[40,38]],[718,550,718,550,718,550],[718,550,718,550]],m3d_camerafangle:[[40,38,[40,38]],[718,595,718,595,718,595],[718,595,718,595]],d1:[[145,26,[145,26]],[2,712,152,712,302,712],[2,712,152,712],[2,712,152,712],[2,712,152,712],[2,712,152,712]],cross1:[[24,24,[145,26]],[532,646,532,646,532,646],[532,646,558,646]],m3d_dyn1:[[118,38,[118,38]],[0,0,0,0,0,0],[414,358,414,430],
[414,394,414,466]],m3d_mexit:[[54,54,[54,54],[54,54,20,54]],[0,0,0,0,0,0],[483,368,593,368],[454,368,564,368]],m3d_mexitvar:[[68,58,[68,58],[282,60,282,60,282,60,70,60,70,60,70,60,70,60,70,60,70,60,70,60,70,60]],[0,0,0,0,0,0],[330,300,620,300],[330,239,620,239],[330,178,620,178],[331,56,621,56],[401,56,691,56],[471,56,761,56],[541,56,831,56],[331,117,621,117],[401,117,691,117],[471,117,761,117],[541,117,831,117]],last:[]};mn={m3d_lang:{sig:"custom",sxpos:0,sypos:0,x:3,y:3,sw:25,sh:17,sw2:12,sh2:8,
fix:!1,on:!1,drawbk:!1,block:!1,customdecor:"",hilight:"",gray:"",mtop:void 0,mbot:void 0,btop:void 0,bbot:void 0,outbk:!0,bk:2,bki:["bka3d","bka3d"],bt:[2],set:[1],cb:[0],btd:[0,0],bts:mnb.m3d_lang,cx:0,cy:0,btlabel:{},bvar:"",multitouch:!1,slide:!1},tmap:{sig:"customdecor",sxpos:0,sypos:0,x:0,y:0,sw:0,sh:0,sw2:0,sh2:0,fix:!1,on:!1,drawbk:!1,block:!1,customdecor:"",hilight:"",gray:"",mtop:void 0,mbot:void 0,btop:void 0,bbot:void 0,outbk:!1,bk:2,bki:["mbk1","mbk1"],bt:[2],set:[1],cb:[0],btd:[0,0],
bts:mnb.tmap,cx:0,cy:0,btlabel:{},bvar:"",multitouch:!1,slide:!1,data:{}},tmapb:{sig:"buttonscustom",sxpos:0,sypos:0,x:0,y:0,sw:0,sh:0,sw2:0,sh2:0,fix:!0,on:!1,drawbk:!1,block:!1,customdecor:"",hilight:"",gray:"",mtop:void 0,mbot:void 0,btop:void 0,bbot:void 0,outbk:!1,bk:1,bki:["mstd","mstd"],bt:[2,3,4],set:[3,1,1],cb:[0,0,0],btd:[0,0,0,0,0,0],bts:mnb.tmapb,cx:0,cy:0,btlabel:{},bvar:"",multitouch:!1,slide:!1},tmapc:{sig:"custom",sxpos:0,sypos:0,x:0,y:0,sw:0,sh:0,sw2:0,sh2:0,fix:!1,on:!1,drawbk:!1,
block:!1,customdecor:"",hilight:"",gray:"",mtop:void 0,mbot:void 0,btop:void 0,bbot:void 0,outbk:!0,bk:2,bki:["mbk1","mstd"],bt:[2],set:[1],cb:[0],btd:[0,0],bts:mnb.tmapc,btt:[],bttxy:[],btw2:12,cx:0,cy:0,btlabel:{},bvar:"",multitouch:!1,slide:!1},m3d_nav1:{sig:"touch",sxpos:0,sypos:0,x:0,y:0,sw:110,sh:168,sw2:55,sh2:84,fix:!1,on:!1,drawbk:!1,block:!1,customdecor:"",hilight:"",gray:"",mtop:void 0,mbot:void 0,btop:void 0,bbot:void 0,outbk:!0,bk:1,bki:["m3dmenu","m3dmenu"],bt:[2,3,4,5],set:[1,1,1,1],
cb:[0,0,0,0],btd:mnb.m3d_nav1btd,bts:mnb.m3d_nav1,cx:0,cy:0,btlabel:{},bvar:"",multitouch:!0,touch1:[0,0,0,0],touch2:[0,0,0,0],slide:!1},m3d_nav2:{sig:"touch",sxpos:0,sypos:0,x:0,y:0,sw:110,sh:168,sw2:55,sh2:84,fix:!1,on:!1,drawbk:!1,block:!1,customdecor:"",hilight:"",gray:"",mtop:void 0,mbot:void 0,btop:void 0,bbot:void 0,outbk:!0,bk:1,bki:["m3dmenu","m3dmenu"],bt:[2,3,4,5],set:[1,1,1,1],cb:[0,0,0,0],btd:mnb.m3d_nav2btd,bts:mnb.m3d_nav2,cx:0,cy:0,btlabel:{},bvar:"",multitouch:!0,touch1:[0,0,0,0],
touch2:[0,0,0,0],slide:!1},info:{sig:"custom",sxpos:0,sypos:0,x:0,y:815,sw:230,sh:110,sw2:115,sh2:55,fix:!1,on:!1,drawbk:!0,block:!1,customdecor:"",hilight:"",gray:"",mtop:void 0,mbot:void 0,btop:void 0,bbot:void 0,outbk:!1,bk:1,bki:["m3dmenu","m3dmenu"],bt:[],set:[],cb:[],btd:[],bts:mnb.info,cx:0,cy:0,btlabel:{},bvar:"",multitouch:!1,slide:!1},calendar:{sig:"custom",sxpos:0,sypos:0,x:280,y:574,sw:230,sh:110,sw2:115,sh2:55,fix:!1,on:!1,drawbk:!1,block:!1,bk:1,bki:["m3dmenu","m3dmenu"],bt:[],set:[],
cb:[],btd:[],bts:mnb.info,cx:0,cy:0,btlabel:{}},m3d_slide1:{sig:"custom",sxpos:0,sypos:0,x:825,y:430,sw:84,sh:302,sw2:42,sh2:151,fix:!1,on:!1,drawbk:!0,block:!1,customdecor:"",hilight:"",gray:"",mtop:void 0,mbot:void 0,btop:void 0,bbot:void 0,outbk:!1,bk:1,bki:["m3dmenu","m3dmenu"],bt:[2],set:[1],cb:[0],btd:[16,190],bts:mnb.m3d_slide1,cx:0,cy:0,btlabel:{},bvar:"",multitouch:!1,slide:!0,slided:{x1:0,y1:0,x2:0,y2:0,xpos:0,ypos:0}},camera:{sig:"custom",sxpos:0,sypos:0,x:0,y:0,sw:800,sh:532,sw2:400,sh2:266,
fix:!1,on:!1,drawbk:!1,block:!1,customdecor:"",hilight:"",gray:"",mtop:void 0,mbot:void 0,btop:void 0,bbot:void 0,outbk:!0,bk:2,bki:["m3dmenu","m3dmenu"],bt:[],set:[1,1,1],cb:[0,0,0],btd:[0,0,0,0,0,0],bts:mnb.m3d_cameraf,cx:0,cy:0,btlabel:{},bvar:"",multitouch:!1,data:{dx:10,dy:10,dxp2:0,vw:1,vh:1},slide:!1},m3d_camerafzoom:{sig:"custom",sxpos:0,sypos:0,x:771,y:549,sw:44,sh:262,sw2:22,sh2:131,fix:!1,on:!1,drawbk:!0,block:!1,customdecor:"",hilight:"",gray:"",mtop:void 0,mbot:void 0,btop:void 0,bbot:void 0,
outbk:!1,bk:2,bki:["m3dmenu","m3dmenu"],bt:[2],set:[1],cb:[0],btd:[2,113],bts:mnb.m3d_camerafzoom,cx:0,cy:0,btlabel:{},bvar:"",multitouch:!1,slide:!0,slided:{x1:0,y1:0,x2:0,y2:0,xpos:0,ypos:0}},m3d_camerafangle:{sig:"custom",sxpos:0,sypos:0,x:771,y:549,sw:44,sh:262,sw2:22,sh2:131,fix:!1,on:!1,drawbk:!0,block:!1,customdecor:"",hilight:"",gray:"",mtop:void 0,mbot:void 0,btop:void 0,bbot:void 0,outbk:!1,bk:2,bki:["m3dmenu","m3dmenu"],bt:[2],set:[1],cb:[0],btd:[2,113],bts:mnb.m3d_camerafangle,cx:0,cy:0,
btlabel:{},bvar:"",multitouch:!1,slide:!0,slided:{x1:0,y1:0,x2:0,y2:0,xpos:0,ypos:0}},d1:{sig:"custom",sxpos:0,sypos:0,x:2,y:567,sw:467,sh:144,sw2:233,sh2:72,fix:!1,on:!1,drawbk:!0,block:!1,customdecor:"",hilight:"",gray:"",mtop:void 0,mbot:void 0,btop:void 0,bbot:void 0,outbk:!1,bk:2,bki:["mbk1","mbk1"],bt:[2],set:[1,1,1,1],cb:[0,0,0,0],btd:[11,30,11,58,11,86,11,114],bts:mnb.d1,btt:[],bttxy:[],btw2:55,cx:0,cy:0,btlabel:{},bvar:"",multitouch:!1,slide:!1},cross1:{sig:"custom",sxpos:0,sypos:0,x:2,y:567,
sw:467,sh:136,sw2:233,sh2:68,fix:!1,on:!1,drawbk:!1,block:!1,customdecor:"",hilight:"",gray:"",mtop:void 0,mbot:void 0,btop:void 0,bbot:void 0,outbk:!1,bk:1,bki:["mbk1","mstd"],bt:[2],set:[1],cb:[0],btd:[430,4],bts:mnb.cross1,btt:[],bttxy:[],btw2:0,cx:0,cy:0,btlabel:{},bvar:"",multitouch:!1,slide:!1},m3d_dyn1:{sig:"custom",sxpos:0,sypos:0,x:0,y:0,sw:408,sh:220,sw2:204,sh2:110,fix:!1,on:!1,drawbk:!0,block:!1,customdecor:"",hilight:"",gray:"",mtop:void 0,mbot:void 0,btop:void 0,bbot:void 0,outbk:!1,
bk:2,bki:["bka3d","bka3d"],bt:[2,3],set:[1,1],cb:[0,0],btd:[86,175,206,175],bts:mnb.m3d_dyn1,btt:[],bttxy:[],btw2:59,cx:0,cy:0,btlabel:{},bvar:"",multitouch:!1,slide:!1},m3d_mexit:{sig:"custom",sxpos:0,sypos:0,x:330,y:365,sw:100,sh:60,sw2:50,sh2:30,fix:!0,on:!1,drawbk:!0,outbk:!1,btbk:!1,btbkclear:!1,tabs:!1,block:!1,bk:2,bki:["m3dmenu","m3dmenu"],bt:[2,3],set:[1,1],cb:[0,0],btd:[43,3,14,3],bts:mnb.m3d_mexit,cx:0,cy:0,btlabel:{},bvar:"",multitouch:!1,slide:!1},m3d_mexitvar:{sig:"custom",sxpos:0,sypos:0,
x:0,y:0,sw:320,sh:380,sw2:160,sh2:190,fix:!1,on:!1,drawbk:!0,block:!1,customdecor:"",hilight:"",gray:"",mtop:void 0,mbot:void 0,btop:void 0,bbot:void 0,outbk:!1,bk:1,bki:["m3dmenu","m3dmenu"],bt:[2,3,4,5,6,7,8,9,10,11,12],set:[1,1,1,1,1,1,1,1,1,1,1],cb:[0,0,0,0,0,0,0,0,0,0,0],btd:[20,299,20,238,20,177,21,55,91,55,161,55,231,55,21,116,91,116,161,116,231,116],bts:mnb.m3d_mexitvar,cx:0,cy:0,btlabel:{},bvar:"",multitouch:!1,slide:!1}};mn_index="calendar info m3d_nav1 m3d_nav2 d1 cross1 camera m3d_camerafzoom m3d_camerafangle m3d_slide1 tmap tmapb tmapc m3d_lang".split(" ");
mn_index_top=["m3d_mexit","m3d_mexitvar","m3d_dyn1"];1==m3dcache.i.locationStd&&(mn.m3d_mexit.bt=[]);"frame"==m3dconf.connect&&(mn.m3d_mexit.bt=[])},menuBuild:function(){mn_index=mn_index.concat(mn_index_top);"self"!=m3dconf.connect&&(m3d.uf.exitGame=m3d.lib.exitGameCore)},menuInit:function(){m3d.ui.mnSetCb("m3d_lang",1,function(){m3d.core.btLangCl(1)});m3d.ui.mnSetCb("m3d_mexit",1,function(){m3d.core.mnMainExitCl()});m3d.ui.mnSetCb("m3d_mexit",2,function(){m3d.core.mnMainExitMailCl()});m3d.ui.mnSetCustomM("m3d_mexit",
m3d.core.mnMainExitCustom);mn.m3d_mexit.btop=m3d.core.mnMainExitBTop;m3d.ui.mnSetCb("m3d_mexitvar",1,function(){m3d.core.mnMainExitVarCl(1)});m3d.ui.mnSetCb("m3d_mexitvar",2,function(){m3d.core.mnMainExitVarCl(2)});m3d.ui.mnSetCb("m3d_mexitvar",3,function(){m3d.core.mnMainExitVarCl(3)});m3d.ui.mnSetCb("m3d_mexitvar",4,function(){m3d.core.mnMainExitVarCl(4)});m3d.ui.mnSetCb("m3d_mexitvar",5,function(){m3d.core.mnMainExitVarCl(5)});m3d.ui.mnSetCb("m3d_mexitvar",6,function(){m3d.core.mnMainExitVarCl(6)});
m3d.ui.mnSetCb("m3d_mexitvar",7,function(){m3d.core.mnMainExitVarCl(7)});m3d.ui.mnSetCb("m3d_mexitvar",8,function(){m3d.core.mnMainExitVarCl(8)});m3d.ui.mnSetCb("m3d_mexitvar",9,function(){m3d.core.mnMainExitVarCl(9)});m3d.ui.mnSetCb("m3d_mexitvar",10,function(){m3d.core.mnMainExitVarCl(10)});m3d.ui.mnSetCb("m3d_mexitvar",11,function(){m3d.core.mnMainExitVarCl(11)});m3d.ui.mnSetCustomM("m3d_mexitvar",m3d.core.mnMainExitvarCustom);m3d.ui.mnSetCustomM("tmap",m3d.core.mnTeleportMapCustom);m3d.ui.mnSetCb("tmapc",
1,function(){m3d.core.mnTeleportMapClose()});m3d.ui.mnSetCb("tmapb",1,function(){m3d.core.mnMapFree()});m3d.ui.mnSetCb("tmapb",2,function(){m3d.core.mnMapFriends()});m3d.ui.mnSetCb("tmapb",3,function(){m3d.core.mnMapTeleport()});m3d.ui.mnSetCustomM("camera",m3d.core.mnCameraCustom);m3d.ui.mnSetCb("camera",1,function(){m3d.core.mnCameraShoot()});m3d.ui.mnSetCb("camera",2,function(){m3d.core.mnCameraClose()});m3d.ui.mnSetCb("camera",3,function(){m3d.core.mnCameraLoad()});m3d.ui.mnSetCb("m3d_camerafzoom",
1,function(a){m3d.core.mnCameraZoom(a)});m3d.ui.mnSetCustomM("m3d_camerafzoom",m3d.core.mnCameraZoomCustom);m3d.ui.mnSetCb("m3d_camerafangle",1,function(){m3d.core.mnCameraAngle()});m3d.ui.mnSetCustomM("m3d_camerafangle",m3d.core.mnCameraAngleCustom);m3d.ui.mnSetCustomM("info",m3d.core.mnInfoCustom);m3d.ui.mnSetCb("m3d_slide1",1,function(a){m3d.core.mnPersonViewDistanceSlide(a)});m3d.ui.mnSetCustomM("m3d_slide1",m3d.core.mnPersonViewDistanceSlideCustom);m3d.ui.mnSetCb("m3d_nav1",1,function(){m3d.core.mnNav1up()});
m3d.ui.mnSetCbTouch1("m3d_nav1",1,function(){m3d.core.mnNav1up1()});m3d.ui.mnSetCbTouch2("m3d_nav1",1,function(){m3d.core.mnNav1up2()});m3d.ui.mnSetCb("m3d_nav1",2,function(){m3d.core.mnNav1dn()});m3d.ui.mnSetCbTouch1("m3d_nav1",2,function(){m3d.core.mnNav1dn1()});m3d.ui.mnSetCbTouch2("m3d_nav1",2,function(){m3d.core.mnNav1dn2()});m3d.ui.mnSetCb("m3d_nav1",3,function(){m3d.core.mnNav1side()});m3d.ui.mnSetCbTouch1("m3d_nav1",3,function(){m3d.core.mnNav1side1()});m3d.ui.mnSetCbTouch2("m3d_nav1",3,function(){m3d.core.mnNav1side2()});
m3d.ui.mnSetCb("m3d_nav1",4,function(){m3d.core.mnNav1run()});m3d.ui.mnSetCbTouch1("m3d_nav1",4,function(){m3d.core.mnNav1run1()});m3d.ui.mnSetCbTouch2("m3d_nav1",4,function(){m3d.core.mnNav1run2()});m3d.ui.mnSetCb("m3d_nav2",1,function(){m3d.core.mnNav2fire()});m3d.ui.mnSetCbTouch1("m3d_nav2",1,function(){m3d.core.mnNav2fire1()});m3d.ui.mnSetCbTouch2("m3d_nav2",1,function(){m3d.core.mnNav2fire2()});m3d.ui.mnSetCb("m3d_nav2",2,function(){m3d.core.mnNav2rt()});m3d.ui.mnSetCbTouch1("m3d_nav2",2,function(){m3d.core.mnNav2rt1()});
m3d.ui.mnSetCbTouch2("m3d_nav2",2,function(){m3d.core.mnNav2rt2()});m3d.ui.mnSetCb("m3d_nav2",3,function(){m3d.core.mnNav2take()});m3d.ui.mnSetCbTouch1("m3d_nav2",3,function(){m3d.core.mnNav2take1()});m3d.ui.mnSetCbTouch2("m3d_nav2",3,function(){m3d.core.mnNav2take2()});m3d.ui.mnSetCb("m3d_nav2",4,function(){m3d.core.mnNav2lt()});m3d.ui.mnSetCbTouch1("m3d_nav2",4,function(){m3d.core.mnNav2lt1()});m3d.ui.mnSetCbTouch2("m3d_nav2",4,function(){m3d.core.mnNav2lt2()});ap.menuInitMyLocation()},menuSetPosCenter:function(a,
b,c){var d=mn[a].bt.length,f=mn[a].bts[0][0],e=Math.floor(((d-1)*(f+c)+f)/2),g=0;0==mn[a].drawbk?(mn[a].sw=2*e,mn[a].sw2=e,mn[a].sxpos=m3dcache.v.vw2-e):g=mn[a].sw2-e;mn[a].btd=[];for(e=0;e<d;e++)mn[a].btd.push(e*(f+c)+g),mn[a].btd.push(b)},menuSetTotalPageItems:function(a,b,c){mn[a].pitems=Math.floor((m3dcache.v.vw-c)/(mn[a].bts[0][0]+b));mn[a].page=1},menuSetPage:function(a,b,c){var d=mn[a].pitems,f=mn[a].bttotal,e=c*d-d,d=e+d;d>f&&(d=f);if(d+1>e)for(mn[a].bt=[],mn[a].page=c,c=e;c<d;c++)mn[a].bt.push(c+
2);mn[b].set=[1,1];1==mn[a].page&&(mn[b].set[0]=4);d==f&&(mn[b].set[1]=4)},menuSetPos:function(){mn.m3d_lang.mnbk=m3d.core.mnbk;mn.m3d_mexit.mnbk=m3d.core.mnbk;mn.m3d_mexitvar.mnbk=m3d.core.mnbk;mn.tmap.mnbk=m3d.core.mnbk;mn.tmapb.mnbk=m3d.core.mnbk;mn.tmapc.mnbk=m3d.core.mnbk;mn.m3d_nav1.mnbk=m3d.core.mnbk;mn.m3d_nav2.mnbk=m3d.core.mnbk;mn.info.mnbk=m3d.core.mnbk;mn.calendar.mnbk=m3d.core.mnbk;mn.m3d_slide1.mnbk=m3d.core.mnbk;mn.camera.mnbk=m3d.core.mnbk;mn.m3d_camerafzoom.mnbk=m3d.core.mnbk;mn.m3d_camerafangle.mnbk=
m3d.core.mnbk;mn.d1.mnbk=m3d.core.mnbk;mn.cross1.mnbk=m3d.core.mnbk;mn.m3d_dyn1.mnbk=m3d.core.mnbk;m3d.core.levelx0=4;m3d.core.levely0=m3dcache.v.vh2-mn.m3d_slide1.h2;m3d.core.levelw20=Math.floor((m3dcache.v.vw-8)/2);mn.tmap.sw2=m3dcache.v.vw2-10;mn.tmap.sh2=m3dcache.v.vh2-10;mn.tmap.sw=2*mn.tmap.sw2;mn.tmap.sh=2*mn.tmap.sh2;mn.tmap.sxpos=m3dcache.v.vw2-mn.tmap.sw2;mn.tmap.sypos=m3dcache.v.vh2-mn.tmap.sh2;mn.tmapb.sh2=12;mn.tmapb.sh=22;mn.tmapb.sypos=mn.tmap.sypos+mn.tmap.sh-24;m3d.core.menuSetPosCenter("tmapb",
0,7);mn.tmapc.sxpos=mn.tmap.sxpos;mn.tmapc.sypos=mn.tmap.sypos;mn.tmapc.sw=mn.tmap.sw;mn.tmapc.sh=26;mn.tmapc.btd=[mn.tmapc.sxpos+mn.tmapc.sw-36,2];mn.camera.sw2=m3dcache.v.vw2-60;mn.camera.sh2=Math.floor(133*mn.camera.sw2/200);mn.camera.sh2>m3dcache.v.vh2-8&&(mn.camera.sh2=m3dcache.v.vh2-8,mn.camera.sw2=Math.floor(200*mn.camera.sh2/133));mn.camera.sw=2*mn.camera.sw2;mn.camera.sh=2*mn.camera.sh2;mn.camera.sxpos=m3dcache.v.vw2-mn.camera.sw2;mn.camera.sypos=m3dcache.v.vh2-mn.camera.sh2;mn.camera.btd=
[-58,60,mn.camera.sw+6,60,-58,114];mn.camera.bt=[2,3];mn.m3d_camerafzoom.sxpos=mn.camera.sxpos+mn.camera.sw+12;mn.m3d_camerafzoom.sypos=mn.camera.sypos+110+60;mn.m3d_camerafzoom.slided.xpos=mn.camera.sxpos+mn.camera.sw+12;mn.m3d_camerafzoom.slided.ypos=mn.camera.sypos+110+130-17+60;mn.m3d_camerafangle.sxpos=mn.camera.sxpos-mn.m3d_camerafangle.sw-12;mn.m3d_camerafangle.sypos=mn.camera.sypos+110+60;mn.m3d_camerafangle.slided.xpos=mn.camera.sxpos-mn.m3d_camerafangle.sw-12;mn.m3d_camerafangle.slided.ypos=
mn.camera.sypos+110+130-17+60;mn.info.sxpos=m3dcache.v.vw2-mn.info.sw2;mn.info.sypos=4;mn.calendar.sxpos=4;mn.calendar.sypos=4;m3d.core.mnMainControlsSetPosNav();mn.m3d_nav1.sxpos=4;mn.m3d_nav1.sypos=m3dcache.v.vh2-mn.m3d_nav1.sh2-28;mn.m3d_nav2.sxpos=m3dcache.v.vw-mn.m3d_nav2.sw-4;mn.m3d_nav2.sypos=m3dcache.v.vh2-mn.m3d_nav2.sh2-28;mn.m3d_dyn1.sxpos=m3dcache.v.vw2-mn.m3d_dyn1.sw2;mn.m3d_dyn1.sypos=m3dcache.v.vh2-mn.m3d_dyn1.sh2;mn.m3d_mexit.sxpos=m3dcache.v.vwf-mn.m3d_mexit.sw-2;mn.m3d_mexit.sypos=
2;mn.m3d_mexitvar.sxpos=0;mn.m3d_mexitvar.sypos=0;mn.m3d_mexitvar.container=m3d.ui.layersDiv.m3d_mexitvar.div;mn.m3d_mexitvar.ctx=m3d.ui.layersDiv.m3d_mexitvar.ctx;mn.m3d_mexitvar.contxpos=m3dcache.v.vwf2-mn.m3d_mexitvar.sw2;mn.m3d_mexitvar.contypos=m3dcache.v.vhf2-mn.m3d_mexitvar.sh2;mn.m3d_mexitvar.contxpos_s=mn.m3d_mexitvar.contxpos;mn.m3d_mexitvar.contypos_s=mn.m3d_mexitvar.contypos;m3d.ui.setPosLayersDiv("m3d_mexitvar",mn.m3d_mexitvar.contxpos,mn.m3d_mexitvar.contypos,mn.m3d_mexitvar.sw,mn.m3d_mexitvar.sh);
document.getElementById("m3d_mexitvar").style.position="absolute";ap.menuSetPosMyLocation();m3d.ui.reScale(mn)},mnMainExitCl:function(){1==mn.m3d_mexitvar.on?m3d.core.mnMainExitVarClose():m3d.core.mnMainExitVarOpen()},mnMainExitVarOpen:function(){m3d.ui.mnOn(["m3d_mexitvar"]);m3d.ui.layersDiv.m3d_mexitvar.div.style.display="block";var a=!1;"undefined"!==typeof ap&&"undefined"!==typeof ap.ref&&(a=!0);m3d.uf.mnMainExitVarOpenUser();1==a?ap.ref():m3d.ui.ref()},mnMainExitVarClose:function(){m3d.ui.mnOff(["m3d_mexitvar",
"m3d_slide1"]);m3d.ui.layersDiv.m3d_mexitvar.div.style.display="none";var a=!1;"undefined"!==typeof ap&&"undefined"!==typeof ap.ref&&(a=!0);m3d.uf.mnMainExitVarCloseUser();1==a?ap.ref():m3d.ui.ref()},mnMainExitMailCl:function(){},mnMainExitCustom:function(){},mnMainExitBTop:function(a,b,c){},mnMainExitvarCustom:function(){mn.m3d_mexitvar.ctx.drawImage(m3d.core.mnbk.m3dmenu,0,381,320,40,mn.m3d_mexitvar.xpos+0,mn.m3d_mexitvar.ypos+16,320,40)},mnMainExitVarCl:function(a){1==a?m3d.core.mnMainExitVarClose():
2==a?(m3d.ui.mnOff(["m3d_mexitvar","m3d_slide1"]),m3d.ui.layersDiv.m3d_mexitvar.div.style.display="none",m3d.uf.exitGame()):3==a?(m3d.ui.mnOff(["m3d_mexitvar","m3d_slide1"]),m3d.ui.layersDiv.m3d_mexitvar.div.style.display="none",m3d.ui.mnOffAll(),m3d.ui.ref(),m3d.uf.exitMenu()):4==a?m3d.core.mnMainControls():5==a?m3d.core.mnMailCamera():6==a?m3d.core.mnSound():7==a?0==m3dcache.v.fullScreen?(m3dcache.v.fullScreen=1,m3d.resize.mnMainFullScreen()):(m3dcache.v.fullScreen=0,m3d.resize.mnMainFullScreenExit()):
8!=a&&9==a&&m3d.core.mnPersonViewDistance()},initAppHello:function(a,b){var c='<p class="hellot1" align="center">'+m3dcache.d.lngc.hello[b]+"</p>",d='<p class="hellot1" align="center">'+a+"</p>",c='<div class="cdivlogo"></div>'+('<div class="cdivrndri"><div id="progressBar">'+m3d.core.progressHtml(0)+'</div><div style="height:14px;"></div>'+c+'<div style="height:0px;"></div>'+d+'<div style="height:12px;"></div></div>');document.getElementById("divrndrt").innerHTML=c;document.getElementById("dwfoot").innerHTML=
"";document.getElementById("divrndrt2").innerHTML=""},initAppHelloProgress:function(a){document.getElementById("progressBar").innerHTML=m3d.core.progressHtml(a)},progress:{},initAppDefaults:function(){m3d.html.init("m3dcontainer");m3dcache.i.gameLoaded=m3dcache.i.gameLoadedNew();m3d.core.initV();m3dcache.v.initApp=!0;m3dcache.d.loc=m3d.core.locnew();m3dcache.d.loc_edges=[[],[1,-1E4,1E4,-1E4,1E4,0,0,0,0]];m3dcache.d.loce=m3dcache.d.loc_edges.slice();m3dcache.d.locee=[];curDistrict=0},initApp2:function(){m3dcache.v.initApp=
!0;m3dcache.d.loc=m3d.core.locnew();m3dcache.d.loc_edges=[[],[1,-1E4,1E4,-1E4,1E4,0,0,0,0]];m3dcache.d.loce=m3dcache.d.loc_edges.slice();m3dcache.d.locee=[];curDistrict=0;m3d.core.mnbk={};1==m3dcache.v.passport?(m3d.lib.ticker.elem.push("dwperson"),m3d.lib.ticker.t.push(m3dcache.d.lngc.ticker[1]),m3d.lib.ticker.elem.push("dwreg"),m3d.lib.ticker.t.push(m3dcache.d.lngc.ticker[2]),m3d.lib.ticker.characterTimeout=50,m3d.lib.ticker.storyTimeout=3E3,setTimeout(function(){m3d.lib.startTicker()},100)):document.getElementById("passport").style.display=
"none";2==rndr?(m3d.core.mnbk.mstd=new Image,m3d.core.mnbk.mstd.onload=function(){m3d.core.mnbk.bka3d=new Image;m3d.core.mnbk.bka3d.onload=function(){document.getElementById("passport").style.display="block";m3dcache.v.init3Dstart=!0;m3dcache.v.init3Dfail=!0;m3dcache.v.apname="";if(0!=m3d.lib.in_arr_n(m3dcache.d.loc_list.memo,"loc_"+curLoc).length){var a=m3dcache.d.loc_list.host[m3d.lib.in_arr_n(m3dcache.d.loc_list.memo,"loc_"+curLoc)[0]],b=m3dcache.d.loc_list.path[m3d.lib.in_arr_n(m3dcache.d.loc_list.memo,
"loc_"+curLoc)[0]];m3dcache.i.aphost=a;appath=b;var c=m3dcache.d.loc_list.name[m3d.lib.in_arr_n(m3dcache.d.loc_list.memo,"loc_"+curLoc)[0]];m3dcache.v.apname=c;m3dcache.v.aptype=1;0==m3dcache.v.passport&&m3d.core.initAppHello(m3dcache.v.apname,m3dcache.v.aptype);ap={};a=document.createElement("script");a.type="text/javascript";a.src=appath+"location/"+curLoc+"/loc_"+curLoc+m3dconf.vfile+".js?v="+m3dconf.ver;a.async=!0;document.getElementsByTagName("head")[0].appendChild(a)}else 0!=m3d.lib.in_arr_n(m3dcache.v.game_list.memo,
""+m3dcache.v.curGame).length?(curLoc=m3dcache.v.curGame,c=m3dcache.v.game_list.name[m3d.lib.in_arr_n(m3dcache.v.game_list.memo,""+m3dcache.v.curGame)[0]],a=m3dcache.v.game_list.host[m3d.lib.in_arr_n(m3dcache.v.game_list.memo,""+m3dcache.v.curGame)[0]],b=m3dcache.v.game_list.path[m3d.lib.in_arr_n(m3dcache.v.game_list.memo,""+m3dcache.v.curGame)[0]],m3dcache.i.aphost=a,appath=b,m3dcache.v.apname=c,m3dcache.v.aptype=11,0==m3dcache.v.passport&&m3d.core.initAppHello(m3dcache.v.apname,m3dcache.v.aptype),
ap={},a=document.createElement("script"),a.type="text/javascript",a.src=appath+"game/"+curLoc+"/"+curLoc+m3dconf.vfile+".js?v="+m3dconf.ver,a.async=!0,document.getElementsByTagName("head")[0].appendChild(a)):(0==m3dcache.v.passport&&m3d.core.initAppHello("Error!",1),a='<p class="hellot1" align="center">'+m3dcache.d.lngc.hello[8]+'</p><br/><p class="hellot" align="center">'+m3dcache.d.lngc.hello[9]+'</p><div style="width:39px; height:25px; margin:auto"></div>',document.getElementById("divrndrt").innerHTML=
'<div style="width:500px; height:350px; background-image:url(i/discon.png);  background-repeat:no-repeat; margin:auto"><div class="cdivlogo"></div><div class="cdivrndri"><div id="progressBar">'+m3d.core.progressHtml(0)+'</div><div style="height:10px;"></div>'+a+'<br/><p align="center"><a class="txterra" href="'+m3dcache.v.thisPath+"?lang="+m3dcache.v.lng+'">'+m3dcache.d.lngc.hello[7]+'</a></p><br/></div> <br/><br/><p align="center"><a class="txterra" href="'+m3dcache.v.path2d+"?lang="+m3dcache.v.lng+
'">'+m3dcache.d.lngc.hello[5]+'</a></p> <p class="ctfoot" align="center">(c) m3d.me</p> </div>',m3d.lib.playSound("result2"))};m3d.core.mnbk.bka3d.src=m3dcache.i.corepath+"i/"+m3dcache.v.thm+"_v3d-2_"+m3dcache.v.lng+".png?v="+m3dconf.ver},m3d.core.mnbk.mstd.src=m3dcache.i.corepath+"i/"+m3dcache.v.thm+"_mstd_"+m3dcache.v.lng+".png?v="+m3dconf.ver):(document.getElementById("divrndrii").style.display="none",document.getElementById("divst").style.display="none",document.getElementById("wrap0").style.display=
"none",document.getElementById("d2d").style.display="block")},btLangCl:function(){"ru"==m3dcache.v.lng?(m3dcache.v.lng="en",mnb.m3d_lang[2]=mnb.m3d_lang_var[2]):(m3dcache.v.lng="ru",mnb.m3d_lang[2]=mnb.m3d_lang_var[3]);1==m3dcache.v.init3Dstart&1==m3dcache.v.init3Dfail||m3d.ui.ref();m3dcache.v.chlang=!0;(1==m3dcache.v.loadedall||1==m3dcache.v.init3Dstart&1==m3dcache.v.init3Dfail)&&m3d.core.btLangClGo()},btLangClGo:function(){setTimeout(function(){1==m3dcache.v.init3Dstart&1==m3dcache.v.init3Dfail||
m3d.graph.clearScene();location.replace(m3dcache.v.thisPath+"?lang="+m3dcache.v.lng)},500)},locnew:function(){return{curInt:"",name:"",loaded:!1,menu:"myhome",menulabel:"myhome",menu3dIds:{},nav:{submenu1:-1,menu3d:-1},images:["0"],canvases:["0"],canvmat:["0"],lightD:[""],lightH:[""],lightsS:[""],lightsP:[""],objs:[],objsKeys:{stdkey:[]},objsNames:[],objsNamesKeys:{stdkey:[]},objsNamesData:{stdkey:[]},objsNamesKeysClone:{stdkey:[]},objIntersNames:[[],[]],objIntersIds:[[],[]],objInters:[{},{}],objInters2:[{},
{}],objIntersData:[[],[]],objIntersDataId:[[],[]],objIntersNamesToParse:[[],[]],objIntersIdsToParse:[[],[]],objIntersDataToParse:[[],[]],objHidden:[[]],objHiddenNames:[[]],locKey:"stdkey",intersObjectsKeys:{},intersLoading:!1,colObjectsKeys:{},colObjectsKeysN:{},colObjectsKeysKeys:{},graph:{solidAlphaTest:0,transparentAlphaTest:.6},texHouseCache:[],centLt:""}},locnew_data:function(){m3dcache.d.loc.menulabel=ap.locd.menulabel},checkEdges:function(a,b){var c=m3dcache.d.loce[curDistrict],d="";a<c[1]&&
(d=c[8]);a>c[2]&&(d=c[6]);b<c[3]&&(d=c[5]);b>c[4]&&(d=c[7]);""!=d&&(c=m3dcache.d.locee[curDistrict],a>c[1]&a<c[2]&b>c[3]&b<c[4]||(curDistrict=d),0==m3dcache.d.loce[d][0]?(m3dcache.d.loc.intersLoading=!0,m3dcache.d.loce[d][0]=1,m3d.core.mnInfoText(lng.loc[1]+d),setTimeout(function(){m3d.core.mnInfoHide()},1E3),ap.linkDistrict(d)):""!=m3dcache.d.loc.locKey&&0==m3dcache.d.loc.intersLoading&&(m3dcache.d.loc.locKey=curDistrict,"undefined"!==typeof m3dcache.d.loc.intersObjectsKeys[m3dcache.d.loc.locKey]&&
(0<m3dcache.d.loc.intersObjectsKeys[m3dcache.d.loc.locKey].length&&(m3dcache.d.intersObjects[0]=m3dcache.d.loc.intersObjectsKeys[m3dcache.d.loc.locKey]),0<m3dcache.d.loc.colObjectsKeys[m3dcache.d.loc.locKey].length&&(m3dcache.d.collidableMeshList=m3dcache.d.loc.colObjectsKeys[m3dcache.d.loc.locKey]))))},setRenderF:function(){m3d.contr.renderAll=function(){apscene.camerab.position.x=apscene.camera.position.x;apscene.camerab.position.y=apscene.camera.position.y;apscene.camerab.position.z=apscene.camera.position.z;
apscene.camerab.rotation.x=apscene.camera.rotation.x;apscene.camerab.rotation.y=apscene.camera.rotation.y;apscene.camerab.rotation.z=apscene.camera.rotation.z;apscene.camerab.lookAt=apscene.camera.lookAt;apscene.renderer.clear();apscene.renderer.render(apscene.sceneb,apscene.camerab);apscene.renderer.clearDepth();apscene.renderer.render(apscene.scene,apscene.camera);"undefined"!=typeof termo&&apscene.rendererCSS.render(apscene.cssScene,apscene.camera)}},setBgSceneDefaults:{a:70,d1:1,d2:5E4,far:7E4,
x:0,y:10,z:0,lx:100,ly:10,lz:100},initGraph2D:function(){m3d.core.initCanv(0,0);m3d.ui.reScale(mn);m3d.contr.initStartFunctions()},initGraph3D:function(a){m3d.core.initThree();apscene.camera.far=m3d.core.getCameraFar();m3d.graph.initLights();"undefined"!==typeof ap.setBgScene&&m3d.graph.createBackgroundScene(ap.setBgScene);"undefined"!==typeof apscene.camerab?m3d.core.setRenderF():m3d.contr.renderBK=function(){}},initRender:function(){"undefined"!==typeof apscene.camerab?m3d.core.setRenderF():m3d.contr.renderBK=
function(){}},locationScriptLoaded:function(){m3dcache.i.gameLoaded.app=!0;mouset="";ap.loadLocationMyLocation()},langLoadCore:function(){var a,b="lng_"+m3dcache.v.lng;a=document.createElement("script");a.id=b;a.async=!0;a.type="text/javascript";a.src="lng/lng_"+m3dcache.v.lng+m3dconf.vfile+".js?v="+m3dconf.ver;document.getElementsByTagName("head")[0].appendChild(a)},langLoad:function(){if("loc"==ap.locd.type)var a="loc_"+curLoc+"_lng_"+m3dcache.v.lng+m3dconf.vfile+".js?v="+m3dconf.ver,b="lng_"+curLoc+
"_lng_"+m3dcache.v.lng;else b=curLoc+"_lng_"+m3dcache.v.lng,a=curLoc+"_lng_"+m3dcache.v.lng+m3dconf.vfile+".js?v="+m3dconf.ver;var c=document.createElement("script");c.id=b;c.async=!0;c.type="text/javascript";c.src=a;document.getElementsByTagName("head")[0].appendChild(c)},loadedLang:function(){ap.langSetNamesMyLocation()},langSetNamesCore:function(){var a="-470px -326px";mnb.m3d_lang[2]=mnb.m3d_lang_var[2];"ru"==m3dcache.v.lng&&(a="-470px -306px",mnb.m3d_lang[2]=mnb.m3d_lang_var[3]);document.getElementById("divlng").style.backgroundPosition=
a;document.getElementById("divlng").style.display="block";document.getElementById("dwinputt1").innerHTML=m3dcache.d.lngc.hello[3];document.getElementById("dwinputt2").innerHTML=m3dcache.d.lngc.hello[4]},initPlayer:function(a,b,c,d,f,e){var g=new THREE.MeshPhongMaterial({opacity:0}),h=new THREE.BoxGeometry(a,b,c,d,f,e);apscene.player=new THREE.Mesh(h,g);apscene.player.position.set(apscene.camera.position.x,apscene.camera.position.y-11,apscene.camera.position.z);apscene.scene.add(apscene.player);apscene.player.material.opacity=
0;apscene.player.material.transparent=!0;apscene.player.material.depthWrite=!1;g=new THREE.MeshPhongMaterial({opacity:0});a=new THREE.BoxGeometry(a,b,c,d,f,e);apscene.dirLightTarget=new THREE.Mesh(a,g);apscene.dirLightTarget.position.set(apscene.camera.position.x,apscene.camera.position.y-11,apscene.camera.position.z);apscene.scene.add(apscene.dirLightTarget);apscene.dirLightTarget.material.opacity=0;apscene.dirLightTarget.material.transparent=!0;apscene.dirLightTarget.material.depthWrite=!1},enterGame:function(){document.getElementById("divst").style.display=
"none";document.getElementById("appbody").style.backgroundColor="#000000";m3d.graph.applyTextures();m3d.contr.renderAll();setTimeout(function(){ap.enterGameMyLocation()},200)},enterOptimize:function(){document.getElementById("divst").innerHTML=""},btLoginCl:function(){m3d.lib.stopTicker();m3d.lib.playSound("click2");document.getElementById("enternotauth").style.display="none";document.getElementById("enterauth").style.display="block";m3d.lib.ticker.elem[0]="dwperson";m3d.lib.ticker.t[0]=m3dcache.d.lngc.ticker[3]+
person.name+"<br/>"+m3dcache.d.lngc.ticker[4]+person.gender+"<br/>"+m3dcache.d.lngc.ticker[5]+person.city;m3d.lib.ticker.elem[1]="dwstatus";m3d.lib.ticker.t[1]=m3dcache.d.lngc.ticker[6]+m3dcache.d.lngc.loc[1]+"<br/>"+m3dcache.d.lngc.ticker[7]+0+"<br/ ";setTimeout(function(){m3d.lib.stopTicker();m3d.lib.ticker.characterTimeout=50;m3d.lib.ticker.storyTimeout=3E3;m3d.lib.startTicker()},10)},btEnterCl:function(){1==m3dcache.d.loc.loaded&&m3d.core.hidePassport();m3d.lib.playSound("click2")},hidePassport:function(){m3d.lib.stopTicker();
document.getElementById("divrndrii").style.display="none";m3d.graph.effects.lookAround.exit();document.getElementById("divcanv").style.display="block";m3dcache.v.mouse=1},progressHtml:function(a){return'<div style="width:192px; height:8px; border:1px solid #666666; margin:auto;"><div style="width:'+Math.floor(192*a/100)+'px; height:8px; background-color:#CCCCCC; margin:0;"></div></div>'},initCanv:function(a,b){function c(){document.getElementById("divcanv").innerHTML='<div style="height:130px"></div><div style="width:440px; border:#FFFFFF 1px solid; margin:10px; padding:4px; background-color:#000000"><p class="txterr">---\x3e \u041a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430<br/>\u041f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u0435 \u0440\u0430\u0431\u043e\u0442\u0430\u0435\u0442 \u043f\u043e \u0442\u0435\u0445\u043d\u043e\u043b\u043e\u0433\u0438\u044f\u043c HTML5 Canvas \u0438 WebGL. <br/>\u041a \u0441\u043e\u0436\u0430\u043b\u0435\u043d\u0438\u044e, \u0432\u0430\u0448 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u0443\u0441\u0442\u0430\u0440\u0435\u043b \u0438 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 Canvas.<br/>\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u0435 \u0431\u0440\u0430\u0443\u0437\u0435\u0440.</p></div>'}
var d=0;0==a&&(b=a=600);elcanv=document.getElementById("divcanv");elcanv.innerHTML='<canvas id="canv" style="width:'+a+"px; height:"+b+'px;" width="'+a+'" height="'+b+'"></canvas>';if(canvas1=document.getElementById("canv"))if(canvas1.getContext){apctx=canvas1.getContext("2d");apctx.clearRect(0,0,a,b);var d=1,f;for(f in m3d.ui.layers)"htmlDiv"==m3d.ui.layers[f].type?"Ads"==m3d.ui.layers[f].id?(m3d.ui.layers[f].div.style.width=m3d.ui.layers[f].w,m3d.ui.layers[f].div.style.height=m3d.ui.layers[f].h):
(m3d.ui.layers[f].div.style.width=a,m3d.ui.layers[f].div.style.height=b):"Ads"==m3d.ui.layers[f].id?(m3d.ui.layers[f].divcanv=document.getElementById("div"+m3d.ui.layers[f].id),m3d.ui.layers[f].divcanv.innerHTML='<canvas id="'+m3d.ui.layers[f].id+'" style="display:block; width:'+m3d.ui.layers[f].w+"px; height:"+m3d.ui.layers[f].h+'px;" width="'+m3d.ui.layers[f].w+'" height="'+m3d.ui.layers[f].h+'"></canvas>',m3d.ui.layers[f].canv=document.getElementById(m3d.ui.layers[f].id),m3d.ui.layers[f].ctx=m3d.ui.layers[f].canv.getContext("2d"),
m3d.ui.layers[f].ctx.clearRect(0,0,m3d.ui.layers[f].w,m3d.ui.layers[f].h)):(m3d.ui.layers[f].divcanv=document.getElementById("div"+m3d.ui.layers[f].id),m3d.ui.layers[f].divcanv.innerHTML='<canvas id="'+m3d.ui.layers[f].id+'" style="display:block; width:'+a+"px; height:"+b+'px;" width="'+a+'" height="'+b+'"></canvas>',m3d.ui.layers[f].canv=document.getElementById(m3d.ui.layers[f].id),m3d.ui.layers[f].ctx=m3d.ui.layers[f].canv.getContext("2d"),m3d.ui.layers[f].ctx.clearRect(0,0,a,b))}else c();else return c(),
0;return d},initThree:function(){m3d.resize.onWindowResize(0);document.getElementById("divrndrii").style.display="block";document.getElementById("divst").style.display="none";document.getElementById("divrndr").innerHTML=m3dcache.d.lngc.hello[2];c3d=document.getElementById("divcanv3d");1==rndr&&(apscene.renderer=new THREE.CanvasRenderer);2==rndr&&(apscene.renderer=new THREE.WebGLRenderer({alpha:!0,antialias:m3dcache.v.antialias}));document.getElementById("divrndr").style.display="none";m3d.core.initAppHello(m3dcache.v.apname,
m3dcache.v.aptype);var a=m3dcache.setup.aspect.scale;m3dcache.v.vw=Math.floor(window.innerWidth/a);m3dcache.v.vh=Math.floor(window.innerHeight/a);apscene.renderer.setSize(m3dcache.v.vw,m3dcache.v.vh);apscene.renderer.setClearColor(0,1);0==m3dcache.v.shadows?apscene.renderer.shadowMapEnabled=!1:(apscene.renderer.shadowMapEnabled=!0,apscene.renderer.shadowMapAutoUpdate=!0,apscene.renderer.shadowMapAutoUpdate=!1,apscene.renderer.shadowMapType=THREE.PCFSoftShadowMap,apscene.renderer.shadowMapSoft=!0);
apscene.renderer.shadowMapBias=.0039;apscene.renderer.shadowMapDarkness=.5;apscene.renderer.shadowMapWidth=8;apscene.renderer.shadowMapHeight=8;apscene.scene=new THREE.Scene;apscene.camera=new THREE.PerspectiveCamera(70,m3dcache.v.vw/m3dcache.v.vh,1,700);apscene.camera.setViewOffset(m3dcache.v.vw,m3dcache.v.vh,0,0,m3dcache.v.vw,m3dcache.v.vh);apscene.camera.position.x=0;apscene.camera.position.y=10;apscene.camera.position.z=0;look={position:{x:0,y:400,z:0}};mouse=new THREE.Vector2;apscene.INTERSECTED=
"";apscene.INTERSECTED.intGroup=-1;apscene.raycaster=new THREE.Raycaster;SFog=new THREE.FogExp2(10066329,8E-4);apscene.scene.fog=SFog;apscene.renderer.domElement.style.position="absolute";apscene.renderer.domElement.style.top=0;apscene.renderer.domElement.style.zIndex=-10;apscene.renderer.domElement.style.backgroundColor="#000000";apscene.renderer.domElement.id="renderer";document.body.appendChild(apscene.renderer.domElement);m3dcache.v.init3D=!0;vector=new THREE.Vector3;apscene.raycaster=new THREE.Raycaster;
dir=new THREE.Vector3;apscene.renderer.domElement.style.display="none";m3dcache.v.init3Dfail=!1},mnMinify:function(){m3d.lib.postMessageSendParent("main_apLoaded_minify",m3dcache.i.corehost);m3d.ui.mnOff(["m3d_nav1","m3d_nav2"]);m3d.ui.ref()},mnMainControls:function(){1==mn.m3d_nav1.on?mn.m3d_nav1.sw==mnb.m3d_navw_x2?(mn.m3d_nav1.bts=mnb.m3d_nav1,mn.m3d_nav1.btd=mnb.m3d_nav1btd,mn.m3d_nav2.bts=mnb.m3d_nav2,mn.m3d_nav2.btd=mnb.m3d_nav2btd,mn.m3d_nav1.sw=mnb.m3d_navw,mn.m3d_nav1.sh=mnb.m3d_navh,mn.m3d_nav1.sw2=
mnb.m3d_navw2,mn.m3d_nav1.sh2=mnb.m3d_navh2,mn.m3d_nav2.sw=mnb.m3d_navw,mn.m3d_nav2.sh=mnb.m3d_navh,mn.m3d_nav2.sw2=mnb.m3d_navw2,mn.m3d_nav2.sh2=mnb.m3d_navh2,m3d.lib.postMessageSendParent("main_btClick_main1_off",m3dcache.i.corehost),mn.m3d_nav1.on=!1,mn.m3d_nav2.on=!1):(m3d.lib.postMessageSendParent("main_btClick_main1_x2",m3dcache.i.corehost),mn.m3d_nav1.bts=mnb.m3d_nav1_x2,mn.m3d_nav1.btd=mnb.m3d_nav1btd_x2,mn.m3d_nav2.bts=mnb.m3d_nav2_x2,mn.m3d_nav2.btd=mnb.m3d_nav2btd_x2,mn.m3d_nav1.sw=mnb.m3d_navw_x2,
mn.m3d_nav1.sh=mnb.m3d_navh_x2,mn.m3d_nav1.sw2=mnb.m3d_navw2_x2,mn.m3d_nav1.sh2=mnb.m3d_navh2_x2,mn.m3d_nav2.sw=mnb.m3d_navw_x2,mn.m3d_nav2.sh=mnb.m3d_navh_x2,mn.m3d_nav2.sw2=mnb.m3d_navw2_x2,mn.m3d_nav2.sh2=mnb.m3d_navh2_x2):(m3d.lib.postMessageSendParent("main_btClick_main1_on",m3dcache.i.corehost),mn.m3d_nav1.on=!0,mn.m3d_nav2.on=!0);m3d.core.menuSetPos();var a=!1;"undefined"!==typeof ap&&"undefined"!==typeof ap.ref&&(a=!0);1==a?ap.ref():m3d.ui.ref();m3d.lib.playSound("click1")},mnMainControlsSetPosNav:function(){mn.m3d_nav1.sw==
mnb.m3d_navw_x2?(mn.m3d_nav1.bts=mnb.m3d_nav1_x2,mn.m3d_nav1.btd=mnb.m3d_nav1btd_x2,mn.m3d_nav2.bts=mnb.m3d_nav2_x2,mn.m3d_nav2.btd=mnb.m3d_nav2btd_x2,mn.m3d_nav1.sw=mnb.m3d_navw_x2,mn.m3d_nav1.sh=mnb.m3d_navh_x2,mn.m3d_nav1.sw2=mnb.m3d_navw2_x2,mn.m3d_nav1.sh2=mnb.m3d_navh2_x2,mn.m3d_nav2.sw=mnb.m3d_navw_x2,mn.m3d_nav2.sh=mnb.m3d_navh_x2,mn.m3d_nav2.sw2=mnb.m3d_navw2_x2,mn.m3d_nav2.sh2=mnb.m3d_navh2_x2):(mn.m3d_nav1.bts=mnb.m3d_nav1,mn.m3d_nav1.btd=mnb.m3d_nav1btd,mn.m3d_nav2.bts=mnb.m3d_nav2,mn.m3d_nav2.btd=
mnb.m3d_nav2btd,mn.m3d_nav1.sw=mnb.m3d_navw,mn.m3d_nav1.sh=mnb.m3d_navh,mn.m3d_nav1.sw2=mnb.m3d_navw2,mn.m3d_nav1.sh2=mnb.m3d_navh2,mn.m3d_nav2.sw=mnb.m3d_navw,mn.m3d_nav2.sh=mnb.m3d_navh,mn.m3d_nav2.sw2=mnb.m3d_navw2,mn.m3d_nav2.sh2=mnb.m3d_navh2)},mnPersonX2:function(){mn.m3d_nav1.w==mnb.m3d_navw_x2?(m3d.core.mnButtonColor("main",1,"green"),mn.m3d_nav1.bts=mnb.m3d_nav1,mn.m3d_nav1.btd=mnb.m3d_nav1btd,mn.m3d_nav2.bts=mnb.m3d_nav2,mn.m3d_nav2.btd=mnb.m3d_nav2btd,mn.m3d_nav1.w=mnb.m3d_navw,mn.m3d_nav1.h=
mnb.m3d_navh,mn.m3d_nav1.w2=mnb.m3d_navw2,mn.m3d_nav1.h2=mnb.m3d_navh2,mn.m3d_nav2.w=mnb.m3d_navw,mn.m3d_nav2.h=mnb.m3d_navh,mn.m3d_nav2.w2=mnb.m3d_navw2,mn.m3d_nav2.h2=mnb.m3d_navh2):(mn.m3d_nav1.bts=mnb.m3d_nav1_x2,mn.m3d_nav1.btd=mnb.m3d_nav1btd_x2,mn.m3d_nav2.bts=mnb.m3d_nav2_x2,mn.m3d_nav2.btd=mnb.m3d_nav2btd_x2,mn.m3d_nav1.w=mnb.m3d_navw_x2,mn.m3d_nav1.h=mnb.m3d_navh_x2,mn.m3d_nav1.w2=mnb.m3d_navw2_x2,mn.m3d_nav1.h2=mnb.m3d_navh2_x2,mn.m3d_nav2.w=mnb.m3d_navw_x2,mn.m3d_nav2.h=mnb.m3d_navh_x2,
mn.m3d_nav2.w2=mnb.m3d_navw2_x2,mn.m3d_nav2.h2=mnb.m3d_navh2_x2);m3d.core.menuSetPos();mn.m3d_nav1.on=!0;mn.m3d_nav2.on=!0;m3d.core.mnMainButtonOff();m3d.ui.ref();m3d.lib.playSound("click1")},mnPersonSetGraph:function(){m3d.core.mnPersonViewDistance()},mnCross2CustomGraph:function(){apctx.drawImage(m3d.core.mnbk.mset,3,96,250,16,mn.crosssetgraph.xpos+112,mn.crosssetgraph.ypos+13,250,16)},mnPersonSetGraph2Close:function(){mn.setgraph.on=!1;mn.crosssetgraph.on=!1;mn.m3d_slide1.on=!1;m3d.ui.ref();m3d.lib.playSound("click2")},
mnPersonViewDistance:function(){1==mn.m3d_slide1.on?mn.m3d_slide1.on=!1:(apscene.camera.far=700,mn.m3d_slide1.on=!0,mn.m3d_slide1.sxpos=0,mn.m3d_slide1.sypos=m3d.core.levely0+46-18,mn.m3d_slide1.xpos=mn.m3d_slide1.sxpos,mn.m3d_slide1.ypos=mn.m3d_slide1.sypos,mn.m3d_slide1.xpos=0,mn.m3d_slide1.slided.ypos=m3d.core.levely0+46-18);var a=!1;"undefined"!==typeof ap&&"undefined"!==typeof ap.ref&&(a=!0);1==a?ap.ref():m3d.ui.ref();m3d.lib.playSound("click1")},mnPersonShadowsDistance:function(){},mnPersonGraphics:function(){},
mnPersonSound:function(){},getCameraFar:function(){return 3300-Math.floor((m3dcache.v.vdist2-m3dcache.v.vdist1)*mn.m3d_slide1.btd[1]/(mn.m3d_slide1.h-66))},mnPersonViewDistanceSlide:function(a){mn.m3d_slide1.slided.y2>mn.m3d_slide1.slided.ypos+26+20&mn.m3d_slide1.slided.y2<mn.m3d_slide1.slided.ypos+mn.m3d_slide1.sh-20-10&&(mn.m3d_slide1.btd[1]+=mn.m3d_slide1.slided.y2-mn.m3d_slide1.slided.y1,m3d.ui.pCl[a][1]=mn.m3d_slide1.btd[1]+mn.m3d_slide1.sypos,m3d.ui.pCl[a][3]=mn.m3d_slide1.btd[1]+mn.m3d_slide1.sypos+
mnb.m3d_slide1[0][0],m3d.ui.refBk(m3d.ui.pCl[a][5],!0),m3d.ui.refBt(a,1,1,!1,!1),m3d.core.mnPersonViewDistanceSlideCustom(),apscene.camera.far=m3d.core.getCameraFar(),m3d.core.statLog(apscene.camera.far+" slide move to "+mn.m3d_slide1.btd[1]+": y1="+mn.m3d_slide1.slided.y1+": y2="+mn.m3d_slide1.slided.y2),mn.m3d_slide1.slided.y1=mn.m3d_slide1.slided.y2)},mnPersonViewDistanceSlideCustom:function(){var a=mn.m3d_slide1.slided.xpos+8,b=mn.m3d_slide1.slided.ypos+8;"undefined"!==typeof apscene.camera.far&&
m3d.lib.Tex2Canvas(apctx,apscene.camera.far.toString(),"normal 12px Dshiline",11,"#00DD00",a+5,b+16,64,0,"center","top")},mnPersonLog:function(){"block"==document.getElementById("dstatlog").style.display?(m3dcache.v.loggingon=!1,m3d.core.statLog=function(){},m3d.core.statLog2=function(){},document.getElementById("dstatlog").style.display="none",document.getElementById("dstatlog1").innerHTML="",document.getElementById("dstatlog2").innerHTML=""):(m3dcache.v.loggingon=!0,m3d.core.statLog=m3d.core.statLogFunc,
m3d.core.statLog2=m3d.core.statLog2Func,m3d.lib.statLog=m3d.core.statLogFunc,m3d.lib.statLog2=m3d.core.statLog2Func,document.getElementById("dstatlog").style.display="block");m3d.ui.ref()},statLogFunc:function(a){1==m3dcache.v.loggingon&&(document.getElementById("dstatlog1").innerHTML=a+"<br/>"+document.getElementById("dstatlog1").innerHTML)},statLog2Func:function(a){1==m3dcache.v.loggingon&&(document.getElementById("dstatlog2").innerHTML=a+"<br/>"+document.getElementById("dstatlog2").innerHTML)},
statLog:function(){},statLog2:function(){},mnCalendarText:function(a){},mnCalendarTextF:function(a){a=m3d.graph.skydom.par.cur;a=a.date+"."+a.month+"."+a.year+"<br/>"+a.hr+":"+a.mn+"<br/>alt "+a.alt;var b=m3d.graph.skydom.par.calendarCtx();mn.calendar.on=!0;var c=mn.calendar.xpos,d=mn.calendar.ypos,f=mn.calendar.w;m3d.ui.eraseArea(b,"calendar",c,d,f,mn.calendar.h,0,0);m3d.lib.Tex2Canvas(b,a,"bold 20px Arial",22,"#FFFFFF",c+10,d+20,f-20,0,"center","top")},mnInfoCustom:function(){},mnInfoHide:function(){0==
m3dcache.v.blockinfo&&1==mn.info.on&&(m3dcache.d.loc.curInt="",mn.info.on=!1,m3d.ui.clearArea(mn.info,mn.info.xpos,mn.info.ypos,mn.info.w,mn.info.h),elcanv.style.cursor="default")},mnInfoText:function(a){mn.info.on=!0;var b=mn.info.xpos,c=mn.info.ypos,d=mn.info.w;m3d.ui.eraseArea(apctx,"info",b,c,d,mn.info.h,0,0);m3d.lib.Tex2Canvas(apctx,a,"bold 12px Arial",14,"#66DD66",b+10,c+30,d-20,0,"center","top")},mnInfoUpdate:function(a,b){if(0==m3dcache.v.blockinfo)if("undefined"==typeof m3dcache.d.loc.objInters[a][b])m3dcache.d.loc.curInt=
"",mn.info.on=!1,m3d.ui.clearArea(mn.info,mn.info.xpos,mn.info.ypos,mn.info.w,mn.info.h),elcanv.style.cursor="default";else{var c=m3dcache.d.loc.objInters[a][b];if(""==c)m3dcache.d.loc.curInt="",mn.info.on=!1,m3d.ui.clearArea(mn.info,mn.info.xpos,mn.info.ypos,mn.info.w,mn.info.h),elcanv.style.cursor="default";else{var d="";act="\u043d\u0435\u0442";if(c!=m3dcache.d.loc.curInt){mn.info.on=!0;elcanv.style.cursor="pointer";var f=mn.info.xpos,e=mn.info.ypos,g=mn.info.w,d=mn.info.h;if("menu"==c){var h=
m3dcache.d.loc.menu3dIds[b];m3dcache.d.loc.curInt!=c+h&&(m3dcache.d.loc.curInt=c+h,m3d.ui.eraseArea(apctx,"info",f,e,g,d,0,0),d=ap.locd.menu3d[h][7],m3d.lib.Tex2Canvas(apctx,d,"bold 12px Arial",14,"#66DD66",f+10,e+30,g-20,0,"center","top"),d="\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0435: "+ap.locd.menu3d[h][8],m3d.lib.Tex2Canvas(apctx,d,"normal 11px Arial",14,"#F4E8B5",f,e+45,g,0,"center","top"))}else"menu_sub1"==c?(h=m3dcache.d.loc.menu3dIds[b],m3dcache.d.loc.curInt!=c+h&&(m3dcache.d.loc.curInt=
c+h,m3d.ui.eraseArea(apctx,"info",f,e,g,d,0,0),d=ap.locd.menu3d[h][7],m3d.lib.Tex2Canvas(apctx,d,"bold 12px Arial",14,"#66DD66",f+10,e+30,g-20,0,"center","top"),d="\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0435: "+ap.locd.menu3d[h][8],m3d.lib.Tex2Canvas(apctx,d,"normal 11px Arial",14,"#F4E8B5",f,e+60,g,0,"center","top"))):"apt"==c?(h=m3dcache.d.loc.objIntersDataId[0][b].data,m3dcache.d.loc.curInt=c,m3d.ui.eraseArea(apctx,"info",f,e,g,d,0,0),d=worldObj[c].name,m3d.lib.Tex2Canvas(apctx,d,"bold 12px Arial",
14,"#66DD66",f+10,e+30,g-20,0,"center","top"),d="\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0435: "+h[11][0],m3d.lib.Tex2Canvas(apctx,d,"normal 11px Arial",14,"#F4E8B5",f,e+60,g,0,"center","top")):(m3dcache.d.loc.curInt=c,m3d.ui.eraseArea(apctx,"info",f,e,g,d,0,0),m3d.lib.Tex2Canvas(apctx,"\u041e\u0431\u044a\u0435\u043a\u0442:<br/>\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u0435:<br/>\u0412\u043b\u0430\u0434\u0435\u043b\u0435\u0446:<br/>\u041f\u0435\u0440\u0435\u043c\u0435\u0449\u0430\u0435\u043c\u043e:<br/>\u0426\u0435\u043d\u0430:",
"normal 11px Arial",14,"#66DD66",f+38,e+29,77,0,"right","top"),d=worldObj[c].name+"<br/>"+act+"<br/>\u043d\u0435 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d<br/>\u043d\u0435\u0442<br/>\u0431\u0435\u0441\u043f\u043b\u0430\u0442\u043d\u043e",m3d.lib.Tex2Canvas(apctx,d,"normal 11px Arial",14,"#F4E8B5",f+18+100,e+29,119,0,"left","top"))}}}},mnTeleportMap:function(){contr.controlsMode=2;mn.m3d_mexit.block=!0;mn.m3d_mexitvar.block=!0;m3dcache.v.blockinfo=!0;mn.tmap.data={direction0:contr.direction,
angle0:contr.angle,direction:0,angle:0,ddir:0-contr.direction,dang:0-contr.angle,maxa:contr.maxAngle,mina:contr.minAngle};contr.maxAngle=1E5;contr.minAngle=-1E5;mn.tmap.data.direction=contr.direction+mn.tmap.data.ddir;mn.tmap.data.angle=contr.angle+mn.tmap.data.dang;m3d.core.mnButtonColor("teleport",3,"green");m3d.ui.ref();m3d.lib.playSound("click2");m3d.core.mapLayersPrepare();m3d.lib.loadImagesAsyncList(["location/dion_center/model/","map.png?v="+m3dconf.ver],m3d.core.mnbk,["tmap"],m3d.lib.nullFunc,
0,function(){setTimeout(function(){"undefined"==typeof m3d.core.mnbk.mbk1?m3d.lib.loadImagesAsyncList(["i/",m3dcache.v.thm+"_mbk1.png?v="+m3dconf.ver],m3d.core.mnbk,["mbk1"],m3d.lib.nullFunc,0,function(){setTimeout(function(){m3d.core.mnTeleportMap2()},20)}):m3d.core.mnTeleportMap2()},20)})},mnTeleportMap2:function(){mn.tmap.on=!0;mn.tmapc.on=!0;mn.tmapb.on=!0;m3d.ui.ref()},mapLayersPrepare:function(){apw.locd_world_apt=[];for(var a="",a="",b=0;b<apw.locd_world_dion_keys.length;b++)for(var a=apw.locd_world_dion_keys[b],
a=apw.locd_world[a[0]][a[1]][a[2]],c=0;c<a.length;c++)"apt"==a[c][8]&&"shops"!=a[c][0].substr(0,5)&&"land"!=a[c][0].substr(0,4)&&apw.locd_world_apt.push([a[c][0],Math.floor(a[c][3]/5)+725,Math.floor(a[c][4]/5)+225+500+50,a[c][5],a[c][10],a[c][11]])},imgClip:function(a,b,c,d,f,e,g,h){var m=0,q=0,n=0,l=m=0,p=0,r=n=0,n=2*c+(f+g-c+a),m=2*d+(e+h-d+b),n=n-f,r=m-e,m=2*c-n,q=2*d-r,l=f,p=e;0>m&&(n+=m,l-=m,m=0);m>2*c&&(m=2*c);0>q&&(r+=q,p-=q,q=0);q>2*d&&(q=2*d);n>2*g-l+f&&(n=2*g-l+f);0>n&&(n=0);r>2*h-p+e&&
(r=2*h-p+e);0>r&&(r=0);return[m,q,n,r,l,p,n,r]},mnTeleportMapCustom:function(){apctx.globalAlpha=.9;apctx.fillStyle="#999999";apctx.fillRect(mn.tmap.xpos-5,mn.tmap.ypos-5,mn.tmap.w+10,mn.tmap.h+10);apctx.strokeStyle="#000000";apctx.strokeRect(mn.tmap.xpos-6,mn.tmap.ypos-6,mn.tmap.w+12,mn.tmap.h+12);apctx.fillStyle="#000000";apctx.fillRect(mn.tmap.xpos,mn.tmap.ypos,mn.tmap.w,mn.tmap.h);apctx.globalAlpha=1;apctx.strokeStyle="#999999";apctx.strokeRect(mn.tmap.xpos,mn.tmap.ypos,mn.tmap.w,mn.tmap.h);apctx.strokeStyle=
"#000000";apctx.strokeRect(mn.tmap.xpos+18.5,mn.tmap.ypos+26.5,mn.tmap.w-37,mn.tmap.h-53);apctx.drawImage(m3d.core.mnbk.mbk1,510,240,10,360,mn.tmap.xpos+1,mn.tmap.ypos+mn.tmap.h2-180,10,360);apctx.drawImage(m3d.core.mnbk.mbk1,510,240,10,360,mn.tmap.xpos+mn.tmap.w-11,mn.tmap.ypos+mn.tmap.h2-180,10,360);apctx.drawImage(m3d.core.mnbk.mbk1,2,770,520,22,mn.tmap.xpos+mn.tmap.w2-260,mn.tmap.ypos+2,520,22);apctx.drawImage(m3d.core.mnbk.mbk1,2,770,520,22,mn.tmap.xpos+mn.tmap.w2-260,mn.tmap.ypos+mn.tmap.h-
24,520,22);m3d.lib.Tex2Canvas(apctx,"\u0413\u043e\u0440\u043e\u0434 \u0414\u0438\u043e\u043d","normal 14px Arial",14,"#CCCCCC",mn.tmap.xpos,mn.tmap.ypos+18,mn.tmap.w,0,"center","top");m3d.core.mnTeleportMapMove()},mnTeleportMapMove:function(){mn.tmap.data.direction=contr.direction+mn.tmap.data.ddir;mn.tmap.data.angle=contr.angle+mn.tmap.data.dang;var a=Math.floor(100*mn.tmap.data.direction),b=Math.floor(200*mn.tmap.data.angle),c=Math.floor(m3d.core.mnbk.tmap.width/2),d=Math.floor(m3d.core.mnbk.tmap.height/
2);apctx.fillStyle="#333333";apctx.fillRect(mn.tmap.xpos+20,mn.tmap.ypos+28,mn.tmap.w-40,mn.tmap.h-56);a=m3d.core.imgClip(a,b,c,d,mn.tmap.xpos+20,mn.tmap.ypos+28,mn.tmap.w2-20,mn.tmap.h2-28);0<a[2]&0<a[3]&&(apctx.drawImage(m3d.core.mnbk.tmap,a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7]),3==mn.tmapb.set[0]&&m3d.core.mapLayer("free",a));apcontrolsRenderBack()},mapLayer:function(a,b){var c="",d=b[2],f=b[3],e=[0,0];"free"==a&&(e=[414,1004]);for(var g=0;g<apw.locd_world_apt.length;g++)c=apw.locd_world_apt[g],
c[1]>b[0]&c[1]<b[0]+d-50&c[2]>b[1]&c[2]<b[1]+f-50&&apctx.drawImage(m3d.core.mnbk.mstd,e[0],e[1],50,50,c[1]+b[4]-b[0],c[2]+b[5]-b[1],50,50)},mnTeleportMapClose:function(){contr.controlsMode=1;mn.m3d_dyn1.on=!1;mn.m3d_mexit.block=!1;mn.m3d_mexitvar.block=!1;m3dcache.v.blockinfo=!1;mn.tmap.on=!1;mn.tmapc.on=!1;mn.tmapb.on=!1;contr.maxAngle=mn.tmap.data.maxa;contr.minAngle=mn.tmap.data.mina;contr.angle=mn.tmap.data.angle0;contr.direction=mn.tmap.data.direction0;mn.tmap.data={};m3d.core.mnbk.tmap=void 0;
m3d.core.mnButtonColor("teleport",3,"gray");m3d.ui.ref();m3d.lib.playSound("click2")},mnMapFree:function(){mn.tmapb.set[0]=1==mn.tmapb.set[0]?3:1;m3d.ui.ref()},mnMapFriends:function(){mn.tmapb.set[1]=1==mn.tmapb.set[1]?3:1;m3d.ui.ref()},mnMapTeleport:function(){mn.tmapb.set[2]=1==mn.tmapb.set[2]?3:1;m3d.ui.ref()},setViewPortCameraF:function(){var a=mn.camera.w,b=mn.camera.h;apscene.renderer.setViewport(mn.camera.xpos,m3dcache.v.vh-mn.camera.h-mn.camera.ypos,a,b);apscene.camera.aspect=a/b;apscene.camera.setViewOffset(a,
b,0,0,a,b);apscene.camera.updateProjectionMatrix();"undefined"!==typeof apscene.camerab&&(apscene.camerab.aspect=a/b,apscene.camerab.setViewOffset(a,b,0,0,a,b),apscene.camerab.updateProjectionMatrix(),apscene.camerab.fov=40);apscene.camera.fov=40;apscene.camera.far=15E3;contr.shl=4E3;contr.shr=-4E3;contr.sht=4E3;contr.shb=-4E3;contr.cameraForShadowXold=apscene.camera.position.x-contr.cameraForShadowStep-10;contr.controlsUpdateCamera()},mnCameraCustom:function(){apctx.fillStyle="#000000";apctx.strokeStyle=
"#333333";apctx.fillRect(mn.camera.xpos-58.5,mn.camera.ypos-10.5,mn.camera.w+117,mn.camera.h+21);apctx.fillStyle="#333333";apctx.strokeStyle="#000000";apctx.fillRect(mn.camera.xpos-6,mn.camera.ypos-6,mn.camera.w+12,mn.camera.h+12);apctx.clearRect(mn.camera.xpos,mn.camera.ypos,mn.camera.w,mn.camera.h);apctx.strokeRect(mn.camera.xpos,mn.camera.ypos,mn.camera.w,mn.camera.h);apctx.strokeStyle="#999999";apctx.beginPath();apctx.moveTo(mn.camera.xpos+mn.camera.w2-20.5,mn.camera.ypos+mn.camera.h2);apctx.lineTo(mn.camera.xpos+
mn.camera.w2+20.5,mn.camera.ypos+mn.camera.h2);apctx.moveTo(mn.camera.xpos+mn.camera.w2,mn.camera.ypos+mn.camera.h2-20.5);apctx.lineTo(mn.camera.xpos+mn.camera.w2,mn.camera.ypos+mn.camera.h2+20.5);apctx.closePath();apctx.stroke()},mnSound:function(){},mnMailCamera:function(){if(0==m3dcache.v.camerafOn){mn.m3d_mexit.block=!0;mn.m3d_mexitvar.block=!0;m3d.ui.layersDiv.m3d_mexitvar.div.style.display="none";mn.m3d_nav1.block=!0;mn.m3d_nav2.block=!0;m3dcache.v.camerafOn=!0;m3d.ui.mnOff(["m3d_mexitvar",
"m3d_slide1"]);m3d.core.mnInfoHide();m3dcache.v.blockinfo=!0;var a=!1;"undefined"!==typeof ap&&"undefined"!==typeof ap.ref&&(a=!0);1==a?ap.ref():m3d.ui.ref();m3d.lib.playSound("click1");m3d.core.mnMailCamera2()}},mnMailCamera2:function(){mn.camera.on=!0;mn.m3d_camerafzoom.on=!0;"undefined"!==typeof apscene.camera.fov&&("undefined"!==typeof apscene.camerab&&(mn.camera.data.bkfov=apscene.camerab.fov),mn.camera.data.fov=apscene.camera.fov,mn.camera.data.far=apscene.camera.far,mn.camera.data.shl=contr.shl,
mn.camera.data.shr=contr.shr,mn.camera.data.sht=contr.sht,mn.camera.data.shb=contr.shb,m3d.core.setViewPortCameraF());m3d.core.setCameraZoomSlider();var a=!1;"undefined"!==typeof ap&&"undefined"!==typeof ap.ref&&(a=!0);1==a?ap.ref():m3d.ui.ref();m3d.contr.renderAll()},toData:function(){var a=mn.camera.w,b=mn.camera.h,c=mn.camera.xpos,d=m3dcache.v.vh-mn.camera.h-mn.camera.ypos,f="",e="",e=document.createElement("canvas");e.width=a;e.height=b;e.style.width=a+"px";e.style.height=b+"px";f=e.getContext("2d");
f.clearRect(0,0,a,b);f.drawImage(apscene.renderer.domElement,c,d,a,b-1,0,0,a,b);a=window.open("","");a.document.title="M3D "+Date.now();a.document.body.style.backgroundColor="#000000";b=new Image;b.src=e.toDataURL();a.document.body.appendChild(b)},mnCameraShoot:function(){apscene.renderer.preserveDrawingBuffer=!0;m3d.contr.renderAll();m3d.core.toData();apscene.renderer.preserveDrawingBuffer=!1},mnCameraLoad:function(){},mnCameraZoom:function(a){mn.m3d_camerafzoom.slided.y2>mn.m3d_camerafzoom.ypos+
26&mn.m3d_camerafzoom.slided.y2<mn.m3d_camerafzoom.ypos+mn.m3d_camerafzoom.h-20&&(mn.m3d_camerafzoom.btd[1]+=mn.m3d_camerafzoom.slided.y2-mn.m3d_camerafzoom.slided.y1,m3d.ui.pCl[a][1]=mn.m3d_camerafzoom.btd[1]+mn.m3d_camerafzoom.ypos,m3d.ui.pCl[a][3]=mn.m3d_camerafzoom.btd[1]+mn.m3d_camerafzoom.ypos+mnb.m3d_camerafzoom[0][0],m3d.ui.refBk(m3d.ui.pCl[a][5],!0),m3d.ui.refBt(a,1,1,!1,!1),apscene.camera.fov=m3d.core.getCameraZoom(),"undefined"!==typeof apscene.camerab&&(apscene.camerab.fov=apscene.camera.fov),
mn.m3d_camerafzoom.slided.y1=mn.m3d_camerafzoom.slided.y2)},mnCameraZoomCustom:function(){},getCameraZoom:function(){var a=Math.floor(180*mn.m3d_camerafzoom.btd[1]/(mn.m3d_camerafzoom.h-60))-10;1>a&&(a=1);179<a&&(a=179);return a},setCameraZoomSlider:function(){mn.m3d_camerafzoom.btd[1]=Math.floor((apscene.camera.fov+10)*(mn.m3d_camerafzoom.h-60)/180)},mnCameraAngle:function(){},mnCameraAngleCustom:function(){},mnCameraClose:function(){m3dcache.v.blockinfo=!1;mn.camera.on=!1;mn.m3d_camerafzoom.on=
!1;mn.m3d_camerafangle.on=!1;mn.m3d_mexit.block=!1;mn.m3d_mexitvar.block=!1;mn.m3d_nav1.block=!1;mn.m3d_nav2.block=!1;m3dcache.v.camerafOn=!1;"undefined"!==typeof apscene.camera.fov&&("undefined"!==typeof apscene.camerab&&(apscene.camerab.fov=mn.camera.data.bkfov),apscene.camera.fov=mn.camera.data.fov,apscene.camera.far=mn.camera.data.far,contr.shl=mn.camera.data.shl,contr.shr=mn.camera.data.shr,contr.sht=mn.camera.data.sht,contr.shb=mn.camera.data.shb,contr.cameraForShadowXold=apscene.camera.position.x-
contr.cameraForShadowStep-10,contr.controlsUpdateCamera());m3d.core.mnInfoHide();m3d.resize.onWindowResize(0);m3d.ui.ref();m3d.contr.renderAll()},menuSetSubmenuBtText:function(a,b){mn[a].btt=[];mn[a].bttxy=[];for(var c=mn[a],d="",f=0,e=0,g=0;g<c.bt.length;g++)d=ap.menu3dSub1[m3dcache.d.loc.nav.submenu1].refs[g],f=c.xpos+c.btd[2*g],e=c.ypos+c.btd[2*g+1]+17,mn[a].btt.push(d),mn[a].bttxy.push(f),mn[a].bttxy.push(e)},mnNav1up:function(){},mnNav1up1:function(){m3d.core.statLog("f nav up start");contr.tchState.fw=
!0},mnNav1up2:function(){m3d.core.statLog("f nav up end");contr.tchState.fw=!1},mnNav1dn:function(){},mnNav1dn1:function(){contr.tchState.bk=!0},mnNav1dn2:function(){contr.tchState.bk=!1},mnNav1side:function(){},mnNav1side1:function(){},mnNav1side2:function(){m3d.lib.playSound("click2");contr.steering=0==contr.steering?!0:!1},mnNav1run:function(){},mnNav1run1:function(){},mnNav1run2:function(){m3d.lib.playSound("click2");contr.speed=contr.speed==contr.speedLow?contr.speedHigh:contr.speedLow},mnNav2fire:function(){},
mnNav2fire1:function(){},mnNav2fire2:function(){ap.mnNav2fire2MyLocation()},mnNav2rt:function(){},mnNav2rt1:function(){contr.tchState.rt=!0},mnNav2rt2:function(){contr.tchState.rt=!1},mnNav2take:function(){},mnNav2take1:function(){},mnNav2take2:function(){ap.mnNav2take2MyLocation()},mnNav2lt:function(){},mnNav2lt1:function(){contr.tchState.lt=!0;ap.mnNav2LeftMyLocation()},mnNav2lt2:function(){contr.tchState.lt=!1},initEvents:function(){m3d.core.initEventsList("keyup keydown touchstart touchmove touchend blur touchcancel orientationchange resize gamepad".split(" "))},
initEventsList:function(a){ev={contextmenu:function(){document.oncontextmenu=function(a){(a||window.event).preventDefault();return!1}},keyup:function(){window.onkeyup=function(a){m3d.contr.controlsKeyUp(a||window.event)}},keydown:function(){window.onkeydown=function(a){m3d.contr.controlsKeyDn(a||window.event)}},touchstart:function(){m3d.lib.addListner(window,"touchstart",function(a){m3d.contr.constrolsTouchStart(a)})},touchmove:function(){m3d.lib.addListner(window,"touchmove",function(a){m3d.contr.constrolsTouchMove(a)})},
touchend:function(){m3d.lib.addListner(window,"touchend",function(a){m3d.contr.constrolsTouchEnd(a)})},blur:function(){m3d.lib.addListner(window,"blur",function(a){m3d.contr.controlsAllButtonsOff(a)})},touchcancel:function(){m3d.lib.addListner(window,"touchcancel",function(a){m3d.core.statLog("touch cancel");contr.touchMoveFlag=!1})},orientationchange:function(){m3d.lib.addListner(window,"orientationchange",function(a){})},gamepad:function(){window.addEventListener("gamepadconnected",function(a){"undefined"!==
typeof m3d.gamepad&&(a=navigator.getGamepads(),m3d.gamepad.init(a))})},resize:function(){m3d.resize.user=m3d.resize.onWindowResize;window.addEventListener("resize",m3d.resize.ev,!1)}};for(var b=0;b<a.length;b++)ev[a[b]]()},onWindowResize:function(a){m3d.resize.onWindowResize(a)},commonMenuOn:function(){}},audio:{audioExt:"",setAudio:1,initAudio:function(){var a=document.createElement("audio");""!=a.canPlayType("audio/mp3")?this.audioExt="mp3":""!=a.canPlayType('audio/ogg; codecs="vorbis"')&&(this.audioExt=
"ogg");this.playa=function(a){""!=m3d.audio.audioExt&&0<m3d.audio.setAudio&&a.play()};this.playaloop=function(a){""!=m3d.audio.audioExt&&0<m3d.audio.setAudio&&(a.play(),a.loop=!0)};this.stopa=function(a){""!=m3d.audio.audioExt&&0!=a.currentTime&&(a.pause(),a.currentTime=0)}},loadAudioAsyncList:function(a,b,c,d,f,e){m3d.audio.loadAudioAsyncD={callb:e,cpar:f,callbi:d,n:a.length,posdata:c,i:0};2>a.length?m3d.audio.loadAudioAsyncD.callb(m3d.audio.loadAudioAsyncD.cpar):setTimeout(function(){0==m3d.audio.loadAudioAsyncD.i&&
(m3d.audio.loadAudioAsyncD.i=m3d.audio.loadAudioAsyncD.n-1,m3d.audio.loadAudioAsyncD.callb(m3d.audio.loadAudioAsyncD.cpar))},5E3);for(c=1;c<a.length;c++)""==this.audioExt?(b[m3d.audio.loadAudioAsyncD.posdata[c-1]]=a[0]+a[c],m3d.audio.loadAudioAsyncD.i++,m3d.audio.loadAudioAsyncD.i==m3d.audio.loadAudioAsyncD.n-1&&m3d.audio.loadAudioAsyncD.callb(m3d.audio.loadAudioAsyncD.cpar)):(b[m3d.audio.loadAudioAsyncD.posdata[c-1]]=document.createElement("audio"),b[m3d.audio.loadAudioAsyncD.posdata[c-1]].addEventListener("loadeddata",
function(){m3d.audio.loadAudioAsyncD.callbi();m3d.audio.loadAudioAsyncD.i++;m3d.audio.loadAudioAsyncD.i==m3d.audio.loadAudioAsyncD.n-1&&m3d.audio.loadAudioAsyncD.callb(m3d.audio.loadAudioAsyncD.cpar)},!1),b[m3d.audio.loadAudioAsyncD.posdata[c-1]].src=a[0]+a[c]+m3d.audio.audioExt,b[m3d.audio.loadAudioAsyncD.posdata[c-1]].load())}},html:{init:function(a){var b=m3d.html.htmlIFrame();document.getElementById(a).innerHTML=b},htmlIFrame:function(){return m3d.html.htmlIFrame_wrap()+'<div id="divrndrii" class="cdivrndrii"><table id="divrndriitable" style="width:100%;margin-top:0px; position:absolute;"><tr><td><div id="divrndrback" class="cdivrndrback">'+
m3d.html.htmlIFrame_divrndr()+m3d.html.htmlIFrame_divrndr2()+m3d.html.htmlIFrame_foot()+"</div></td></tr></table></div>"},htmlIFrame_wrap:function(){return'<div id="wrap" class="cwrap"></div>'},htmlIFrame_divrndr:function(){return'<div id="divrndrt" class="cdivrndr"><div class="cdivlogo"></div><div class="cdivrndri"></div></div><div id="divlng" class="cdivlng" style="display:none;"></div><div id="divrndr" class="cdivrndr"></div>'},htmlIFrame_passport:function(){return'<div id="passport" class="vis"><div id="dwav" class="cdwavw"><div id="dwav" class="cdwav"></div></div><div id="dwperson" class="cdwperson"></div><div style="height:14px;clear:both;"></div><div id="enternotauth" class="centernotauth"><div id="dwstop" class="cdwstop"></div><div id="dwinput" class="cdwinput"><span id="dwinputt1" class="cdwinputt">Login:</span><input name="login" type="text" class="form-input" tabindex="10" size="20" maxlength="70" onkeydown="m3d.graph.effects.lookAround.exit();"/>&nbsp;&nbsp;<span id="dwinputt2" class="cdwinputt">Password:</span><input name="password" type="password" class="form-input" tabindex="20" size="20" maxlength="70"/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="button" id="txtbut" class="form-button" value="&nbsp;" tabindex="30" onClick="m3d.core.btLoginCl();" /></div><div style="height:12px;"></div><div id="dwreg" class="cdwreg"></div></div><div id="enterauth" class="centerauth"><div id="dwstatus" class="cdwstatus"></div><div id="divtxtbutkey" class="cdivtxtbutkey"><input type="button" id="txtbutkey" class="ctxtbutkey" value="&nbsp;" tabindex="30" onClick="m3d.core.btEnterCl();" /></div></div></div>'},
htmlIFrame_divrndr2:function(){return'<div id="divrndrt2" class="cdivrndr"><div style="height:2px;"></div><div id="viewmode"></div></div>'},htmlIFrame_foot:function(){return'<div id="dwfoot" class="cdwfoot"><p class="ctfoot" id="tfoot" align="center"></p></div>'}},resize:{fn:function(){},timer:0,user:function(){},userstart:function(){},ev:function(a,b,c){m3d.resize.userstart();setTimeout(function(){(function(a,b){"undefined"==typeof b&&(b=function(){});"now"==a?setTimeout(function(){var c=b;m3d.resize.fn(a);
m3d.resize.user(a);c()},5):m3d.resize.timerset("refresh",a,b)})(b,c)},5)},timerset:function(a,b,c){"self"==a?Date.now()>m3d.resize.timer?(m3d.resize.fn(b),m3d.resize.user(b),c()):setTimeout(function(){m3d.resize.timerset("self",b,c)},1E3):(m3d.resize.timer=Date.now()+1E3-10,setTimeout(function(){m3d.resize.timerset("self",b,c)},1E3))},onWindowResizeAspectStart:function(){m3dcache.v.vw=window.innerWidth;m3dcache.v.vh=window.innerHeight;var a=m3d.lib.inBlock(0,0,m3dcache.setup.aspect.w,m3dcache.setup.aspect.h,
0,0,m3dcache.v.vw,m3dcache.v.vh,"center","center","resize");1>a.scale&&(m3dcache.setup.aspect.scale=a.scale,document.body.style.webkitTransform=document.body.style.msTransform=document.body.style.transform="scale("+m3dcache.setup.aspect.scale+")");m3d.resize.onWindowResize(0)},onWindowResizeCustom:function(){},onWindowResizeCustom2:function(){},onWindowResize:function(a){m3d.resize.onWindowResizeScale(!1,!1)},onWindowResizeScale:function(a){var b=1;1==a&&(b=m3dcache.setup.aspect.scale);var c=window.innerWidth,
d=window.innerHeight;"undefined"!==typeof m3dcache.v.ads&&1==m3dcache.v.ads.on&&("rt"==m3dcache.v.ads.side?c-=m3dcache.v.ads.w*b:"bt"==m3dcache.v.ads.side&&(d-=m3dcache.v.ads.h*b));m3dcache.v.vwf=Math.floor(c/b);m3dcache.v.vhf=Math.floor(d/b);m3dcache.v.vw=Math.floor(c/b);m3dcache.v.vh=Math.floor(d/b);m3dcache.v.vclipw=0;m3dcache.v.vcliph=0;if("undefined"!==typeof m3dcache.setup.aspect&&0!=m3dcache.setup.aspect.w&&0!=m3dcache.setup.aspect.h){var f=m3d.lib.inBlock(0,0,m3dcache.setup.aspect.w,m3dcache.setup.aspect.h,
0,0,m3dcache.v.vw,m3dcache.v.vh,"center","center","resize"),b=f.scale;0==a?(1<f.scale&&(b=1),f.clipx=Math.floor(f.clipx/b),f.clipy=Math.floor(f.clipy/b),f.w=Math.floor(f.w/b),f.h=Math.floor(f.h/b)):b=m3dcache.setup.aspect.scale;"undefined"!==typeof m3dcache.setup.aspect.p&&0<f.clipx&&(f.w=Math.floor(f.w*(m3dcache.setup.aspect.p/100+1)),f.w>m3dcache.v.vw&&(f.w=m3dcache.v.vw),f=m3d.lib.inBlock(0,0,f.w,f.h,0,0,m3dcache.v.vw,m3dcache.v.vh,"center","center","resize"),b=f.scale,0==a?(1<f.scale&&(b=1),f.clipx=
Math.floor(f.clipx/b),f.clipy=Math.floor(f.clipy/b),f.w=Math.floor(f.w/b),f.h=Math.floor(f.h/b)):b=m3dcache.setup.aspect.scale);0==a&&(m3dcache.setup.aspect.scale=b);c=window.innerWidth;d=window.innerHeight;if("undefined"!==typeof m3dcache.v.ads&&1==m3dcache.v.ads.on){"rt"==m3dcache.v.ads.side?c-=m3dcache.v.ads.w*b:"bt"==m3dcache.v.ads.side&&(d-=m3dcache.v.ads.h*b);a=m3dcache.v.ads.w+"px";var e=m3dcache.v.ads.h+"px";if("rt"==m3dcache.v.ads.side)var g=Math.floor(c/b)+"px",h=Math.floor((d-m3dcache.v.ads.h*
b)/b/2)+"px";else"bt"==m3dcache.v.ads.side&&(g=Math.floor((c-m3dcache.v.ads.w*b)/b/2)+"px",h=Math.floor(d/b)+"px");"canvas"==m3dcache.v.ads.tp?(m3d.ui.layers.Ads.w=m3dcache.v.ads.w,m3d.ui.layers.Ads.h=m3dcache.v.ads.h,m3d.ui.layers.Ads.divcanv.style.width=a,m3d.ui.layers.Ads.divcanv.style.height=e,m3d.ui.layers.Ads.canv.style.width=a,m3d.ui.layers.Ads.canv.style.height=e,m3d.ui.layers.Ads.divcanv.style.marginLeft=g,m3d.ui.layers.Ads.divcanv.style.marginTop=h):"div"==m3dcache.v.ads.tp&&(m3d.ui.layersDiv.Ads.div.style.width=
a,m3d.ui.layersDiv.Ads.div.style.height=e,m3d.ui.layersDiv.Ads.div.style.marginLeft=g,m3d.ui.layersDiv.Ads.div.style.marginTop=h)}document.body.style.webkitTransform=document.body.style.msTransform=document.body.style.transform="scale("+m3dcache.setup.aspect.scale+")";m3dcache.v.vclipw=f.clipx;m3dcache.v.vcliph=f.clipy;m3dcache.v.vclipwsc=f.clipx*b;m3dcache.v.vcliphsc=f.clipy*b;1==m3dcache.setup.aspect.maximize&&(f.clipx=0,f.clipy=0,m3dcache.v.vclipwsc=0,m3dcache.v.vcliphsc=0,m3dcache.v.vclipw=0,
m3dcache.v.vcliph=0,m3dcache.v.vwf=Math.floor(c/b),m3dcache.v.vhf=Math.floor(d/b),m3dcache.v.vw=Math.floor(c/b),m3dcache.v.vh=Math.floor(d/b),f.w=m3dcache.v.vw,f.h=m3dcache.v.vh);c=f.clipx+"px";g=f.clipy+"px";document.body.style.height="0px";document.body.style.width="0px";document.getElementById("m3dcontainer").style.marginLeft=c;document.getElementById("m3dcontainer").style.marginTop=g;null!==document.getElementById("renderer")&&(document.getElementById("renderer").style.marginLeft=c,document.getElementById("renderer").style.marginTop=
g);m3dcache.v.vw=f.w;m3dcache.v.vh=f.h}m3dcache.v.vw<m3dcache.wind.wmin&&(m3dcache.v.vw=m3dcache.wind.wmin);m3dcache.v.vh<m3dcache.wind.hmin&&(m3dcache.v.vh=m3dcache.wind.hmin);"undefined"!==typeof m3dcache.wind.wmax&&(m3dcache.v.vw>m3dcache.wind.wmax&&(m3dcache.v.vw=m3dcache.wind.wmax),m3dcache.v.vh>m3dcache.wind.hmax&&(m3dcache.v.vh=m3dcache.wind.hmax));m3dcache.v.vw2=Math.floor(m3dcache.v.vw/2);m3dcache.v.vh2=Math.floor(m3dcache.v.vh/2);m3dcache.v.vwf=m3dcache.v.vw;m3dcache.v.vhf=m3dcache.v.vh;
m3dcache.v.vwf<m3dcache.wind.wmin&&(m3dcache.v.vwf=m3dcache.wind.wmin);m3dcache.v.vhf<m3dcache.wind.hmin&&(m3dcache.v.vhf=m3dcache.wind.hmin);f=0;-1!=m3dcache.v.rndriih&&(f=Math.floor((d/b-m3dcache.v.rndriih)/2-m3dcache.v.vcliph)+"px");d=m3dcache.v.vw+"px";document.getElementById("divrndrii").style.marginTop=f;document.getElementById("divrndrii").style.width=d;document.getElementById("divrndriitable").style.width=d;m3dcache.v.vwf2=Math.floor(m3dcache.v.vwf/2);m3dcache.v.vhf2=Math.floor(m3dcache.v.vhf/
2);d=m3dcache.v.vwf;f=m3dcache.v.vhf;"undefined"!==typeof m3dcache.setup.mainw&&(d=m3dcache.setup.mainw/b);"undefined"!==typeof m3dcache.setup.mainh&&(f=m3dcache.setup.mainh/b);m3d.core.initCanv(d,f);"undefined"!==typeof apscene.renderer.setSize&&(apscene.renderer.setSize(m3dcache.v.vw,m3dcache.v.vh),apscene.camera.aspect=m3dcache.v.vw/m3dcache.v.vh,apscene.camera.setViewOffset(m3dcache.v.vw,m3dcache.v.vh,0,0,m3dcache.v.vw,m3dcache.v.vh),apscene.camera.updateProjectionMatrix());"undefined"!==typeof apscene.camerab&&
(apscene.camerab.aspect=m3dcache.v.vw/m3dcache.v.vh,apscene.camerab.setViewOffset(m3dcache.v.vw,m3dcache.v.vh,0,0,m3dcache.v.vw,m3dcache.v.vh),apscene.camerab.updateProjectionMatrix());"undefined"!==typeof apscene.camerab&&m3d.contr.renderAll();m3d.ui.initDefaults(mn);m3d.resize.onWindowResizeCustom();m3d.core.menuSetPos();m3d.ui.reScale(mn);m3d.ui.ref();1==m3dcache.v.camerafOn&&m3d.core.setViewPortCameraF();m3d.contr.renderAll();m3d.resize.onWindowResizeCustom2()},mnMainFullScreen:function(){var a=
document.documentElement;a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullScreen&&a.webkitRequestFullScreen()},mnMainFullScreenExit:function(){if(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement)document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&(document.webkitCancelFullScreen(),document.webkitExitFullscreen())}},
http:{init:function(){try{m3d.http.request=new XMLHttpRequest}catch(a){try{m3d.http.request=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{m3d.http.request=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){m3d.http.request=!1}}}},send:function(a,b,c,d,f){this.reqd={cb:f};m3d.http.efl=0;0==m3d.http.request.readyState&&(m3d.http.efl=1);4==m3d.http.request.readyState&&(m3d.http.efl=1);if(1==m3d.http.efl){m3d.http.request.open(a,b,!0);if(0!=d.length)for(a=0;a<d.length;a++)m3d.http.request.setRequestHeader(d[a][0],
d[a][1]);m3d.http.request.onreadystatechange=m3d.http.response;m3d.http.request.send(c)}},response:function(){4==m3d.http.request.readyState&&""!=m3d.http.reqd.cb&&m3d.http.reqd.cb(m3d.http.request)}},idb:{idbAval:!1,idbObj:{},idbTransaction:{},baseName:"",init:function(a,b,c,d){m3d.idb.baseName=a;m3d.idb.tableName=b;m3d.idb.tableKey=c;m3d.idb.idbObj=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;m3d.idb.idbTransaction=window.IDBTransaction||window.webkitIDBTransaction||
window.msIDBTransaction;"undefined"!==typeof m3d.idb.idbObj?d("ok"):d("error")},readData:function(a){m3d.idb.openDatabase(function(a,c){var d=a.result,f=[];if(0<d.objectStoreNames.length){var e=d.transaction(m3d.idb.tableName,"readonly").objectStore(m3d.idb.tableName).openCursor();e.onerror=function(){c.cb("error",a)};e.onsuccess=function(){var a=e.result;a?(f.push({key:a.value[m3d.idb.tableKey],value:a.value.value}),a["continue"]()):(d.close,c.cb("ok",f))}}else d.close,c.cb("ok",f)},function(a,c){a.result.createObjectStore(m3d.idb.tableName,
{keyPath:m3d.idb.tableKey});c.cb("upgrade",{})},function(a,c){c.cb("error",a)},{cb:a})},writeData:function(a,b){m3d.idb.openDatabase(function(a,b){var f=a.result,e=f.transaction(m3d.idb.tableName,"readwrite"),g=e.objectStore(m3d.idb.tableName),h=[{value:b.wdata}];h[0][m3d.idb.tableKey]=m3d.idb.tableKey;for(var m=0;m<h.length;m++)g.put(h[m]);e.onabort=function(){f.close;b.cb("error",a)};e.onerror=function(){f.close;b.cb("error",a)};e.oncomplete=function(){f.close;b.cb("ok",{})}},function(a,b){b.cb("upgrade",
{})},function(a,b){b.cb("error",a)},{cb:b,wdata:a})},openDatabase:function(a,b,c,d){var f=m3d.idb.idbObj.open(m3d.idb.baseName,1);f.onerror=function(){c(f,d)};f.onsuccess=function(){a(f,d)};f.onupgradeneeded=function(){b(f,d)}}},serv:{o:{},par:{},parNew:function(){return{db:{},reqCache:{tables:{},user:{},keys:{}}}},def:{cycle:5E3,cyclesAlive:3},init:function(a,b,c){m3d.serv.par=JSON.parse(JSON.stringify(m3d.serv.parNew()));for(var d in c)b[d]=c[d];for(d in m3d.serv.par)b[d]=m3d.serv.par[d];"local"==
a?(m3d.serv.dbf=m3d.serv.dbfLoc,m3d.serv.request=m3d.serv.requestLoc):"sql"==a&&(m3d.serv.dbf=m3d.serv.dbfSQL,m3d.serv.request=m3d.serv.requestSQL);m3d.serv.o=b},request:function(a){},requestLoc:function(a){return m3d.serv.reqProc(a)},requestSQL:function(a){},reqProc:function(a){var b,c="",d="";b=[];var f="";a=m3d.serv.moveManagerDecodeResp(a).d;m3d.serv.o.reqCache={user:{},keys:{ev:1,move:1,uid:0,gid:0,gstate:0,gstatet:"",gstatec:{}},tables:{},dbwrite:{}};m3d.serv.o.reqCache.user=m3d.serv.o.f_main.authKeys(a);
m3d.serv.o.reqCache.keys.gstate=0;m3d.serv.o.reqCache.keys.gstatet="";var e=[],g="",h=[];b=[];for(f=0;f<m3d.serv.o.req.auth.tables.length;f++){e=m3d.serv.o.req.auth.tables[f];g=e.name;if("undefined"==typeof m3d.serv.o.reqCache.tables[g]){h=e.keys;b=[];for(var m=0;m<h.length;m++)b.push(m3d.serv.o.reqCache.user[e.clientkeys[m]]);m3d.serv.o.reqCache.tables[g]=[];e=m3d.serv.dbRead(g,h,b);1==e.ok&&m3d.serv.o.reqCache.tables[g].push(e.data)}g==m3d.serv.o.glob.gameStateTable&&0<m3d.serv.o.reqCache.tables[g].length&&
(m3d.serv.o.reqCache.keys.gstatet=g,m3d.serv.o.reqCache.keys.gstate=0,m3d.serv.o.glob.conditions[m3d.serv.o.glob.conditionsKey]=m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate].gid,m3d.serv.o.reqCache.keys.gstatec=m3d.serv.o.glob.conditions,m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate].ev=parseInt(m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate].ev))}e=m3d.serv.o.f_main.authConditions();
if(0!=e.ok){0!=e.tables&&(m3d.serv.o.reqCache.user.uord=e.uord);m="_none_";g=-1;h=!1;for(f=1;f<a.length;f++)b=a[f][0],g=-1,1==e.tables&&0<m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate].ev&m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate].ev<m3d.serv.o.actions_chain.length+1&&(m=m3d.serv.o.actions_chain[m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate].ev-1],b==m&&
(h=!0,g=f)),"undefined"!==typeof m3d.serv.o.req[b]&&(m=!1,"strict"==m3d.serv.o.req[b].premission?1==e.tables&&(m=!0):"tables"==m3d.serv.o.req[b].premission&&(m=!0),"once"==m3d.serv.o.req[b].run&&"1"==m3d.serv.readyMeGet()&&(m=!1),1==m&&(b=m3d.serv.o.actions_s[b].f(a[f],g),0<b.length&&(d+=b[0].s),m3d.serv.dbWriteAdd(b)));0>m3d.serv.o.reqCache.keys.gstate&&(e.tables=!1);0!=e.tables&&(1==h&&(b=m3d.serv.readyMeSet(),m3d.serv.dbWriteAdd(b)),0!=m3d.serv.readyMenCheck()&&(b=m3d.serv.readyCompsSet(),m3d.serv.dbWriteAdd(b),
f=m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate].ev,f++,f>m3d.serv.o.actions_chain.length&&(f=1),b=[{t:m3d.serv.o.reqCache.keys.gstatet,c:m3d.serv.o.reqCache.keys.gstatec,d:{ev:f}}],m3d.serv.dbWriteAdd(b),f=m3d.serv.o.actions_chain[m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate].ev-1],b=m3d.serv.o.actions_s[f].fNew(),m3d.serv.dbWriteAdd(b),b=m3d.serv.readyAllUnSet(),m3d.serv.dbWriteAdd(b)),0<m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate].ev&&
(f=m3d.serv.o.actions_chain[m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate].ev-1],c=[],-1<g&&(c=a[g]),c=m3d.serv.o.actions_s[f].fPing(c)));JSON.stringify(m3d.serv.o.reqCache.dbwrite)}a=""==m3d.serv.o.reqCache.keys.gstatet?m3d.serv.o.reqCache:m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate];a="!ok!|"+m3d.serv.o.reqCache.user.uid+"|"+a.gid+"|"+a.ev+"|"+a.move;return a=a+c+d},state:0,tableSearch:function(a,b,c){for(var d=
-1,f=!0,e=0;e<m3d.serv.o.reqCache.tables[a].length;e++){for(var f=!0,g=0;g<b.length;g++)m3d.serv.o.reqCache.tables[a][e][b[g]]!=c[g]&&(f=!1);1==f&&(d=e)}return d},dbWriteAdd:function(a){for(var b={},c=-1,d=!1,c={},f=0;f<a.length;f++)if(b=a[f],"undefined"!=typeof b.d){c=-1;"undefined"==typeof m3d.serv.o.reqCache.dbwrite[b.t]&&(m3d.serv.o.reqCache.dbwrite[b.t]=[]);for(var e=0;e<m3d.serv.o.reqCache.dbwrite[b.t].length;e++)d=m3d.lib.oKeyValMatch(b.c,m3d.serv.o.reqCache.dbwrite[b.t][e].c),1==d&&(c=e);
if(-1==c)c={c:b.c,d:b.d},m3d.serv.o.reqCache.dbwrite[b.t].push(c);else for(var g in b.d)m3d.serv.o.reqCache.dbwrite[b.t][c].d[g]=b.d[g];m3d.serv.dbUpdate(b.t,b.c,b.d)}},readyMeGet:function(){var a="0";return a=m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate][m3d.serv.o.glob.readyMemo+m3d.serv.o.reqCache.user.uord.toString()]},readyGet:function(){for(var a=m3d.serv.o.glob.readyMemo,b={},c=0;c<m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate].nplayers;c++)b[a+
(c+1).toString()]=m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate][a+(c+1).toString()];return b},readyAllCheck:function(){for(var a=m3d.serv.o.glob.readyMemo,b=!0,c=m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate],d=0;d<c.nplayers;d++)6>parseInt(c[a+(d+1).toString()])&&"1"!=c[a+(d+1).toString()]&&(b=!1);return b},readyMenCheck:function(){for(var a=m3d.serv.o.glob.readyMemo,b=!0,c=m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate],
d=0;d<c.nplayers;d++)6>parseInt(c[a+(d+1).toString()])&&"3"!=c["type"+(d+1).toString()]&&"1"!=c[a+(d+1).toString()]&&(b=!1);return b},readyMeSet:function(){var a=!1,b=[{t:m3d.serv.o.reqCache.keys.gstatet,c:m3d.serv.o.reqCache.keys.gstatec,d:{}}],c=m3d.serv.o.glob.readyMemo+m3d.serv.o.reqCache.user.uord.toString(),d=m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate][c];6>parseInt(d)&&"1"!=d&&(b[0].d[c]="1",a=!0);0==a&&(b=[]);return b},readyAllSet:function(){for(var a,
b,c=m3d.serv.o.glob.readyMemo,d=!1,f=[{t:m3d.serv.o.reqCache.keys.gstatet,c:m3d.serv.o.reqCache.keys.gstatec,d:{}}],e=m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate],g=0;g<e.nplayers;g++)a=c+(g+1).toString(),b=e[a],6>parseInt(b)&&"1"!=b&&(f[0].d[a]="1",d=!0);0==d&&(f=[]);return f},readyAllUnSet:function(){for(var a,b,c=!1,d=[{t:m3d.serv.o.reqCache.keys.gstatet,c:m3d.serv.o.reqCache.keys.gstatec,d:{}}],f=m3d.serv.o.glob.readyMemo,e=m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate],
g=0;g<e.nplayers;g++)a=f+(g+1).toString(),b=e[a],6>parseInt(b)&&"2"!=b&&(d[0].d[a]="2",c=!0);0==c&&(d=[]);return d},readyCompsSet:function(){for(var a,b=m3d.serv.o.glob.readyMemo,c=!1,d=[{t:m3d.serv.o.reqCache.keys.gstatet,c:m3d.serv.o.reqCache.keys.gstatec,d:{}}],f=m3d.serv.o.reqCache.tables[m3d.serv.o.reqCache.keys.gstatet][m3d.serv.o.reqCache.keys.gstate],e=0;e<f.nplayers;e++)"3"==f["type"+(e+1).toString()]&&(a=b+(e+1).toString(),a=f[a],6>parseInt(a)&&"1"!=a&&(d[0].d[b+(e+1).toString()]="1",c=
!0));0==c&&(d=[]);return d},dbf:{},dbfLoc:{insert:function(a,b){"undefined"==typeof m3d.serv.o.db[a]&&(m3d.serv.o.db[a]={keys:[],data:[]},m3d.serv.o.db[a].keys=b.idx);m3d.serv.o.db[a].data.push(b.d)},read:function(a,b,c){var d={ok:!1,data:{}},f=-1,e=!0;if("undefined"!==typeof m3d.serv.o.db[a]){for(var g=0;g<m3d.serv.o.db[a].data.length;g++){for(var e=!0,h=0;h<b.length;h++)"undefined"==typeof m3d.serv.o.db[a].data[g][b[h]]?e=!1:m3d.serv.o.db[a].data[g][b[h]]!=c[h]&&(e=!1);1==e&&(f=g)}-1!=f&&(d.data=
m3d.serv.o.db[a].data[f],d.ok=!0)}return d},readAll:function(a,b,c){var d=[];if("undefined"!==typeof m3d.serv.o.db[a])for(0==b&0==c&&(c=m3d.serv.o.db[a].data.length-1),b=0;b<c+1;b++)d.push(m3d.serv.o.db[a].data[b]);return d},del:function(a,b){var c={},d=!1,f=0;if("undefined"!==typeof m3d.serv.o.db[a])for(var c=m3d.serv.o.db[a].data,e=c.length-1;-1<e;e--){var d=!0,g;for(g in b)"undefined"==typeof c[e][g]?d=!1:c[e][g]!=b[g]&&(d=!1);1==d&&(m3d.serv.o.db[a].data.splice(e,1),f++)}return f},update:function(a,
b,c){var d={},f=!1,e=0;if("undefined"!==typeof m3d.serv.o.db[a])for(var d=m3d.serv.o.db[a].data,g=0;g<d.length;g++){var f=!0,h;for(h in b)"undefined"==typeof d[g][h]?f=!1:d[g][h]!=b[h]&&(f=!1);if(1==f){for(h in c)m3d.serv.o.db[a].data[g][h]=c[h];e++}}return e}},dbfSQL:{insert:function(a,b){},read:function(a,b,c){}},packString:function(a,b){for(var c="",d,f=0;f<b.length;f++){d=m3d.serv.o.req[a].tables[f].keys;for(var e=0;e<d.length;e++)"undefined"!==typeof b[f][d[e]]&&(c+=b[f][d[e]]),e<d.length-1&&
(c+="|");f<b.length-1&&(c+="|")}return c},templateParseTable_js:function(a){var b,c=[],d={},f=[],e=[];b="   ---   ";for(var g in a.tablesDefTmp){for(var c=[],d={},f=a.tablesDefTmp[g].split(","),h=0;h<f.length;h++)e=f[h].split(":"),d[e[0]]=e[1],c.push(e[0]);b+=g+":"+JSON.stringify(d)+",  "+g+"idx:"+JSON.stringify(c)+",  "}b+="   ---   ";for(g in a.reqTmp)d={},d[g]={table:a.reqTmp[g].table,fields:[]},c=a.reqTmp[g].fields.split(","),d[g].fields=c,b+=JSON.stringify(d);return b},readTable:function(a,b,
c){var d=!1;if("undefined"==typeof m3d.serv.o.reqCache.tables[a])m3d.serv.o.reqCache.tables[a]=[],d=!0;else{for(var f=-1,e=!0,g=0;g<m3d.serv.o.reqCache.tables[a].length;g++){for(var e=!0,h=0;h<b.length;h++)"undefined"==typeof m3d.serv.o.reqCache.tables[a][g][b[h]]?e=!1:m3d.serv.o.reqCache.tables[a][g][b[h]]!=c[h]&&(e=!1);1==e&&(f=g)}-1==f&&(d=!0)}1==d&&(b=m3d.serv.dbRead(a,b,c),1==b.ok&&m3d.serv.o.reqCache.tables[a].push(b.data))},readTableAll:function(a,b,c){m3d.serv.o.reqCache.tables[a]=[];m3d.serv.o.reqCache.tables[a]=
m3d.serv.dbReadAll(a,0,0)},dbRead:function(a,b,c){return m3d.serv.dbf.read(a,b,c)},dbReadAll:function(a,b,c){return m3d.serv.dbf.readAll(a,b,c)},dbDel:function(a,b){return m3d.serv.dbf.del(a,b)},dbUpdate:function(a,b,c){return m3d.serv.dbf.update(a,b,c)},dbInsert:function(a,b,c){var d={idx:[],d:{},s:""};d.d=JSON.parse(JSON.stringify(m3d.serv.o.tablesDef[a]));d.idx=m3d.serv.o.tablesDef[a+"idx"];for(var f in c)d.d[f]=c[f];d.s="'"+d.d[d.idx[0]]+"'";for(c=0;c<d.idx.length;c++)d.s+=",'"+d.d[d.idx[c]]+
"'";1==b&&m3d.serv.dbf.insert(a,d);return d},json2string:function(a,b,c){for(var d="",d=""+a[b[0]],f=1;f<b.length;f++)d+=c+a[b[f]];return d},ar2json:function(a,b){for(var c=[],d,f=1,e=0;e<m3d.serv.o.req[a].tables.length;e++){d=m3d.serv.o.req[a].tables[e].keys;c.push({});for(var g=0;g<d.length;g++)c[c.length-1][d[g]]=b[g+f];f+=d.length}return c},moveManagerDecodeResp:function(a){var b={ok:"",uid:"",uord:"",gid:"",ev:"",move:"",d:[]};a=a.split("~ro~");a[0]=a[0].split("|");b.ok=a[0][0];if("!error!"!=
b.ok){b.uid=a[0][1];b.gid=a[0][2];3<a[0].length&&(b.ev=a[0][3]);4<a[0].length&&(b.move=a[0][4]);for(var c=1;c<a.length;c++)a[c]=a[c].split("|")}b.d=a;return b}},ui:{scale:1,initDefaults:function(a){for(var b in a){a[b].ctx=apctx;for(var c in this.button_template)"undefined"==typeof a[b][c]&&(a[b][c]=this.button_template[c])}},reScale:function(a){var b=m3d.ui.scale,c;for(c in a)a[c].xpos=Math.round(b*a[c].sxpos),a[c].ypos=Math.round(b*a[c].sypos),a[c].w=Math.round(b*a[c].sw),a[c].h=Math.round(b*a[c].sh),
a[c].w2=Math.round(b*a[c].sw2),a[c].h2=Math.round(b*a[c].sh2)},pCl:[],pCl_s:[],mnGA:1,mnGABlock:.5,mnGAInvis:0,button_template:{sig:"custom",scale:0,xpos:0,ypos:0,x:0,y:0,w:0,h:0,w2:0,h2:0,container:"",contxpos:0,contypos:0,contxpos_s:0,contypos_s:0,lastScale:0,on:!1,block:!1,blockstyle:0,drawbk:!0,bkcolor:"",bkdx:0,bkdy:0,btbk:!0,btbkclear:!0,btexact:!1,txbt:!0,outbk:!1,fix:!1,multitouch:!1,slide:!1,customdecor:"",hilight:"",hilight2:"",gray:"",mtop:"",mbot:"",btop:"",bbot:"",bbot0:"",mnbk:"",canv:"",
ctx:"",cx:0,cy:0,fbkcanv:"",bkcanv:"",bkcanvctx:"",fbtcanv:"",btcanv:"",btcanvctx:"",bk:1,bki:["",""],bt:[],set:[],cb:[],cblong:"",btd:[],rules:[],btr:"",bts:[],bvar:""},scr:{scale:1,ratio:-1,init_ratio:-1,w:1,h:1,iw:1,ih:1},setZoomInit:function(){var a=m3dcache.setup.aspect.scale;this.scr.init_ratio=window.devicePixelRatio;this.scr.w=screen.width;this.scr.h=screen.height;this.scr.iw=window.innerWidth/a;this.scr.ih=window.innerHeight/a},setZoom:function(){var a=window.devicePixelRatio,b=m3dcache.setup.aspect.scale;
a!=this.scr.ratio?(this.scr.ratio=a,this.scr.scale=Math.round(this.scr.ratio/this.scr.init_ratio*100)):(this.scr.w=screen.width,this.scr.h=screen.height,this.scr.iw=window.innerWidth/b,this.scr.ih=window.innerHeight/b)},saveState:function(a){var b={on:{},block:{}},c;for(c in mn)b.on[c]=mn[c].on,b.block[c]=mn[c].block;b.restore=a;return b},restoreState:function(a){for(var b in a.on)mn[b].on=1==a.on[b]?!0:!1,mn[b].block=1==a.block[b]?!0:!1},getBtPos:function(a,b){return{x:mn[a].xpos+mn[a].btd[2*b-2],
y:mn[a].ypos+mn[a].btd[2*b-1],w:mn[a].bts[0][0],h:mn[a].bts[0][1]}},btCheck:function(a,b,c){for(var d=0;d<mn[a].set.length;d++)mn[a].set[d]=d==b-1?c:1},btCheckSmart:function(a,b,c,d){for(var f=0,e=0;e<mn[a].set.length;e++)e==b-1?mn[a].set[e]=c:(f=m3d.lib.in_arr_n(d,mn[a].set[e]),0==f.length&&(mn[a].set[e]=1))},mnOffExc:function(a){var b=!0,c;for(c in mn){for(var b=!0,d=0;d<a.length;d++)a[d]==c&&(b=!1);1==b&&(mn[c].on=!1)}},mnOff:function(a){for(var b=0;b<a.length;b++)mn[a[b]].on=!1},mnOn:function(a){for(var b=
0;b<a.length;b++)mn[a[b]].on=!0},mnOnAnimMult:function(a,b,c,d,f){var e;f={stream:a,d:[],ar:c,first:!0,cb:f,cbpar:d,arCnt:0};for(var g=[],h=0;h<c.length;h++)e=c[h][0][0],d=mn[e].w,e=mn[e].h,f.d.push({w:d,h:e,canvo:{},canv:{},actx:c[h][1],acw:c[h][1].canvas.width,ach:c[h][1].canvas.height}),f.d[h].canvo=m3d.ui.mnCreateCanvasFree(d,e,"",{},0,1,1),f.d[h].canv=f.d[h].canvo.canv,m3d.ui.ref2(c[h][0],f.d[h].canvo),g.push({lim1:c[h][2],lim2:c[h][4],sstart:c[h][2],t:0,sfin:c[h][4]}),g.push({lim1:c[h][3],lim2:c[h][5],
sstart:c[h][3],t:0,sfin:c[h][5]}),g.push({lim1:1E3*c[h][6],lim2:1E3*c[h][7],sstart:1E3*c[h][6],t:0,sfin:1E3*c[h][7]}),g.push({lim1:100*c[h][8],lim2:100*c[h][9],sstart:100*c[h][8],t:0,sfin:100*c[h][9]});f.arCnt=Math.floor(g.length/1);m3d.ui.ref();m3d.lib.anim.add("mnOnAnimMult",a,b,"and",f,g,function(){m3d.ui.mnOnAnimMultAnim(this)},function(){for(var a=this.userpar.ar,b=0;b<a.length;b++)for(var c=0;c<a[b][0].length;c++)mn[a[b][0][c]].on=!0;m3d.ui.ref();this.userpar.cb(this.userpar.cbpar)});m3d.lib.anim.play()},
mnOnAnimMultAnim:function(a){var b=a.par[0].state,c=a.par[0].state_old,d=a.par[1].state,f=a.par[1].state_old,e=a.par[3].state;state_old4=a.par[3].state_old;if(b!=c||d!=f|e!=state_old4)for(c=b=0;c<a.userpar.arCnt;c+=4){var g=a.par[c+0].state,h=a.par[c+1].state,m=a.userpar.d[b].h,d=a.userpar.d[b].canv,f=a.userpar.d[b].actx,q=a.userpar.d[b].acw,n=a.userpar.d[b].ach,e=g,l=0,g=g+a.userpar.d[b].w;0>e&&(l=-e,e=0);g>q&&(g=q);q=g-e;if(0<q){var g=h,p=0,h=h+m;0>g&&(p=-g,g=0);h>n&&(h=n);n=h-g;0<n&&(1==a.userpar.first?
a.userpar.first=!1:(f.globalAlpha=1,f.clearRect(a.userpar.d[b].old_ox1,a.userpar.d[b].old_oy1,a.userpar.d[b].old_ow,a.userpar.d[b].old_oh)),f.globalAlpha=a.par[c+3].state/100,f.drawImage(d,l,p,q,n,e,g,q,n),f.globalAlpha=1,a.userpar.d[b].old_ox1=e,a.userpar.d[b].old_oy1=g,a.userpar.d[b].old_ow=q,a.userpar.d[b].old_oh=n)}b++}},mnOnAnim:function(a,b,c,d,f,e,g,h,m,q,n,l){var p=a[0],r=mn[p].w,t=mn[p].h,u=m3d.ui.mnCreateCanvasFree(r,t,"",{},0,1,1),p=!1;"undefined"!==typeof n.alpha&&1==n.alpha&&(p=!0);m3d.ui.ref2(a,
u);m3d.ui.ref();a={stream:c,w:r,h:t,canv:u.canv,actx:d,acw:d.canvas.width,ach:d.canvas.height,ar:a,first:!0,fa:p,cb:l,cbpar:n};f=[{lim1:f,lim2:g,sstart:f,t:0,sfin:g},{lim1:e,lim2:h,sstart:e,t:0,sfin:h},{lim1:1E3*m,lim2:1E3*q,sstart:1E3*m,t:0,sfin:1E3*q}];1==p&&f.push({lim1:100*n.alpha1,lim2:100*n.alpha2,sstart:100*n.alpha1,t:0,sfin:100*n.alpha2});m3d.lib.anim.add("mnOnAnim",c,b,"and",a,f,function(){m3d.ui.mnOnAnimAnim(this)},function(){for(var a=this.userpar.ar,b=0;b<a.length;b++)mn[a[b]].on=!0;m3d.ui.ref();
this.userpar.cb(this.userpar.cbpar)});m3d.lib.anim.play()},mnOnAnimAnim:function(a){var b=a.par[0].state,c=a.par[0].state_old,d=a.par[1].state,f=a.par[1].state_old,e=b,g=b;1==a.userpar.fa&&(e=a.par[3].state,g=a.par[3].state_old);if(b!=c||d!=f|e!=g){var h=a.par[0].state,g=a.par[1].state,m=a.userpar.h,b=a.userpar.canv,c=a.userpar.actx,q=a.userpar.acw,e=a.userpar.ach,d=h,f=0,h=h+a.userpar.w;0>d&&(f=-d,d=0);h>q&&(h=q);q=h-d;if(0<q){var h=g,n=0,g=g+m;0>h&&(n=-h,h=0);g>e&&(g=e);e=g-h;0<e&&(1==a.userpar.first?
a.userpar.first=!1:(c.globalAlpha=1,c.clearRect(a.userpar.old_ox1,a.userpar.old_oy1,a.userpar.old_ow,a.userpar.old_oh)),1==a.userpar.fa&&(c.globalAlpha=a.par[3].state/100),c.drawImage(b,f,n,q,e,d,h,q,e),c.globalAlpha=1,a.userpar.old_ox1=d,a.userpar.old_oy1=h,a.userpar.old_ow=q,a.userpar.old_oh=e)}}},mnBlock:function(a){for(var b=0;b<a.length;b++)mn[a[b]].block=!0},mnUnBlock:function(a){for(var b=0;b<a.length;b++)mn[a[b]].block=!1},mnOffAll:function(a){for(var b in mn)mn[b].on=!1},mnBlockAll:function(a){for(var b in mn)mn[b].block=
!0},mnSetCb:function(a,b,c){mn[a].cb[b-1]=c},mnSetCbLong:function(a,b){mn[a].cblong=b},mnSetCbTouch1:function(a,b,c){mn[a].touch1[b-1]=c},mnSetCbTouch2:function(a,b,c){mn[a].touch2[b-1]=c},mnSetCustomM:function(a,b){mn[a].customdecor=b},mnSetBotM:function(a,b){mn[a].mbot=b},mnSetHilight:function(a,b){mn[a].hilight=b},mnSetHilight2:function(a,b){mn[a].hilight2=b},mnSetHilightOff:function(a,b){mn[a].hilightoff=b},mnSetGray:function(a,b){mn[a].gray=b},mnSetCustomFix:function(a,b){mn[a].customfix=b},
clearArea:function(a,b,c,d,f){apctx.clearRect(b,c,d,f)},fillArea:function(a,b,c,d,f){apctx.fillRect(b,c,d,f)},eraseArea:function(a,b,c,d,f,e,g,h){var m=mn[b].bki,q;""==mn[b].mnbk?q=ap.mnbk[m[0]]:""!==m[0]&&(q=mn[b].mnbk[m[0]]);""===mn[b].fbkcanv||1!=mn[b].fbkcanv&&2!=mn[b].fbkcanv||(q=mn[b].bkcanv);a.clearRect(c,d,f,e);""!=mn[b].bkcolor?(a.fillStyle=mn[b].bkcolor,a.fillRect(c,d,f,e)):1==mn[b].drawbk&&a.drawImage(q,mn[b].x+c+g-mn[b].xpos,mn[b].y+d+h-mn[b].ypos,f,e,c,d,f,e)},fillCanvas:function(a,b,
c,d,f,e,g,h,m,q){0==f&&(f=b.width,e=b.height);var n=Math.floor(m/f),l=Math.floor(q/e);m-=f*n;q-=e*l;for(var p=0;p<l;p++){for(var r=0;r<n;r++)a.drawImage(b,c,d,f,e,f*r+g,e*p+h,f,e);0!=m&&a.drawImage(b,c,d,m,e,f*n+g,e*p+h,m,e)}if(0!=q)for(r=0;r<n;r++)a.drawImage(b,c,d,f,q,f*r+g,e*l+h,f,q)},fillWithImageSlice:function(a,b,c,d,f,e,g,h,m,q,n,l,p,r){0==f&&(f=b.width,e=b.height);for(var t=f-h-g,u=e-q-m,v=p-g-h,B=r-m-q,C=Math.floor(v/t),y=Math.floor(B/u),v=v-C*t,B=B-y*u,w=c+g,z=d+m,A=0;A<y;A++)for(var x=
0;x<C;x++)a.drawImage(b,w,z,t,u,x*t+n+g,A*u+l+m,t,u),0==A&&(0<B&&(a.drawImage(b,w,z,t,B,x*t+n+g,(y-0)*u+l+m,t,B),a.fillRect(x*t+n+g,(y-0)*u+l+m,t,B)),a.drawImage(b,w,z-m,t,m,x*t+n+g,0+l+0,t,m),a.drawImage(b,w,z+u,t,q,x*t+n+g,l+r-q,t,q)),x==C-1&&(0<v&&(a.drawImage(b,w,z,v,u,(C-0)*t+n+g,A*u+l+m,v,u),a.drawImage(b,w,z-m,v,m,(C-0)*t+n+g,0+l+0,v,m),a.drawImage(b,w,z+u,v,q,(C-0)*t+n+g,l+r-q,v,q)),a.drawImage(b,c,z,g,u,n,A*u+l+m,g,u),a.drawImage(b,c+f-h,z,h,u,n+p-h,A*u+l+m,h,u));a.drawImage(b,c,d,g,m,n,
l,g,m);a.drawImage(b,c+f-h,d,h,m,n+p-h,l,h,m);a.drawImage(b,c+f-h,d+e-q,h,q,n+p-h,l+r-q,h,q);a.drawImage(b,c,d+e-q,g,q,n,l+r-q,g,q)},setPosLayersDiv:function(a,b,c,d,f){var e=m3dcache.setup.aspect.scale;a=document.getElementById(a);a.style.marginLeft=b*e+"px";a.style.marginTop=c*e+"px";a.style.width=d*e+"px";a.style.height=f*e+"px"},elementOff:function(a){document.getElementById(a).style.display="none"},elementOn:function(a){document.getElementById(a).style.display="block"},htmlCommonMenu:function(){return{ih:'<div id="divcanvmenu" class="cdivcanvmenu"></div>',
d:"",type:"commonMenu"}},html3D:function(){return{ih:'<div id="divcanv3d" class="cdivcanv"></div>',d:"",type:"html3D"}},htmlCanvas:function(a){return{ih:'<div id="div'+a+'" style="display:block; position:absolute; cursor:default; overflow:hidden;"></div>',d:a,type:"htmlCanvas"}},htmlDiv:function(a){return{ih:'<div id="'+a+'" style="display:none; position:absolute; cursor:default; overflow:hidden;"></div>',id:a,d:"",w:10,h:10,type:"htmlDiv"}},htmlCanvasAds:function(a){return{ih:'<div id="div'+a+'" style="display:none; position:absolute; cursor:default; overflow:hidden;"></div>',
d:a,type:"htmlCanvas"}},htmlDivAds:function(a){return{ih:'<div id="'+a+'" style="display:none; position:absolute; cursor:default; overflow:hidden;"></div>',id:a,d:"",w:10,h:10,type:"htmlDiv"}},htmlIframe:function(a,b){return{ih:'<iframe id="iframe'+a+'" src="'+b+'" width="600" height="600" class="cdivcanv" style="display:none;"></iframe>',d:"",type:"htmlIframe"}},htmlControls:function(){return{ih:'<div id="divcanv" ondblclick="var e = event || window.event; m3d.contr.controlsMouseDblClick(e, canvas1, elcanv);" onmousemove="var e=event||window.event; m3d.contr.controlsMouseMove(e, canvas1, elcanv);" onmousedown="var e=event||window.event; m3d.contr.controlsMouseDown(e, canvas1, elcanv);" onmouseup="var e=event||window.event; m3d.contr.controlsMouseUp(e, canvas1, elcanv);" class="cdivcanv2d"></div>',
d:"",w:10,h:10,type:"htmlControls"}},htmlControlsHand:function(){return{ih:'<div id="divcanv" class="cdivcanv2d"></div>',d:"",type:"htmlControls",elid:"divcanv",handlers:{dblclick:function(a){m3d.contr.controlsMouseDblClick(a||window.event,canvas1,elcanv)},mousemove:function(a){m3d.contr.controlsMouseMove(a||window.event,canvas1,elcanv)},mousedown:function(a){m3d.contr.controlsMouseDown(a||window.event,canvas1,elcanv)},mouseup:function(a){m3d.contr.controlsMouseUp(a||window.event,canvas1,elcanv)}}}},
htmlStatLog:function(){return{ih:'<div id="callbacks" class="ccallbacks"></div><div id="dstatlog" style="display:none; position:absolute; width:440px; height:260px; overflow:hidden; margin-left:210px; margin-top:0px; font-size:9px;"><div id="dstatlog1" style="display:block; float:left; width:200px; height:250px; overflow:scroll; margin:0px; font-size:9px;"></div><div id="dstatlog2" style="display:block; float:right; width:200px; height:250px; overflow:scroll; margin:0px; font-size:9px;"></div></div><div id="divst" style="background-color:#FFFFFF; margin-left:180px; margin-top:6px; position:absolute; display:none;"><div id="statsdiv" style="width:80px;display:block;"></div></div>',
d:"",w:10,h:10,type:"htmlStatLog"}},htmlDivControls:function(a,b,c){return{ih:'<div id="'+a+'" ondblclick="var e = event || window.event; m3d.contr.controlsMouseDblClick(e, m3d.ui.layersDiv[\''+a+"'].canv, m3d.ui.layersDiv['"+a+"'].div);\" onmousemove=\"var e=event||window.event; m3d.contr.controlsMouseMove(e, m3d.ui.layersDiv['"+a+"'].canv, m3d.ui.layersDiv['"+a+"'].div);\" onmousedown=\"var e=event||window.event; m3d.contr.controlsMouseDown(e, m3d.ui.layersDiv['"+a+"'].canv, m3d.ui.layersDiv['"+
a+"'].div);\" onmouseup=\"var e=event||window.event; m3d.contr.controlsMouseUp(e, m3d.ui.layersDiv['"+a+"'].canv, m3d.ui.layersDiv['"+a+'\'].div);" style="display:block; position:absolute; \tcursor:default; overflow:hidden;"></div>',d:"",id:a,w:b,h:c,type:"htmlDivControls"}},htmlDivControlsHand:function(a,b,c){return{ih:'<div id="'+a+'" style="display:block; position:absolute; \tcursor:default; overflow:hidden;"></div>',d:"",id:a,w:b,h:c,type:"htmlDivControls",elid:a,handlers:{dblclick:function(b){m3d.contr.controlsMouseDblClick(b||
window.event,m3d.ui.layersDiv[a].canv,m3d.ui.layersDiv[a].div)},mousemove:function(b){m3d.contr.controlsMouseMove(b||window.event,m3d.ui.layersDiv[a].canv,m3d.ui.layersDiv[a].div)},mousedown:function(b){m3d.contr.controlsMouseDown(b||window.event,m3d.ui.layersDiv[a].canv,m3d.ui.layersDiv[a].div)},mouseup:function(b){m3d.contr.controlsMouseUp(b||window.event,m3d.ui.layersDiv[a].canv,m3d.ui.layersDiv[a].div)}}}},layers:{},layershand:{},layersDiv:{},initHtml:function(a){var b,c;m3d.ui.layers={};var d=
"";"undefined"!==typeof m3dcache.v.ads&&("canvas"==m3dcache.v.ads.tp?a=[m3d.ui.htmlCanvasAds("Ads")].concat(a):"div"==m3dcache.v.ads.tp&&(a=[m3d.ui.htmlDivAds("Ads")].concat(a)));for(var f=0;f<a.length;f++)b=a[f],c={empty:""},"undefined"!==typeof b.handlers&&(c=b.handlers,m3d.ui.layershand[b.elid]={id:b.elid,handlers:c}),""!=b.d&&(m3d.ui.layers[b.d]={id:b.d,w:b.w,h:b.h,handlers:c,type:b.type}),"htmlDivControls"==b.type&&(m3d.ui.layersDiv[b.id]={id:b.id,w:b.w,h:b.h,handlers:c}),"htmlDiv"==b.type&&
(m3d.ui.layersDiv[b.id]={id:b.id,w:b.w,h:b.h,handlers:c,type:b.type}),"htmlDivAds"==b.type&&(m3d.ui.layersDiv[b.id]={id:b.id,w:b.w,h:b.h,handlers:c,type:b.type}),d+=b.ih;document.getElementById("wrap").innerHTML=d;for(f=0;f<a.length;f++)if(b=a[f],"undefined"!==typeof b.handlers&&"undefined"==typeof b.handlers.empty){c=b.elid;for(var e in b.handlers)m3d.lib.addListner(document.getElementById(c),e,m3d.ui.layershand[b.elid].handlers[e])}for(e in m3d.ui.layersDiv)m3d.ui.initHtmlResize(e,m3d.ui.layersDiv[e].w,
m3d.ui.layersDiv[e].h)},initHtmlResize:function(a,b,c){var d=m3d.ui.layersDiv[a].id;m3d.ui.layersDiv[a].w=b;m3d.ui.layersDiv[a].h=c;var f=d+"canv",e=document.getElementById(d);"htmlDiv"==m3d.ui.layersDiv[a].type?(e.style.width=b+"px",e.style.height=c+"px"):(e.innerHTML='<canvas id="'+f+'" style="width:'+b+"px; height:"+c+'px;" width="'+b+'" height="'+c+'"></canvas>',f=document.getElementById(f),e=f.getContext("2d"),e.clearRect(0,0,b,c),m3d.ui.layersDiv[a].canv=f,m3d.ui.layersDiv[a].ctx=e);m3d.ui.layersDiv[a].div=
document.getElementById(d)},initHtmlResizeCanvas:function(a,b,c){var d="div"+m3d.ui.layers[a].id;m3d.ui.layers[a].w=b;m3d.ui.layers[a].h=c;var f=m3d.ui.layers[a].id;document.getElementById(d).innerHTML='<canvas id="'+f+'" style="width:'+b+"px; height:"+c+'px;" width="'+b+'" height="'+c+'"></canvas>';var f=document.getElementById(f),e=f.getContext("2d");e.clearRect(0,0,b,c);m3d.ui.layers[a].canv=f;m3d.ui.layers[a].ctx=e;m3d.ui.layers[a].div=document.getElementById(d)},initHtmlClear:function(a,b,c){a.clearRect(0,
0,b,c)},mnCreateCanvas:function(a,b,c,d,f,e){if("undefined"!==typeof mn[a].fbkcanv&&(1==mn[a].fbkcanv||2==mn[a].fbkcanv)&&(mn[a].bkcanv=document.createElement("canvas"),mn[a].bkcanv.width=mn[a].w,mn[a].bkcanv.height=mn[a].h,mn[a].bkcanv.style.width=mn[a].w+"px",mn[a].bkcanv.style.height=mn[a].h+"px",mn[a].bkcanvctx=mn[a].bkcanv.getContext("2d"),mn[a].bkcanvctx.clearRect(0,0,mn[a].w,mn[a].h),""!=b))apui[b](apmain,mn[a].bkcanvctx,0,0,mn[a].w,mn[a].h,c,d,f,e)},mnCreateCanvasFree:function(a,b,c,d,f,e,
g){var h=document.createElement("canvas");h.width=a;h.height=b;h.style.width=a+"px";h.style.height=b+"px";var m=h.getContext("2d");m.clearRect(0,0,a,b);if(""!=c)apui[c](apmain,m,0,0,a,b,d,f,e,g);return{canv:h,ctx:m}},returnUICanvas:function(a,b,c,d,f,e,g){var h=document.createElement("canvas");h.width=a;h.height=b;h.style.width=a+"px";h.style.height=b+"px";var m=h.getContext("2d");m.clearRect(0,0,a,b);if(""!=c)apui[c](apmain,m,0,0,a,b,d,f,e,g);return{canv:h,ctx:m}},resizeImgCanvas:function(a,b){var c=
Math.floor(b*a.width),d=Math.floor(b*a.height),f=Math.floor(b*a.width/2),e=Math.floor(b*a.height/2),g=m3d.ui.mnCreateCanvasFree(c,d,"",{},0,1,1);g.ctx.drawImage(a,0,0,a.width,a.height,0,0,c,d);g.w=c;g.h=d;g.w2=f;g.h2=e;return g},reflectImg:function(a,b){var c=Math.floor(b*a.width),d=Math.floor(b*a.height),f=Math.floor(b*a.width/2),e=Math.floor(b*a.height/2),g=m3d.ui.mnCreateCanvasFree(c,d,"",{},0,1,1);g.ctx.save();g.ctx.scale(-1,1);g.ctx.drawImage(a,0,0,a.width,a.height,0,0,-1*c,d);g.ctx.restore();
g.w=c;g.h=d;g.w2=f;g.h2=e;return g},setBti:function(a,b,c){mn[a].set[0]=c;m3d.ui.pCl_s[b][4]=c;m3d.ui.pCl[b][4]=c;m3d.ui.refBt(b,c,1,!0,!0)},setBt:function(a,b,c){for(var d=b+1,f=-1,e=0;e<m3d.ui.pCl.length;e++)m3d.ui.pCl[e][5]==a&m3d.ui.pCl[e][6]==d&&(f=e);mn[a].set[b-1]=c;-1!=f&&(b=1,1==a.block?b=0:(4==c&&(b=0),5==c&&(b=5),6==c&&(b=6),7==c&&(b=7),9==c&&(b=5)),m3d.ui.pCl[f][4]=c,m3d.ui.pCl[f][4]=c,m3d.ui.refBt(f,c,b,!0,!0))},refBt:function(a,b,c,d,f){if("undefined"!==typeof m3d.ui.pCl[a]){var e=m3d.ui.pCl[a][5],
g=!0;2==b&1==m3d.ui.pCl[a][8]&""==mn[e].hilight&&(g=!1);var h=mn[e].sig;if("touch"==h&1==d||"custom0"==h&0==f)g=!1;if(1==g){d=""==mn[e].ctx?apctx:mn[e].ctx;f=mn[m3d.ui.pCl[a][5]].bki;var m,q;""==mn[e].mnbk?(m=ap.mnbk[f[0]],q=ap.mnbk[f[1]]):(""!==f[0]&&(m=mn[e].mnbk[f[0]]),""!==f[1]&&(q=mn[e].mnbk[f[1]]));""===mn[e].fbkcanv||1!=mn[e].fbkcanv&&2!=mn[e].fbkcanv||(m=mn[e].bkcanv);""===mn[e].fbtcanv||1!=mn[e].fbtcanv&&2!=mn[e].fbtcanv||(q=mn[e].btcanv);var n=mn[e].outbk;if("buttons"==h||"buttonscustom"==
h||"buttonsdecor"==h||"tabs"==h||"menu"==h||"nav"==h||"custom"==h||"custom0"==h||"custom3"==h||"custom100"==h||"customfree"==h||"inc"==h||"dec"==h||"touch"==h){var g=mn[m3d.ui.pCl[a][5]].bts,l=0;2==b&&(l=2);22==b&&(l=2);var p=0;3==b&1!=m3d.ui.pCl[a][8]&&(p=1);3==b&1==m3d.ui.pCl[a][8]&&(l=2);f=!1;"custom"==h&4==b&&(f=!0);"custom3"==h&4==b&&(l=4);4==b&&(b=1);var r=g[1][2*b-2],t=g[1][2*b-2+1],u=m3d.ui.pCl[a][0],v=m3d.ui.pCl[a][1];8==mn[e].set[m3d.ui.pCl[a][6]-2]&&(l=4);9==mn[e].set[m3d.ui.pCl[a][6]-
2]&&(l=6);if("inc"!=h&&"dec"!=h)var B=g[m3d.ui.pCl[a][6]][0+l],C=g[m3d.ui.pCl[a][6]][1+l];var l=m3d.ui.pCl[a][6]-1,y=g[0][2][0],w=g[0][2][1];3<g[0].length&&(y=g[0][3][2*(l-1)],w=g[0][3][2*(l-1)+1]);var g=y,l=w,z=mn[e].bkdx,A=mn[e].bkdy,x=m3d.ui.pCl[a][0]+p,p=m3d.ui.pCl[a][1]+p;if("customfree"!=h)if(1==n)"touch"!=h&&(d.clearRect(u,v,y,w),1==m3dcache.v.camerafOn&&(d.fillStyle="#000000",d.fillRect(u,v,y,w)));else{n=1;"undefined"!==typeof mn[e].bk&&(n=mn[e].bk);""!==mn[e].canv&&1==mn[e].canv&&(n=100);
"touch"==h&&(n=99);var F=0;"undefined"!==typeof mn[e].page&&(F=(mn[e].page-1)*mn[e].pitems*2);0==mn[e].btbk&&(n=-1);if(0!=n)if(100==n)""!=mn[e].bkcolor?(d.fillStyle=mn[e].bkcolor,d.fillRect(u,v,y+1,w+1)):(1==mn[e].btbkclear&&d.clearRect(u,v,y+1,w+1),d.drawImage(canvasm,mn[e].cx+mn[e].btd[2*m3d.ui.pCl[a][6]-4-F],mn[e].cy+mn[e].btd[2*m3d.ui.pCl[a][6]-4+1-F],g+1,l+1,u,v,y+1,w+1));else if(1==n)""!=mn[e].bkcolor?(d.fillStyle=mn[e].bkcolor,d.fillRect(m,u,v,y,w)):(d.clearRect(u,v,y+0,w+0),d.drawImage(m,
mn[e].x+mn[e].btd[2*m3d.ui.pCl[a][6]-4-F]+z,mn[e].y+mn[e].btd[2*m3d.ui.pCl[a][6]-4+1]+A,g,l,u,v,y,w));else{var D=mn[e].btd[2*m3d.ui.pCl[a][6]-4-F],E=mn[e].btd[2*m3d.ui.pCl[a][6]-4+1],G=l,H=w,I=g,J=y,L=0,M=0,K=0;E+l>mn[e].y+mn[e].h&&(H=G=mn[e].y+mn[e].h-E);0>E&&(H=G=l-(0-E),K=M=l-G);D+g>mn[e].x+mn[e].w&&(J=I=mn[e].x+mn[e].w-D);0>D&&(J=I=g-(0-D),L=g-I);"custom0"!=h&&(1==mn[e].btbkclear&&d.clearRect(u,v,y,w),-1!=n&&(""!=mn[e].bkcolor?(d.fillStyle=mn[e].bkcolor,d.fillRect(u,K+v,J,H)):d.drawImage(m,L+
mn[e].x+D+z,M+mn[e].y+E+A,I,G,u,K+v,J,H)))}}0==c&"custom100"!==h&&(d.globalAlpha=m3d.ui.mnGABlock);6==c&"custom100"!==h&&(d.globalAlpha=m3d.ui.mnGAInvis);7==c&"custom100"!==h&&(d.globalAlpha=m3d.ui.mnGAInvis);1==mn[e].block&&(1==mn[e].blockstyle?d.globalAlpha=m3d.ui.mnGA:2==mn[e].blockstyle&&(d.globalAlpha=0));"custom"==h&2==b&&""!=mn[e].hilight&&mn[e].hilight(m3d.ui.pCl[a][6]-1,x,p,g,l);"customfree"==h&2==b&&""!=mn[e].hilight&&mn[e].hilight(m3d.ui.pCl[a][6]-1,x,p,g,l);2==b&&""!==mn[e].hilight2&&
mn[e].hilight2(m3d.ui.pCl[a][6]-1,x,p,g,l);if("buttons"==h||"tabs"==h||"buttonscustom"==h||"buttonsdecor"==h||"inc"==h||"dec"==h||"dec"==h)d.drawImage(m,L+mn[e].x+D+z,M+mn[e].y+E+A,I,G,u,K+v,J,H),""!==mn[e].bbot0&&mn[e].bbot0(e,m3d.ui.pCl[a][6]-1,a,x,p),""!==mn[e].bbot&&mn[e].bbot(e,m3d.ui.pCl[a][6]-1,a,x,p),d.drawImage(m,r,t,y,w,u,v,y,w);1==mn[e].txbt&&"inc"!=h&"dec"!=h&"customfree"!=h&"buttonsdecor"!=h&&(""===mn[e].btr?(b=d.globalAlpha,0==b&&(d.globalAlpha=1),""!==mn[e].bbot0&&mn[e].bbot0(e,m3d.ui.pCl[a][6]-
1,a,x,p),""!==mn[e].bbot&&mn[e].bbot(e,m3d.ui.pCl[a][6]-1,a,x,p),d.globalAlpha=b,d.drawImage(q,B,C,g,l,x,p,g,l)):(b=Math.floor(g/2),m=Math.floor(l/2),D=x+b,E=p+m,""!==mn[e].bbot0&&mn[e].bbot0(e,m3d.ui.pCl[a][6]-1,a,x,p),d.save(),d.translate(D,E),d.rotate(mn[e].btr[m3d.ui.pCl[a][6]-2]-Math.PI/2),""!==mn[e].bbot&&mn[e].bbot(e,m3d.ui.pCl[a][6]-1,a,-b,-m),d.drawImage(q,B,C,g,l,x-x-b,p-p-m,g,l),d.restore()));7==c&"custom100"!==h&&(d.globalAlpha=m3d.ui.mnGA);""!==mn[e].btop&&mn[e].btop(e,m3d.ui.pCl[a][6]-
1,a);1==f&&""!=mn[e].gray&&mn[e].gray(x,p,g,l);d.globalAlpha=1}}}},refMenuBt:function(a,b,c,d){d=mn[a];var f=d.set[d.bt[b-1]-2],e=d.bts,g=e[0][2][0],h=e[0][2][1];3<e[0].length&&(g=e[0][3][2*(b-1)],h=e[0][3][2*(b-1)+1]);e=b;1==d.btexact&&(e=d.bt[b-1]-1);var m=d.xpos+d.btd[2*e-2],q=d.ypos+d.btd[2*e-2+1],n=1;1==d.block?n=0:(4==f&&(n=0),5==f&&(n=5),6==f&&(n=6),7==f&&(n=7),9==f&&(n=5));var l=0,p=0;"buttons"==d.sig&&(l=0,p=5);b=d.bt[b-1];var r=[],t={};if(0<d.rules.length)for(var u=0;u<d.rules[e-1].length;u++)"tri"==
d.rules[e-1][u].t?(t={t:d.rules[e-1][u].t,d:[0,0,0,0,0,0]},t.d[0]=d.rules[e-1][u].d[0]+d.xpos,t.d[1]=d.rules[e-1][u].d[1]+d.ypos,t.d[2]=d.rules[e-1][u].d[2]+d.xpos,t.d[3]=d.rules[e-1][u].d[3]+d.ypos,t.d[4]=d.rules[e-1][u].d[4]+d.xpos,t.d[5]=d.rules[e-1][u].d[5]+d.ypos,r.push(t)):"circ"==d.rules[e-1][u].t&&(t={t:d.rules[e-1][u].t,d:[0,0,0]},t.d[0]=d.rules[e-1][u].d[0]+d.xpos,t.d[1]=d.rules[e-1][u].d[1]+d.ypos,t.d[2]=d.rules[e-1][u].d[2],r.push(t));m3d.ui.pCl.push([m,q-l,m+g,q+h+p,n,a,b,d.cb[b-2],d.fix,
d.multitouch,r]);this.refBt(m3d.ui.pCl.length-1,f,n,c,!0)},refBk:function(a,b){var c=mn[a].bki,d=1,f;f=""==mn[a].ctx?apctx:mn[a].ctx;var e;""==mn[a].mnbk?e=ap.mnbk[c[0]]:""!==c[0]&&(e=mn[a].mnbk[c[0]]);""===mn[a].fbkcanv||1!=mn[a].fbkcanv&&2!=mn[a].fbkcanv||(e=mn[a].bkcanv);""!==mn[a].canv?1==mn[a].canv&&(d=0):"undefined"!==typeof mn[a].bk&&(d=mn[a].bk);0==d?""!=mn[a].bkcolor?(f.fillStyle=mn[a].bkcolor,f.fillRect(mn[a].xpos,mn[a].ypos,mn[a].w,mn[a].h)):(1==b&&f.clearRect(mn[a].xpos,mn[a].ypos,mn[a].w,
mn[a].h),f.drawImage(canvasm,mn[a].cx,mn[a].cy,mn[a].w,mn[a].h,mn[a].xpos,mn[a].ypos,mn[a].w,mn[a].h)):""!=mn[a].bkcolor?(f.fillStyle=mn[a].bkcolor,f.fillRect(mn[a].xpos,mn[a].ypos,mn[a].w,mn[a].h)):(1==b&&f.clearRect(mn[a].xpos,mn[a].ypos,mn[a].w,mn[a].h),f.drawImage(e,mn[a].x,mn[a].y,mn[a].w,mn[a].h,mn[a].xpos,mn[a].ypos,mn[a].w,mn[a].h));f.shadowColor="transparent";f.globalAlpha=1},ref2:function(a,b){for(var c=0;c<a.length;c++){mn[a[c]].on=!0;b.tmpctx=mn[a[c]].ctx;b.tmpxpos=mn[a[c]].xpos;b.tmpypos=
mn[a[c]].ypos;b.btbkclear=mn[a[c]].btbkclear;mn[a[c]].ctx=b.ctx;mn[a[c]].xpos=0;mn[a[c]].ypos=0;mn[a[c]].btbkclear=!1;""!=mn[a[c]].mbot&&mn[a[c]].mbot(a[c]);1==mn[a[c]].drawbk&&("buttons"!=mn[a[c]].sig&&"buttonscustom"!=mn[a[c]].sig&&"buttonsdecor"!=mn[a[c]].sig&&"menu"!=mn[a[c]].sig&&"custom"!=mn[a[c]].sig&&"custom3"!=mn[a[c]].sig||this.refBk(a[c],!1));""!=mn[a[c]].customdecor&&mn[a[c]].customdecor();for(var d=0;d<mn[a[c]].bt.length;d++)this.refMenuBt(a[c],d+1,!1,!1);mn[a[c]].ctx=b.tmpctx;mn[a[c]].xpos=
b.tmpxpos;mn[a[c]].ypos=b.tmpypos;mn[a[c]].btbkclear=b.btbkclear;mn[a[c]].on=!1}},ref:function(){if("undefined"!==typeof apctx){apctx.clearRect(0,0,m3dcache.v.vw,m3dcache.v.vh);for(var a in m3d.ui.layersDiv)"undefined"!=typeof m3d.ui.layersDiv[a].ctx&&m3d.ui.initHtmlClear(m3d.ui.layersDiv[a].ctx,m3d.ui.layersDiv[a].w,m3d.ui.layersDiv[a].h);1==m3dcache.v.camerafOn&&(apctx.fillStyle="#000000",apctx.fillRect(0,0,m3dcache.v.vw,m3dcache.v.vh));m3d.ui.pCl=[];m3d.ui.pCl_s=[];for(a=0;a<mn_index.length;a++)if(1==
mn[mn_index[a]].on){""!=mn[mn_index[a]].mbot&&mn[mn_index[a]].mbot(mn_index[a]);1==mn[mn_index[a]].drawbk&&("buttons"!=mn[mn_index[a]].sig&&"buttonscustom"!=mn[mn_index[a]].sig&&"buttonsdecor"!=mn[mn_index[a]].sig&&"menu"!=mn[mn_index[a]].sig&&"custom"!=mn[mn_index[a]].sig&&"custom3"!=mn[mn_index[a]].sig||this.refBk(mn_index[a],!1));""!=mn[mn_index[a]].customdecor&&mn[mn_index[a]].customdecor();for(var b=0;b<mn[mn_index[a]].bt.length;b++)this.refMenuBt(mn_index[a],b+1,!1)}}},refBtEl:function(a){for(var b=
mn[a],c=[],d=0;d<m3d.ui.pCl.length;d++)m3d.ui.pCl[d][5]==a&&c.push(d);for(d=a=0;d<c.length;d++){a=d+1;a=b.set[b.bt[a-1]-2];var f=1;1==b.block?f=0:(4==a&&(f=0),5==a&&(f=5),6==a&&(f=6));m3d.ui.refBt(c[d],a,f,!0,!0)}}},lib:{nullFunc:function(){},statLog:function(){},statLog2:function(){},oKeyMatch:function(a,b){var c=!0,d;for(d in a)"undefined"==typeof b[d]&&(c=!1);if(1==c)for(d in b)"undefined"==typeof a[d]&&(c=!1);return c},oKeyValMatch:function(a,b){var c=!0,d;for(d in a)"undefined"==typeof b[d]&&
(c=!1);if(1==c)for(d in b)"undefined"==typeof a[d]?c=!1:a[d]!=b[d]&&(c=!1);return c},flashVarsGet:function(a){var b={browser:!0,storage:!0};"undefined"!==typeof m3dcache.setup.lang&&(b=m3dcache.setup.lang);"undefined"!==typeof a&&("undefined"!==typeof a.browser&&(b.browser=a.browser),"undefined"!==typeof a.storage&&(b.storage=a.storage));m3dcache.v.lng=m3d.lib.localeGet(m3dcache.i.stdres.langs,b);b=document.location.search.substr(1).split("&");a={};var c;for(i=0;i<b.length;i++)c=b[i].split("="),a[c[0]]=
c[1];b=a.go;curSubloc=a.d;m3dcache.v.commandVars=a;"undefined"!==typeof a.game&&(m3dcache.v.curGame=a.game);"undefined"!==typeof a.shop&&(m3dcache.v.shop=!0);"undefined"!==typeof a.book&&(m3dcache.v.book=!1);m3dcache.v.book=!1;"undefined"!==typeof a.v&&(m3dconf.ver=a.v);"undefined"!==typeof b?(m3dcache.v.passport=!1,curLoc=b):(curLoc="dion_center",m3dcache.v.passport=!1)},localeGet:function(a,b){var c={browser:!0,storage:!0};"undefined"!==typeof m3dcache.setup.langs&&(m3dcache.i.stdres.langs=m3dcache.setup.langs);
"undefined"!==typeof m3dcache.setup.lang&&(c=m3dcache.setup.lang);"undefined"!==typeof b&&("undefined"!==typeof b.browser&&(c.browser=b.browser),"undefined"!==typeof b.storage&&(c.storage=b.storage));m3dcache.v.lng=a[0];1==c.browser&&(m3dcache.v.lng=m3d.lib.getBrowserLang());1==c.storage&&"ok"==m3d.lib.storageIsKey("lng")&&(m3dcache.v.lng=localStorage.lng);var c=document.location.search.substr(1).split("&"),d={},f;for(i=0;i<c.length;i++)f=c[i].split("="),d[f[0]]=f[1];"undefined"!==typeof d.lang&&
(m3dcache.v.lng=d.lang);1>m3d.lib.in_arr_n(a,m3dcache.v.lng).length&&(m3dcache.v.lng="en");return m3dcache.v.lng},getBrowserLang:function(){return(window.navigator?window.navigator.language||window.navigator.systemLanguage||window.navigator.userLanguage:"en").substr(0,2).toLowerCase()},keyWaitD:{},keyWait:function(a,b){m3d.lib.keyWaitD.keys=a.keys;m3d.lib.keyWaitD.iteration=a.iteration;m3d.lib.keyWaitD.timeout=a.timeout;m3d.lib.keyWaitD.cb=b;m3d.lib.keyWaitD.t0=Date.now();m3d.lib.keyWait1()},keyWait1:function(){for(var a=
!0,b=0,c=window;b<m3d.lib.keyWaitD.keys.length;)"undefined"!==typeof c[m3d.lib.keyWaitD.keys[b]]?(c=c[m3d.lib.keyWaitD.keys[b]],b++):(a=!1,b=m3d.lib.keyWaitD.keys.length);1==a?m3d.lib.keyWaitD.cb(!0):(a=!1,0<m3d.lib.keyWaitD.timeout&&Date.now()-m3d.lib.keyWaitD.t0>m3d.lib.keyWaitD.timeout&&(a=!0),1==a?m3d.lib.keyWaitD.cb(!1):setTimeout(function(){m3d.lib.keyWait1()},m3d.lib.keyWaitD.iteration))},addListner:function(a,b,c){a.addEventListener?a.addEventListener(b,c,{passive:!1}):a.attachEvent&&a.attachEvent(b,
function(){c.call(a,window.event)})},in_arr_n:function(a,b){for(var c=[],d=0;d<a.length;d++)a[d].toString()==b.toString()&&c.push(d);return c},randInt:function(a,b){var c=a-.5+Math.random()*(b-a+1);return c=Math.round(c)},arTemp:function(a,b){for(var c in b)for(var d=0;d<a.length;d++)"undefined"==typeof a[d][c]&&(a[d][c]=b[c])},translateRange:function(a,b,c,d,f){var e=0;a<b?e=d:a>c?e=f:(e=(a-b)/(c-b)*(f-d)+d,e>f&&(e=f));return e},splitArray2:function(a,b){res=[];for(var c=0;c<b.length;c++)res.push([]);
for(c=0;c<a.length;c++)for(j=b.length-1;0<=j;)a[c][0]>=b[j]&&(res[j].push(a[c]),j=0),j--;for(var d=[],c=res.length-1;0<=c;c--)0<res[c].length&&d.push(res[c]);return d},splitSum:function(a,b){for(var c=[],d,f=a,e=0;e<b.length;e++)d=Math.floor(f/b[e]),0<d&&(c.push([b[e],d]),f-=b[e]*d);return c},textBgHtml:function(a,b,c,d,f,e,g,h){d=[{},{},{},{},{},{},{},{},{}];for(f=0;9>f;f++)d[f]=m3d.ui.mnCreateCanvasFree(h[4*f+2],h[4*f+3],"","","",1,1),d[f].ctx.drawImage(a,b+h[4*f+0],c+h[4*f+1],h[4*f+2],h[4*f+3],
0,0,h[4*f+2],h[4*f+3]),d[f].data=d[f].canv.toDataURL();a='<table style="border-collapse:collapse; border-spacing:0px; text-align:left;" cellpadding="0" cellspacing="0">'+('<tr> <td style="width:'+h[2]+"px; height:"+h[3]+"px; background-image:url("+d[0].data+');"></td> <td style="height:'+h[7]+"px; background-image:url("+d[1].data+'); background-repeat:repeat-x;"></td> <td style="width:'+h[10]+"px; height:"+h[11]+"px; background-image:url("+d[2].data+');"></td> </tr>');a+='<tr> <td style="width:'+
h[14]+"px; background-image:url("+d[3].data+'); background-repeat:repeat-y;"></td> <td style="background-image:url('+d[4].data+'); background-repeat:repeat;"><div id="'+e+'">'+g+'</div></td> <td style="width:'+h[22]+"px; background-image:url("+d[5].data+'); background-repeat:repeat-y;"></td> </tr>';a+='<tr> <td style="width:'+h[26]+"px; height:"+h[27]+"px; background-image:url("+d[6].data+');"></td> <td style="height:'+h[31]+"px; background-image:url("+d[7].data+'); background-repeat:repeat-x;"></td> <td style="width:'+
h[34]+"px; height:"+h[35]+"px; background-image:url("+d[8].data+');"></td> </tr>';return a+"</table>"},fArr:function(a,b){m3d.lib.fArrData.data=a;m3d.lib.fArrData.n=a.length;m3d.lib.fArrData.ii=-1;m3d.lib.fArrData.cb=b;m3d.lib.fArr2()},fArr2:function(){m3d.lib.fArrData.ii++;m3d.lib.fArrData.ii<m3d.lib.fArrData.n?(m3d.lib.fArrData.data[m3d.lib.fArrData.ii].f(),0==m3d.lib.fArrData.data[m3d.lib.fArrData.ii].cb&&m3d.lib.fArrCont()):m3d.lib.fArrData.cb()},fArrCont:function(){setTimeout(function(){m3d.lib.fArr2()},
m3d.lib.fArrData.data[m3d.lib.fArrData.ii].t)},fArrData:{},exitGameCore:function(){m3d.lib.postMessageSendParent("main_mexitgame",m3dcache.i.corehost)},exitGameCoreProc:function(){m3d.ui.mnOn(["main"]);m3d.ui.layersDiv.main.div.style.display="block";m3dcore.mnMainTeleport()},exitGameCoreLong:function(){m3d.ui.mnOn(["main"]);m3d.ui.layersDiv.main.div.style.display="block";m3dcore.mnMainTeleport()},postMessage:{sender:"",handler:function(){}},postMessageInit:function(a,b){m3d.lib.postMessage.sender=
a;window.addEventListener?window.addEventListener("message",m3d.lib.postMessageListener,!1):window.attachEvent("onmessage",m3d.lib.postMessageListener)},postMessageSend:function(a,b){document.getElementById("iframegame").contentWindow.postMessage(a,b)},postMessageSendParent:function(a,b){"frame"==m3dconf.connect&&parent.postMessage(a,b)},postMessageListener:function(a){var b=a.origin;a=a.data;b===m3d.lib.postMessage.sender&&("main_clearScene"==a?(m3d.graph.clearScene(),m3d.lib.postMessageSendParent("main_clearSceneOk",
m3dcache.i.corehost)):"main_clearSceneOk"==a?m3dcore.clearSceneFrameReply():"main_apLoaded"==a?(m3d.ui.layersDiv.mexit.div.style.display="block",m3dcore.mnMainMatOn(),m3d.ui.ref()):"main_apLoaded_minify"==a?(m3d.ui.layersDiv.mexit.div.style.display="block",m3dcore.mnMainMatOff(),m3d.lib.postMessageSendParent("main_btClick_main1_off",m3dcache.i.corehost),m3dcore.mnMainControlsOff(),m3d.ui.ref()):"main_mnMainOff"==a?(m3dcore.mnMainMatOff(),m3d.ui.ref()):"main_btClick_main1"==a?m3d.core.mnMainControls():
"main_btClick_main1_on"==a?m3dcore.mnMainControlsOn():"main_btClick_main1_x2"==a?m3dcore.mnMainControlsOn():"main_btClick_main1_off"==a?m3dcore.mnMainControlsOff():"main_camera_on"==a?m3d.core.mnMailCamera():"main_exitMenu"==a?m3d.uf.exitMenu():"main_setTeleportFull"==a?(mn.teleport.mode=1,mn.teleport.bttotal=mn.teleport.bapp,mn.teleport.bt=[2,3,4,5,6,7,8,9,10],mn.teleport.bts=mnb.teleport,m3dcore.menuInit(),m3dcore.menuSetPos(),m3d.ui.ref()):"main_setTeleportShort"==a?(mn.teleport.mode=2,mn.teleport.bttotal=
1,mn.teleport.bt=[2],mn.teleport.bts=mnb.teleport_game,m3dcore.menuInit(),m3dcore.menuSetPos(),m3d.ui.ref()):"main_setgraph_on"==a?m3d.core.mnPersonSetGraph():"main_shophouse_on"==a?ap.mnTeleportShopHouse():"main_mexitgame"==a?m3d.lib.exitGameCoreProc():"main_mexitvar_on"==a?m3d.core.mnMainExitCl():"main_mexitvar_off"==a?m3d.core.mnMainExitVarClose():m3d.lib.postMessage.handler(b,a))},globalTimer:{events:{},interval:0,globalInterval:"",on:!1,minInterval:function(a){var b=0,c;for(c in a)1==a[c].active&&
(0==b?b=a[c].ti:a[c].ti<b&&(b=a[c].ti));return b},addEvent:function(a){this.events[a.name]=a;var b=Date.now();this.events[a.name].t0=b;this.events[a.name].active=!0;this.events[a.name].f(b);a=this.minInterval(this.events);this.interval!=a&&(this.interval=a,this.start())},stop1:function(a){this.events[a].active=!1;a=this.minInterval(this.events);this.interval!=a&&(this.interval=a,this.start())},start1:function(a){this.events[a].active=!0;a=this.minInterval(this.events);this.interval!=a&&(this.interval=
a,this.start())},start:function(a){m3d.lib.globalTimer.stop();m3d.lib.globalTimer.on=!0;this.globalInterval=setInterval(function(){m3d.lib.globalTimer.update()},m3d.lib.globalTimer.interval)},stop:function(){clearInterval(m3d.lib.globalTimer.globalInterval);m3d.lib.globalTimer.on=!1},update:function(){var a=Date.now(),b=this.events,c;for(c in b)1==b[c].active&&b[c].t0<=a-b[c].ti&&(b[c].t0=a,b[c].f(a))}},globalTimerSoft:{events:{},interval:0,on:!1,t:0,t0:0,mode:0,minInterval:function(a){var b=0,c;
for(c in a)1==a[c].active&&(0==b?b=a[c].ti:a[c].ti<b&&(b=a[c].ti));return b},addEvent:function(a){this.events[a.name]=a;var b=Date.now();this.events[a.name].t0=b;this.events[a.name].active=!0;this.events[a.name].f(b);a=this.minInterval(this.events);this.interval!=a&&(this.interval=a,this.start())},stop1:function(a){this.events[a].active=!1;a=this.minInterval(this.events);this.interval!=a&&(this.interval=a,this.start())},start1:function(a){this.events[a].active=!0;a=this.minInterval(this.events);this.interval!=
a&&(this.interval=a,this.start())},start:function(a){m3d.lib.globalTimerSoft.on=!0;m3d.lib.globalTimerSoft.mode=2;m3d.lib.globalTimerSoft.t0=Date.now();m3d.lib.globalTimerSoft.t=Date.now()},stop:function(){m3d.lib.globalTimerSoft.on=!1;m3d.lib.globalTimerSoft.mode=0},update:function(){var a=Date.now();if(m3d.lib.globalTimerSoft.t0<=a-m3d.lib.globalTimerSoft.interval){m3d.lib.globalTimerSoft.t0=a;var b=this.events,c;for(c in b)1==b[c].active&&b[c].t0<=a-b[c].ti&&(b[c].t0=a,b[c].f(a))}}},anim:{anims:[],
laststate:[],laststatep:[],self:{},msec:1,playing:!1,cb:function(){},clear:function(){m3d.lib.anim.anims=[]},astopAll:function(){for(var a in m3d.lib.anim.anims)for(var b=0;b<m3d.lib.anim.anims[a].length;b++)m3d.lib.anim.astop(a,b)},stopAnim:function(a,b){for(var c=0;c<m3d.lib.anim.anims[a].length;c++)m3d.lib.anim.anims[a][c].id==b&&m3d.lib.anim.astop(a,c)},clearIdle:function(a){for(var b=!1,c=0;c<m3d.lib.anim.anims[a].length;c++)1==m3d.lib.anim.anims[a][c].playing&&(b=!0);0==b&&(m3d.lib.anim.anims[a]=
[])},clearFinished:function(a){for(var b=!1,c=0;c<m3d.lib.anim.anims[a].length;c++)0==m3d.lib.anim.anims[a][c].finished&&(b=!0);0==b&&(m3d.lib.anim.anims[a]=[])},astop:function(a,b){var c=[];if("undefined"!==typeof m3d.lib.anim.anims[a]&&"undefined"!==typeof m3d.lib.anim.anims[a][b]){m3d.lib.anim.anims[a][b].t=1;m3d.lib.anim.anims[a][b].finished=!0;for(var d=0;d<m3d.lib.anim.anims[a][b].par.length;d++)m3d.lib.anim.anims[a][b].par[d].tfin=1,m3d.lib.anim.anims[a][b].par[d].t=1,c.push(m3d.lib.anim.anims[a][b].par[d].state)}return c},
apause:function(a,b){var c=[];if("undefined"!==typeof m3d.lib.anim.anims[a]&&"undefined"!==typeof m3d.lib.anim.anims[a][b]){m3d.lib.anim.anims[a][b].finished=!0;for(var d=0;d<m3d.lib.anim.anims[a][b].par.length;d++)c.push(m3d.lib.anim.anims[a][b].par[d].state)}return c},acontinue:function(a,b,c){"undefined"!==typeof m3d.lib.anim.anims[a]&&"undefined"!==typeof m3d.lib.anim.anims[a][b]&&(m3d.lib.anim.anims[a][b].finished=!1)},spriteVideoSet:function(a){var b=document.createElement("canvas");b.width=
a.w;b.height=a.h;b.style.width=a.w+"px";b.style.height=a.h+"px";var c=b.getContext("2d");c.clearRect(0,0,a.w,a.h);var d="undefined"==typeof m3d.lib.anim.anims[a.stream]?0:m3d.lib.anim.anims[a.stream]==[]?0:m3d.lib.anim.anims[a.stream].length+1;m3d.lib.anim.anims[a.stream]=[];for(var d=0,f=[],e,g=0;g<a.sprites.length;g++)e=a.sprites[g].spriteData.length-1,f.push({lim1:0,lim2:e,sstart:0,t:a.sprites[g].duration,sfin:e,sfinpass:100});m3d.lib.anim.add(a.name,a.stream,1E3*a.playtime,"and",{animi:d,sprites:a.sprites,

w:a.w,h:a.h,duration:a.playtime,ctx:a.ctx,tctx:c,tcanv:b,sc:a.scale,stream:a.stream,par:a.par,clockBy:a.clockBy,fDirection:a.fDirection},f,function(){m3d.lib.anim.maskedVideoAnim(this)},a.fStop);return{anim:m3d.lib.anim.anims[a.stream][d],stream:a.stream,n:d}},maskedVideoAnim:function(a){var b=a.userpar.clockBy;if(a.par[b].state!=a.par[b].state_old){var c,b=a.userpar.w,d=a.userpar.h,f=a.userpar.sprites;a.userpar.tctx.clearRect(0,0,b,d);for(var e=0;e<f.length-0;e++)c=f[e].spriteImages[a.par[e].state],
a.userpar.tctx.drawImage(c,0,0,b,d,0,0,b,d);-1==a.userpar.fDirection()&&(c=m3d.ui.reflectImg(a.userpar.tcanv,1),a.userpar.tcanv=c.canv,a.userpar.tctx=c.ctx);c=7*ap.game.level.bw+ap.game.level.bw2-ap.game.state.persSprite.bod.w2;f=6*ap.game.level.bh-ap.game.state.persSprite.bod.h;m3d.ui.layers.pers.ctx.clearRect(c,f,ap.game.state.persSprite.bod.w,ap.game.state.persSprite.bod.h);m3d.ui.layers.pers.ctx.drawImage(a.userpar.tcanv,0,0,b,d,c,f,ap.game.state.persSprite.bod.w,ap.game.state.persSprite.bod.h)}},
add:function(a,b,c,d,f,e,g,h){m3d.lib.anim.self=this;a={id:a,t:Math.floor(c),t0:Date.now(),logic:d,par:e,fun:g,fun2:h,limFlag:!1,finished:!1,playing:!1,userpar:f};a.t0_copy=a.t0;for(d=0;d<e.length;d++)a.par[d].rev=0,a.par[d].revf=!1,e[d].lim1>e[d].lim2&&(a.par[d].revf=!0,a.par[d].rev=e[d].lim1,e[d].lim1=e[d].lim2,e[d].lim2=a.par[d].rev,f=e[d].sstart,e[d].sstart=e[d].sfin,e[d].sfin=f),a.par[d].sfinpassi=0,a.par[d].sfinpass="undefined"==typeof e[d].sfinpass?0:e[d].sfinpass,a.par[d].state=e[d].lim1,
a.par[d].state_old=e[d].sstart,a.par[d].tfin=a.par[d].t+a.t0,a.par[d].constState=(e[d].lim2-e[d].lim1)/c,-1!=e[d].sfin&e[d].sstart>e[d].sfin?(a.par[d].pass1fin=!0,a.par[d].scycle2=e[d].lim2):(a.par[d].pass1fin=!1,a.par[d].scycle2=e[d].sfin),0!=a.par[d].t&&(a.par[d].scycle2=e[d].lim2,a.par[d].pass1fin=!0),a.par[d].dtstart=e[d].sstart==e[d].lim1?0:Math.floor(c*(e[d].sstart-e[d].lim1)/(e[d].lim2-e[d].lim1)),a.par[d].dtfirst=c-a.par[d].dtstart,1==a.par[d].forceEnd&&(a.par[d].tfin=1);if(b>this.anims.length-
1)for(d=this.anims.length-1;d<b;d++)this.anims.push([]);this.anims[b].push(a);return this.anims[b][this.anims[b].length-1]},play:function(){0==m3d.lib.anim.playing&&m3d.lib.anim.playF()},playF:function(){var a=m3d.lib.anim.self;a.playing=!0;for(var b=!1,c=!0,d=Date.now(),f=0,e=c=0,g=0,h=f=0,m=!1,q=0,n=0,g={},l=0;l<a.anims.length;l++)for(e=0,c=!0,0==a.anims[l].length&&(c=!1);1==c;){if(0==a.anims[l][e].finished){0==a.anims[l][e].playing&&(m=a.anims[l][e].playing=!0,"undefined"!==typeof a.anims[l][e].userpar.fPlayBeforeAnim&&
a.anims[l][e].userpar.fPlayBeforeAnim());c=d-a.anims[l][e].t0;a.anims[l][e].limFlag=!1;for(var q=a.anims[l][e].par.length,p=n=0;p<q;p++)if(g=a.anims[l][e].par[p],f=c+g.dtstart,0==m&&(a.anims[l][e].par[p].state_old=a.anims[l][e].par[p].state),f=h=Math.floor(g.constState*f)+g.lim1,1==a.anims[l][e].par[p].revf&&(f=a.anims[l][e].par[p].rev-f+g.lim1),a.anims[l][e].par[p].state=f,1==g.forceEnd&&(a.anims[l][e].par[p].tfin=1),h>=g.scycle2?(a.anims[l][e].par[p].dtstart=0,f=h=g.scycle2,1==a.anims[l][e].par[p].revf&&
(f=a.anims[l][e].par[p].rev-f+g.lim1),a.anims[l][e].par[p].state=f):h<g.lim1&&(f=h=g.lim1,1==a.anims[l][e].par[p].revf&&(f=a.anims[l][e].par[p].rev-f+g.lim1),a.anims[l][e].par[p].state=f),0==g.t?h<g.scycle2?b=!0:(a.anims[l][e].par[p].sfinpassi<a.anims[l][e].par[p].sfinpass&&(a.anims[l][e].par[p].pass1fin=!0,g.pass1fin=!0),a.anims[l][e].par[p].sfinpassi++,0==g.pass1fin?n++:(b=!0,a.anims[l][e].t0=d,a.anims[l][e].limFlag=!0,f=h=a.anims[l][e].par[p].scycle2,1==a.anims[l][e].par[p].revf&&(f=a.anims[l][e].par[p].rev-
f+g.lim1),a.anims[l][e].par[p].state=f,a.anims[l][e].par[p].pass1fin=!1,a.anims[l][e].par[p].scycle2=g.sfin)):d<=g.tfin?(b=!0,h>=g.scycle2&&(a.anims[l][e].t0=d,a.anims[l][e].limFlag=!0,f=h=a.anims[l][e].par[p].scycle2,1==a.anims[l][e].par[p].revf&&(f=a.anims[l][e].par[p].rev-f+g.lim1),a.anims[l][e].par[p].state=f)):-1==g.sfin?n++:(a.anims[l][e].par[p].t=0,g.t=0,a.anims[l][e].par[p].pass1fin=!0),n>=q){if(a.anims[l][e].finished=!0,f=h=a.anims[l][e].par[p].scycle2,1==a.anims[l][e].par[p].revf&&(f=a.anims[l][e].par[p].rev-
f+g.lim1),a.anims[l][e].par[p].state=f,m3d.lib.anim.laststate[l]=f,g=a.anims[l].length-1,g>e)for(g=e+1,b=!0,a.anims[l][g].t0=Date.now(),a.anims[l][g].t0_copy=a.anims[l][g].t0,f=0;f<a.anims[l][g].par.length;f++)a.anims[l][g].par[f].tfin=a.anims[l][g].par[f].t+Date.now()}else b=!0;a.anims[l][e].fun();n>=q&&(0==b&&(m3d.lib.anim.playing=!1),a.anims[l][e].fun2());"undefined"!=typeof a.anims[l]&&(e=a.anims[l].length);c=!1}e++;1==c&&e>=a.anims[l].length&&(c=!1)}1==b?(m3d.lib.anim.cycleF(),apcontrolsRenderBackAnim()):
(m3d.lib.anim.playing=!1,m3d.lib.anim.cb(),m3d.lib.anim.cb=function(){})},cycleF:function(){}},playSound:function(a){},TextMeasure:function(a,b,c){a.font=c;return a.measureText(b).width},Tex2Width:function(a,b,c,d,f,e,g,h,m){res={};m=m3d.ui.mnCreateCanvasFree(d,f,"",{},0,1,1);m.ctx.font=b;m.ctx.fillStyle=c;b=m.ctx.measureText(a).width;b>h?(m.ctx.fillText(a,e,g),a=Math.floor((d-h)/2),m.ctx.clearRect(d-a,0,a,f)):(e=Math.floor((d-b)/2),m.ctx.fillText(a,e,g));res.ctx=m.ctx;res.canv=m.canv;return res},
Tex2Canvas:function(a,b,c,d,f,e,g,h,m,q,n){a.font=c;a.fillStyle=f;c=0;f=e;var l=!1;m=1;b=b.split("<br/>");for(n=0;n<b.length;n++)b[n]=b[n].split(" ");for(n=0;n<b.length;n++)for(var l="",p=0,r="",t=0;t<b[n].length;){for(m=0;p<h&t<b[n].length;)l=r,r=l+b[n][t]+" ",p=a.measureText(r).width,p<h?(t++,m++):0<m?r=l:t++;l=!1;m=a.measureText(r).width;"center"==q&&(f=e+Math.round((h-m)/2));"right"==q&&(f=e+Math.round(h-m));"center-lim"==q&&(m>h&&(m=h),1>m&&(m=1),f=e+Math.round((h-m)/2),l=!0);0==l?a.fillText(r,
f,c*d+g):a.fillText(r,f,c*d+g,m);""==r&&(t=b[n].length+1);c++;r="";p=0}return Math.round(m)},ticker:{stopped:!1,characterTimeout:50,storyTimeout:5E3,widgetOn:!1,widget:["","_","."],leadString:"",currentStory:0,currentLength:0,theItemCount:0,myTimeout:0,storySummary:0,elem:[],t:[]},startTicker:function(){m3d.lib.ticker.stopped=!1;m3d.lib.ticker.itemCount=m3d.lib.ticker.t.length;m3d.lib.ticker.currentStory=-1;m3d.lib.ticker.currentLength=0;m3d.lib.runTheTicker()},stopTicker:function(){m3d.lib.ticker.stopped=
!0},runTheTicker:function(){0==m3d.lib.ticker.stopped&&(0==m3d.lib.ticker.currentLength&&(m3d.lib.ticker.currentStory++,m3d.lib.ticker.currentStory%=m3d.lib.ticker.itemCount,theAnchorObject=document.getElementById(m3d.lib.ticker.elem[m3d.lib.ticker.currentStory]),m3d.lib.ticker.storySummary=m3d.lib.ticker.t[m3d.lib.ticker.currentStory].replace(/&quot;/g,'"')),"<"==m3d.lib.ticker.storySummary.substr(m3d.lib.ticker.currentLength-1,1)?m3d.lib.ticker.currentLength+=5:theAnchorObject.innerHTML=m3d.lib.ticker.storySummary.substring(0,
m3d.lib.ticker.currentLength)+m3d.lib.whatWidget(),m3d.lib.ticker.currentLength<m3d.lib.ticker.storySummary.length?(m3d.lib.ticker.currentLength++,m3d.lib.ticker.myTimeout=m3d.lib.ticker.characterTimeout):(m3d.lib.ticker.currentLength=0,m3d.lib.ticker.myTimeout=m3d.lib.ticker.storyTimeout),setTimeout(function(){m3d.lib.runTheTicker()},m3d.lib.ticker.myTimeout))},whatWidget:function(){return 1==m3d.lib.ticker.widgetOn?m3d.lib.ticker.currentLength==m3d.lib.ticker.storySummary.length?m3d.lib.ticker.widget[0]:
1==m3d.lib.ticker.currentLength%2?m3d.lib.ticker.widget[1]:m3d.lib.ticker.widget[2]:""},getUrlVar:function(){var a=[],b=[],c=[],a=window.location.search.substr(1).split("&");if(""==a[0])return[];for(var c=[],d=0;d<a.length;d++)b=a[d].split("="),void 0==b[1]&&(b[1]=""),c.push([b[0],b[1]]);return c},urlGetKeyValue:function(a,b){for(var c="",d=0;d<b.length;d++)b[d][0]==a&&(c=b[d][1]);return c},addUrlVar:function(a,b,c){for(var d={ar:[],str:""},f=!1,e=0;e<c.length;e++)c[e][0]==a&&(f=!0,c[e][0]=a,c[e][1]=
b);0==f&&c.push([a,b]);for(e=0;e<c.length;e++)d.str+=c[e][0]+"="+c[e][1],e<c.length-1&&(d.str+="&");return d},urlGetEmpty:function(){for(var a=[],b=m3d.lib.getUrlVar(),c=0;c<b.length;c++)""==b[c][1]&&a.push(b[c][0]);return a},urlGo:function(a,b,c){"undefined"!==typeof history.pushState?history.pushState({page:a},b,c):window.location.assign(c)},urlReplace:function(a,b,c,d){var f=d.val,e="",g=!1,h="",m=!1;"undefined"!==typeof d.skey&&(e=d.skey);"undefined"!==typeof d.svale&&(g=!0);"undefined"!==typeof d.delkey&&
(h=d.delkey);"undefined"!==typeof d.delkeye&&(m=!0);d=m3d.lib.getUrlVar();for(var q=!1,n=0;n<d.length;n++)1==g&&""==d[n][1]&&(q=!0),d[n][0]==e&&(q=!0),d[n][0]==h&&(q=!0);var l=[];0==q&&(1==g&&d.push(["",""]),""!=e&&d.push([e,f]));for(n=0;n<d.length;n++)q=!1,1==g&&""==d[n][1]&&(l.push(f),q=!0),1==m&&""==d[n][1]&&(q=!0),""!=e&&d[n][0]==e&&(q=!0,l.push(e+"="+f)),""!=h&&d[n][0]==h&&(q=!0),0==q&&l.push(d[n][0]+"="+d[n][1]);suargs=l.join("&");f="";f=""==suargs?c:c+"?"+suargs;"undefined"!==typeof history.pushState?
history.pushState(a,b,f):window.location.assign(f)},storageAdd:function(a,b){var c="ok";if("undefined"==typeof b)c="undefined";else if("localStorage"in window&&null!==window.localStorage)try{localStorage.setItem(a,b)}catch(d){d==QUOTA_EXCEEDED_ERR&&(c="overflow")}else c="not supported";return c},storageRemove:function(a){if("localStorage"in window&&null!==window.localStorage)try{localStorage.removeItem(a)}catch(b){}},storageIsKey:function(a){var b="no";if("localStorage"in window&&null!==window.localStorage)try{"undefined"!==
typeof localStorage[a]&&(b="ok")}catch(c){}return b},setClassStyle:function(a,b){var c=document.createElement("style");if(c){c.setAttribute("type","text/css");var d=document.createTextNode("."+a+" {"+b+"}");c.styleSheet?c.styleSheet.cssText=d.nodeValue:c.appendChild(d);(d=document.getElementsByTagName("head")[0])&&d.appendChild(c)}},loadImageSync:function(a,b,c){1==m3dcache.v.idb?web5Manager.getFile(b,{p:b,i:a,c:c},function(a,b,c){"ok"==a?(b.i.onload=function(){b.c()},b.i.src="data:image/gif;base64,"+
c):(b.i.onload=function(){b.c()},b.i.src=b.p)}):(a.onload=function(){c()},a.src=b)},loadImagesAsync:function(a,b,c,d,f){m3d.lib.loadImagesAsyncD={callb:f,callbi:d,n:a.length,pos:c-1,i:0};2>a.length&&m3d.lib.loadImagesAsyncD.callb();for(c=1;c<a.length;c++)b[c+m3d.lib.loadImagesAsyncD.pos]=new Image,b[c+m3d.lib.loadImagesAsyncD.pos].onload=function(){m3d.lib.loadImagesAsyncD.callbi();m3d.lib.loadImagesAsyncD.i++;m3d.lib.loadImagesAsyncD.i==m3d.lib.loadImagesAsyncD.n-1&&m3d.lib.loadImagesAsyncD.callb()},
b[c+m3d.lib.loadImagesAsyncD.pos].src=m3dcache.i.appath+a[0]+a[c]},loadImagesAsyncList:function(a,b,c,d,f,e){m3d.lib.loadImagesAsyncD={callb:e,cpar:f,callbi:d,n:a.length,posdata:c,i:0};2>a.length&&m3d.lib.loadImagesAsyncD.callb(m3d.lib.loadImagesAsyncD.cpar);for(c=1;c<a.length;c++)b[m3d.lib.loadImagesAsyncD.posdata[c-1]]=new Image,b[m3d.lib.loadImagesAsyncD.posdata[c-1]].onload=function(){m3d.lib.loadImagesAsyncD.callbi();m3d.lib.loadImagesAsyncD.i++;m3d.lib.loadImagesAsyncD.i==m3d.lib.loadImagesAsyncD.n-
1&&m3d.lib.loadImagesAsyncD.callb(m3d.lib.loadImagesAsyncD.cpar)},b[m3d.lib.loadImagesAsyncD.posdata[c-1]].src=a[0]+a[c]},loadImagesAsyncObj:function(a,b,c,d,f,e){m3d.lib.loadImagesAsyncD={callb:e,cpar:f,callbi:d,n:a.length,posdata:c,i:0};2>a.length&&m3d.lib.loadImagesAsyncD.callb(m3d.lib.loadImagesAsyncD.cpar);for(c=1;c<a.length;c++)b[m3d.lib.loadImagesAsyncD.posdata[c-1]]=new Image,b[m3d.lib.loadImagesAsyncD.posdata[c-1]].onload=function(){var a=m3d.lib.loadImagesAsyncD.i;m3d.lib.loadImagesAsyncD.callbi(a,
m3d.lib.loadImagesAsyncD.posdata[a]);m3d.lib.loadImagesAsyncD.i++;m3d.lib.loadImagesAsyncD.i==m3d.lib.loadImagesAsyncD.n-1&&m3d.lib.loadImagesAsyncD.callb(m3d.lib.loadImagesAsyncD.cpar)},b[m3d.lib.loadImagesAsyncD.posdata[c-1]].src=a[0]+a[c]},loadImagesAsyncListData:function(a,b,c,d,f,e,g){f={callb:g,cpar:e,callbi:d,n:a.length,posdata:c,i:0};2>a.length&&f.callb(f.cpar);for(c=1;c<a.length;c++)b[f.posdata[c-1]]=new Image,b[f.posdata[c-1]].onload=function(){f.callbi();f.i++;f.i==f.n-1&&f.callb(f.cpar)},
b[f.posdata[c-1]].src=a[0]+a[c]},inBlock:function(a,b,c,d,f,e,g,h,m,q,n){a={clipx:0,clipy:0,x:a,y:b,w:c,h:d,scale:1};"resize"==n&&(n=h,b=Math.floor(n*c/d),b>g&&(b=g,n=Math.floor(b*d/c)),a.w=b,a.h=n);"center"==m?a.clipx=(g-a.w)/2:"right"==m&&(a.clipx=g-a.w);"center"==q?a.clipy=(h-a.h)/2:"bottom"==q?a.clipy=h-a.h:"top"==q&&(a.clipy=0);a.clipx=Math.floor(a.clipx);a.clipy=Math.floor(a.clipy);a.x=Math.floor(a.x);a.y=Math.floor(a.y);a.w=Math.floor(a.w);a.h=Math.floor(a.h);a.scale=a.h/d;return a},visibilityInit:function(){var a;
"undefined"!==typeof document.hidden?(m3dcache.v.visibility="hidden",m3dcache.v.visibilityHidden="hidden",a="visibilitychange",m3dcache.v.visibilityState="visibilityState"):"undefined"!==typeof document.mozHidden?(m3dcache.v.visibility="mozHidden",m3dcache.v.visibilityHidden="mozHidden",a="mozvisibilitychange",m3dcache.v.visibilityState="mozVisibilityState"):"undefined"!==typeof document.msHidden?(m3dcache.v.visibility="msHidden",m3dcache.v.visibilityHidden="msHidden",a="msvisibilitychange",m3dcache.v.visibility=
"msVisibilityState"):"undefined"!==typeof document.webkitHidden&&(m3dcache.v.visibility="webkitHidden",m3dcache.v.visibilityHidden="webkitHidden",a="webkitvisibilitychange",m3dcache.v.visibilityState="webkitVisibilityState");m3dcache.v.visibile=function(){return!document[m3dcache.v.visibility]};m3d.lib.addListner(window,a,function(a){})},mnPreloadImages:function(a,b,c,d){m3d.lib.loadImagesAsyncList(a,m3d.core.mnbk,b,m3d.lib.nullFunc,[d,c],function(a){a[0](a[1])})},loadScriptImages:function(a,b,c){m3d.lib.loadScriptImagesD=
{pth:a,ar:b,i:0,iend:0,cb:c,data:[]};m3d.lib.loadScriptImagesD.iend=b.length;m3d.lib.loadScriptImages1()},loadScriptImages1:function(){url=m3d.lib.loadScriptImagesD.pth+m3d.lib.loadScriptImagesD.ar[m3d.lib.loadScriptImagesD.i];var a=document.createElement("script");a.type="text/javascript";a.src=url;a.async=!0;document.getElementsByTagName("head")[0].appendChild(a)},loadScriptImagesLoaded:function(a){var b=document.createElement("img");b.onload=function(){m3d.lib.loadScriptImagesD.data.push(b);m3d.lib.loadScriptImagesD.i++;
m3d.lib.loadScriptImagesD.i<m3d.lib.loadScriptImagesD.iend?m3d.lib.loadScriptImages1():m3d.lib.loadScriptImagesD.cb(m3d.lib.loadScriptImagesD.data)};b.src="data:image/gif;base64,"+a.replace(/^data:image\/(png|jpg);base64,/,"")}},contr:{controlsInit:function(a,b,c,d,f){contr=new m3d.contr.controlsOController(apscene.camera);contr.x=a;contr.y=b;contr.z=c;contr.direction=d*Math.PI;contr.angle=f;contr.angle0=f;contr.fshadows=m3dcache.v.shadows;""!=apscene.scene&&(1==m3dcache.v.lightD&&(contr.shLightD=
!0,contr.cameraForShadowStep=50,contr.cameraForShadowXold=0,contr.cameraForShadowZold=0,contr.Lx=ap.locd.lightD[6],contr.Lz=ap.locd.lightD[8],contr.Px=ap.locd.lightD[9],contr.Pz=ap.locd.lightD[11],contr.shl=ap.locd.lightD[12],contr.shr=ap.locd.lightD[13],contr.sht=ap.locd.lightD[14],contr.shb=ap.locd.lightD[15]),contr.controlsUpdateCamera(),m3d.contr.renderAll())},controlsRestoreAll:function(){contr.btFun.fw=m3d.contr.controlsStdBtFunFw;contr.btFun.bk=m3d.contr.controlsStdBtFunBk;contr.btFun.lt=m3d.contr.controlsStdBtFunLt;
contr.btFun.rt=m3d.contr.controlsStdBtFunRt;contr.tchBtFun.fw=m3d.contr.controlsStdTchBtFunFw;contr.tchBtFun.bk=m3d.contr.controlsStdTchBtFunBk;contr.tchBtFun.lt=m3d.contr.controlsStdTchBtFunLt;contr.tchBtFun.rt=m3d.contr.controlsStdTchBtFunRt},controlsCollisionsOn:function(){contr.collisionDetectorF=m3d.contr.controlsCollisionDetector},controlsCollisionsOff:function(){contr.collisionDetectorF=m3d.contr.controlsCollisionDetectorSkip},initStartFunctions:function(){this.controlsOController=function(a){this.contrStop=
function(){};this.contrLiveFalse=function(){};this.controlsMode=1;this.forceUpdateCamera=!1;this.camera=a;this.z1=this.y1=this.x1=this.z0=this.y0=this.x0=this.z=this.y=this.x=0;this.angle=this.angle0=.2;this.direction=0;this.distancez=this.distancey=this.distancex=this.distance=5E-5;this.mouseYRel=this.mouseXRel=0;this.minAngle=-1;this.maxAngle=1.57;this.speedLow=.9;this.speedPers=this.speedHigh=1.8;this.speed=.9;this.mousetd_frame=25;this.btCtrl=this.btShift=!1;this.speedSave=this.speedHigh;this.mouset0=
this.intersTm=this.collTm=0;this.mouset=100;this.oldclY=this.oldclX=this.clY=this.clX=this.mouset0_copy=this.mousetd=0;this.touchDownFlag=this.touchMoveFlag=this.mouseDnFlag=this.keyDownFlag=this.steering=!1;this.touchClickTime=0;this.blockMouseDown=this.blockMouseUp=this.blockMouseMove=!1;this.mouseClickTime=this.mouseDnTime=0;this.liveFlag=this.blockMouseDblClick=this.blockMouseClick=!1;this.idleFlag=!0;this.liveFlagTotal=this.liveFlagUser=this.controlsProcFlag=this.liveFlagTimer=this.liveFlagAnim=
!1;this.cameraForShadowStep=50;this.shLightD=!1;this.animstop=this.shb=this.sht=this.shr=this.shl=this.Pz=this.Px=this.Lz=this.Lx=this.cameraForShadowZold=this.cameraForShadowXold=0;this.animFlag=!0;this.animStopF=function(){};this.mousetCollisions=0;this.collisionDetectorF=m3d.contr.controlsCollisionDetector;this.collisionR=5;this.controlsUpdateCamera();this.btState={fw:!1,bk:!1,lt:!1,rt:!1,slt:!1,srt:!1};this.btCodesDn={87:function(){contr.btState.fw=!0},38:function(){contr.btState.fw=!0},83:function(){contr.btState.bk=
!0},40:function(){contr.btState.bk=!0},65:function(){contr.btState.lt=!0},37:function(){contr.btState.lt=!0},68:function(){contr.btState.rt=!0},39:function(){contr.btState.rt=!0},81:function(){contr.btState.slt=!0},69:function(){contr.btState.srt=!0}};this.btCodesUp={87:function(){contr.btState.fw=!1},38:function(){contr.btState.fw=!1},83:function(){contr.btState.bk=!1},40:function(){contr.btState.bk=!1},65:function(){contr.btState.lt=!1},37:function(){contr.btState.lt=!1},68:function(){contr.btState.rt=
!1},39:function(){contr.btState.rt=!1},81:function(){contr.btState.slt=!1},69:function(){contr.btState.srt=!1}};this.btFun={fw:m3d.contr.controlsStdBtFunFw,bk:m3d.contr.controlsStdBtFunBk,slt:m3d.contr.controlsStdBtFunSlt,srt:m3d.contr.controlsStdBtFunSrt,lt:m3d.contr.controlsStdBtFunLt,rt:m3d.contr.controlsStdBtFunRt};this.tchState={fw:!1,bk:!1,lt:!1,rt:!1};this.tchBtFun={fw:m3d.contr.controlsStdTchBtFunFw,bk:m3d.contr.controlsStdTchBtFunBk,lt:m3d.contr.controlsStdTchBtFunLt,rt:m3d.contr.controlsStdTchBtFunRt};
this.mouseFun={bup:function(){},bdn:function(){}};this.touchFun={bdn:function(){}};this.userDynamic=function(a){};this.trackUpdate=function(a){};this.trackAnimUpdate=function(a){};this.trackStep=-1;this.trackStepXold=0;this.trackStepYold=-1E5;this.trackStepZold=0;this.trackAnimStep=-1;this.trackAnimStepXold=0;this.trackAnimStepYold=-1E5;this.trackAnimStepZold=0};m3d.contr.controlsStdBtFunFw_xz=function(){contr.z-=contr.speed};m3d.contr.controlsStdBtFunBk_xz=function(){contr.z+=contr.speed};m3d.contr.controlsStdBtFunRt_xz=
function(){contr.x+=contr.speed};m3d.contr.controlsStdBtFunLt_xz=function(){contr.x-=contr.speed};m3d.contr.controlsSet_xz=function(){contr.btFun.fw=m3d.contr.controlsStdBtFunFw_xz;contr.btFun.bk=m3d.contr.controlsStdBtFunBk_xz;contr.btFun.lt=m3d.contr.controlsStdBtFunLt_xz;contr.btFun.rt=m3d.contr.controlsStdBtFunRt_xz};m3d.contr.controlsStdBtFunFw=function(){var a=0-Math.sin(contr.direction)*contr.speed;contr.z+=Math.cos(contr.direction)*contr.speed;contr.x+=a};m3d.contr.controlsStdBtFunBk=function(){var a=
0-Math.sin(contr.direction+Math.PI)*contr.speed;contr.z+=Math.cos(contr.direction+Math.PI)*contr.speed;contr.x+=a};m3d.contr.controlsStdBtFunSlt=function(){var a=contr.direction-Math.PI/2,b=0-Math.sin(a)*contr.speed;contr.z+=Math.cos(a)*contr.speed;contr.x+=b};m3d.contr.controlsStdBtFunSrt=function(){var a=contr.direction-Math.PI/2+Math.PI,b=0-Math.sin(a)*contr.speed;contr.z+=Math.cos(a)*contr.speed;contr.x+=b};m3d.contr.controlsStdBtFunLt=function(){contr.direction-=.05};m3d.contr.controlsStdBtFunRt=
function(){contr.direction+=.05};m3d.contr.controlsStdTchBtFunFw=function(){var a=0-Math.sin(contr.direction)*contr.speed;contr.z+=Math.cos(contr.direction)*contr.speed;contr.x+=a};m3d.contr.controlsStdTchBtFunBk=function(){var a=0-Math.sin(contr.direction+Math.PI)*contr.speed;contr.z+=Math.cos(contr.direction+Math.PI)*contr.speed;contr.x+=a};m3d.contr.controlsStdTchBtFunLt=function(){if(0==contr.steering)contr.direction-=.05;else{var a=contr.direction-Math.PI/2,b=0-Math.sin(a)*contr.speed;contr.z+=
Math.cos(a)*contr.speed;contr.x+=b}};m3d.contr.controlsStdTchBtFunRt=function(){if(0==contr.steering)contr.direction+=.05;else{var a=contr.direction-Math.PI/2+Math.PI,b=0-Math.sin(a)*contr.speed;contr.z+=Math.cos(a)*contr.speed;contr.x+=b}};""==apscene.scene?(m3d.contr.controlsOController.prototype.controlsUpdateCamera=function(){},m3d.contr.renderIntersections=m3d.contr.renderIntersections2D,m3d.contr.controlsCollisionDetector=m3d.contr.controlsCollisionDetector2D,m3d.contr.renderBK=function(){},
m3d.contr.renderAll=function(){},m3d.contr.controlsUpdateCamera2D=function(){}):(m3d.contr.renderIntersections=m3d.contr.renderIntersections3D,m3d.contr.controlsCollisionDetector=m3d.contr.controlsCollisionDetector3D,m3d.contr.controlsOController.prototype.controlsUpdateCamera=function(){var a=this.direction+Math.PI,b=Math.cos(this.angle);this.camera.position.set(-b*Math.sin(a)*this.distancex+this.x,Math.sin(this.angle)*this.distancey+this.y,b*Math.cos(a)*this.distancez+this.z);this.camera.lookAt({x:this.x,
y:this.y,z:this.z});if(1==this.shLightD){a=!1;1==contr.forceUpdateCamera&&(contr.forceUpdateCamera=!1,a=!0);if(Math.abs(apscene.camera.position.x-contr.cameraForShadowXold)>contr.cameraForShadowStep||Math.abs(apscene.camera.position.z-contr.cameraForShadowZold)>contr.cameraForShadowStep)a=!0,this.userDynamic();0<this.trackStep&&(Math.abs(apscene.camera.position.x-contr.trackStepXold)>contr.trackStep||Math.abs(apscene.camera.position.y-contr.trackStepYold)>contr.trackStep||Math.abs(apscene.camera.position.z-
contr.trackStepZold)>contr.trackStep)&&(contr.trackStepXold=apscene.camera.position.x,contr.trackStepYold=apscene.camera.position.y,contr.trackStepZold=apscene.camera.position.z,m3d.graph.trackUpdate());0<this.trackAnimStep&&(Math.abs(apscene.camera.position.x-contr.trackAnimStepXold)>contr.trackAnimStep||Math.abs(apscene.camera.position.y-contr.trackAnimStepYold)>contr.trackAnimStep||Math.abs(apscene.camera.position.z-contr.trackAnimStepZold)>contr.trackAnimStep)&&(contr.trackAnimStepXold=apscene.camera.position.x,
contr.trackAnimStepYold=apscene.camera.position.y,contr.trackAnimStepZold=apscene.camera.position.z,m3d.graph.trackAnimUpdate());if(1==a&&1==this.fshadows){contr.cameraForShadowXold=apscene.camera.position.x;contr.cameraForShadowZold=apscene.camera.position.z;if(0==contr.daytime)apscene.dirLight.shadowCamera.far=0;else{apscene.dirLightTarget.position.set(this.camera.position.x,this.camera.position.y,this.camera.position.z);apscene.dirLight.target=apscene.dirLightTarget;var a=Math.abs(apscene.camera.position.x-
apscene.dirLight.shadowCamera.position.x),b=Math.abs(apscene.camera.position.y-apscene.dirLight.shadowCamera.position.y),c=Math.abs(apscene.camera.position.z-apscene.dirLight.shadowCamera.position.z),a=Math.sqrt(a*a+c*c+b*b);apscene.dirLight.shadowCamera.far=a+500;apscene.dirLight.shadowCamera.near=a-15500;apscene.dirLight.shadowCameraLeft=contr.shl;apscene.dirLight.shadowCameraRight=contr.shr;apscene.dirLight.shadowCameraTop=contr.sht;apscene.dirLight.shadowCameraBottom=contr.shb;apscene.dirLight.shadowCamera.left=
apscene.dirLight.shadowCameraLeft;apscene.dirLight.shadowCamera.right=apscene.dirLight.shadowCameraRight;apscene.dirLight.shadowCamera.top=apscene.dirLight.shadowCameraTop;apscene.dirLight.shadowCamera.bottom=apscene.dirLight.shadowCameraBottom}apscene.dirLight.shadowCamera.updateProjectionMatrix()}}this.camera.updateProjectionMatrix();m3d.contr.renderBK()},m3d.contr.renderBK=function(){apscene.camerab.updateProjectionMatrix()},m3d.contr.renderAll=function(){apscene.renderer.render(apscene.scene,
apscene.camera)})},renderAll2D:function(){},controlsCollisionF:function(){contr.btState.bk=!1;contr.btState.fw=!1;m3d.contr.controlsCheckBt();contr.tchState.bk=!1;contr.tchState.fw=!1;m3d.contr.controlsCheckTouch();contr.z=contr.z0;contr.x=contr.x0;contr.z1=contr.z0;contr.x1=contr.x0;contr.mousetCollisions=contr.mouset},controlsSetAngle:function(a){contr.angle+=.004*a;contr.angle>contr.maxAngle?contr.angle=contr.maxAngle:contr.angle<contr.minAngle&&(contr.angle=contr.minAngle)},controlsSetAngleDynamic:function(a,
b){contr.angle+=.004*a*(b*contr.angle/(contr.maxAngle-contr.minAngle)+2);contr.angle>contr.maxAngle?contr.angle=contr.maxAngle:contr.angle<contr.minAngle&&(contr.angle=contr.minAngle)},controlsSetMouse:function(){1==contr.mouseDnFlag&&(contr.mouseXRel=contr.clX-contr.oldclX,contr.mouseYRel=contr.clY-contr.oldclY,contr.oldclX=contr.clX,contr.oldclY=contr.clY,m3d.contr.controlsSetAngle(contr.mouseYRel),contr.direction+=.01*contr.mouseXRel)},controlsSetKeys:function(){for(var a in contr.btState)if(1==
contr.btState[a])contr.btFun[a]()},controlsSetTouch:function(){for(var a in contr.tchState)if(1==contr.tchState[a])contr.tchBtFun[a]()},controlsSetTouchMove:function(){1==contr.touchMoveFlag&&(contr.mouseXRel=contr.clX-contr.oldclX,contr.mouseYRel=contr.clY-contr.oldclY,contr.oldclX=contr.clX,contr.oldclY=contr.clY,contr.angle+=.009*contr.mouseYRel,contr.angle>contr.maxAngle?contr.angle=contr.maxAngle:contr.angle<contr.minAngle&&(contr.angle=contr.minAngle),contr.direction+=.01*contr.mouseXRel)},
constrolsTouchStart:function(a){contr.touchClickTime=Date.now();for(var b=m3dcache.setup.aspect.scale,c=0,d=0,f=0,e="",g=0,h=!1,m=0;m<a.touches.length;m++)c=a.touches[m].pageX/b,d=a.touches[m].pageY/b,f=m3d.contr.getMouseObjTouch(c,d),-1!=f?"undefined"!==typeof m3d.ui.pCl[f]?(e=mn[m3d.ui.pCl[f][5]],1==m3d.ui.pCl[f][9]&&(e.touch1[m3d.ui.pCl[f][6]-2](f),contr.touchDownFlag=!0),1==e.slide&&(e.slided.x1=c,e.slided.y1=d),mnButtonOver=-1):(h=!0,g=m):(h=!0,g=m);1==h&&0==contr.touchMoveFlag&&(contr.clX=a.touches[g].pageX/
b,contr.clY=a.touches[g].pageY/b,contr.oldclX=a.touches[g].pageX/b,contr.oldclY=a.touches[g].pageY/b,contr.touchMoveFlag=!0);0==contr.controlsProcFlag&&apcontrolsRenderStart()},constrolsTouchMove:function(a){contr.blockMouseClick=!0;var b=m3dcache.setup.aspect.scale,c=-1,d=-1,f=-1;clObj=0;for(var e=a.touches.length-1;-1<e;e--)clObj=m3d.contr.getMouseObjTouch(a.touches[e].pageX,a.touches[e].pageY),-1==clObj?c=e:(d=e,f=clObj);0==contr.touchMoveFlag&&(contr.touchMoveFlag=!0);-1!=c&&(contr.oldclX=contr.clX,
contr.oldclY=contr.clY,contr.clX=a.touches[c].pageX/b,contr.clY=a.touches[c].pageY/b,contr.touchFun.bdn());-1!=d&&"undefined"!==typeof m3d.ui.pCl[f]&&(c=mn[m3d.ui.pCl[f][5]],1==c.slide&&(c.slided.x2=a.touches[d].pageX/b,c.slided.y2=a.touches[d].pageY/b,c.cb[0](f)),mnButtonOver=-1);0==contr.controlsProcFlag&&apcontrolsRenderStart()},constrolsTouchEnd:function(a){a.preventDefault();var b=m3dcache.setup.aspect.scale;contr.blockMouseUp=!0;contr.blockMouseDown=!0;contr.blockMouseMove=!0;contr.blockMouseDblClick=
!0;for(var c=0,d=0,c=0,f=-1,d="",e=!1,g=0;g<a.changedTouches.length;g++)c=a.changedTouches[g].pageX/b,d=a.changedTouches[g].pageY/b,c=m3d.contr.getMouseObjTouch(c,d),-1!=c?"undefined"!==typeof m3d.ui.pCl[c]?(1==m3d.ui.pCl[c][9]?(m3d.lib.statLog("touch end multitouch"),d=mn[m3d.ui.pCl[c][5]],contr.controlsUpdateCamera(),d.touch2[m3d.ui.pCl[c][6]-2](c)):(m3d.lib.statLog("touch end non-multitouch"),f=c),mnButtonOver=-1):e=!0:e=!0;1==e&&(contr.touchMoveFlag=!1,m3d.lib.statLog("touch stop move"));0==a.touches.length&&
(contr.touchDownFlag=!1,contr.touchMoveFlag=!1,m3d.contr.controlsTouchButtonsOff());m3d.contr.controlsCheckTouch();200>Date.now()-contr.touchClickTime?(m3d.lib.statLog("touch tap"),m3d.contr.renderIntersections(),m3d.contr.controlsMouseClickProc(f)):(m3d.lib.statLog("touch tap long"),m3d.contr.controlsMouseClickProcLong(f))},controlsCheckTouch:function(){contr.touchDownFlag=0==contr.tchState.fw&0==contr.tchState.bk&0==contr.tchState.lt&0==contr.tchState.rt?!1:!0},controlsTouchButtonsOff:function(){contr.touchDownFlag=
!1;contr.mouseDnFlag=!1;contr.tchState.fw=!1;contr.tchState.bk=!1;contr.tchState.lt=!1;contr.tchState.rt=!1;m3d.lib.statLog("touch all bt off")},controlsAllButtonsOff:function(){if("undefined"!==typeof contr){m3d.contr.controlsTouchButtonsOff();for(var a in contr.btState)contr.btState[a]=!1;contr.keyDownFlag=!1;m3d.lib.statLog("window blur")}},controlsKeyDn:function(a){switch(a.keyCode){default:if(a.keyCode in contr.btCodesDn)contr.btCodesDn[a.keyCode]()}contr.keyDownFlag=!0;apcontrolsRenderStart()},
controlsKeyUp:function(a){switch(a.keyCode){case 16:contr.btShift=!1;case 17:contr.btCtrl=!1;default:if(a.keyCode in contr.btCodesUp)contr.btCodesUp[a.keyCode]()}m3d.contr.controlsCheckBt();apcontrolsRenderStart()},controlsCheckBt:function(){var a=!1,b;for(b in contr.btState)1==contr.btState[b]&&(a=!0);contr.keyDownFlag=0==a?!1:!0},getMouseObj:function(a,b,c){a+=m3dcache.v.vclipwsc;b+=m3dcache.v.vcliphsc;for(var d=-1,f,e,g,h,m,q,n,l,p,r=0;r<m3d.ui.pCl.length;r++)if(""==mn[m3d.ui.pCl[r][5]].container&&
(mn[m3d.ui.pCl[r][5]].container=elcanv),mn[m3d.ui.pCl[r][5]].container==c){var t=c.getBoundingClientRect();g=m3d.ui.pCl[r][0]+t.left+m3dcache.v.vclipw;h=m3d.ui.pCl[r][1]+t.top+m3dcache.v.vcliph;m=m3d.ui.pCl[r][2]+t.left+m3dcache.v.vclipw;q=m3d.ui.pCl[r][3]+t.top+m3dcache.v.vcliph;if(a>g&b>h&a<m&b<q&1==m3d.ui.pCl[r][4])if(0<m3d.ui.pCl[r][10].length)for(var u=0;u<m3d.ui.pCl[r][10].length;u++)if("tri"==m3d.ui.pCl[r][10][u].t){if(f=a-t.left,e=b-t.top,g=m3d.ui.pCl[r][10][u].d[0],h=m3d.ui.pCl[r][10][u].d[1],
m=m3d.ui.pCl[r][10][u].d[2],q=m3d.ui.pCl[r][10][u].d[3],n=m3d.ui.pCl[r][10][u].d[4],l=m3d.ui.pCl[r][10][u].d[5],p=(g-f)*(q-h)-(m-g)*(h-e),m=(m-f)*(l-q)-(n-m)*(q-e),e=(n-f)*(h-l)-(g-n)*(l-e),0<=p&&0<=m&&0<=e||0>=p&&0>=m&&0>=e)d=r}else"circ"==m3d.ui.pCl[r][10][u].t&&(f=a-t.left,e=b-t.top,g=m3d.ui.pCl[r][10][u].d[0],h=m3d.ui.pCl[r][10][u].d[1],p=m3d.ui.pCl[r][10][u].d[2],f-=g,e-=h,f*f+e*e<=p&&(d=r));else d=r}return d},getMouseObjTouch:function(a,b){for(var c=-1,d,f,e,g,h,m,q,n,l,p=0;p<m3d.ui.pCl.length;p++){""==
mn[m3d.ui.pCl[p][5]].container&&(mn[m3d.ui.pCl[p][5]].container=elcanv);var r=mn[m3d.ui.pCl[p][5]].container.getBoundingClientRect();e=m3d.ui.pCl[p][0]+r.left;g=m3d.ui.pCl[p][1]+r.top;h=m3d.ui.pCl[p][2]+r.left;m=m3d.ui.pCl[p][3]+r.top;if(a>e&b>g&a<h&b<m&1==m3d.ui.pCl[p][4])if(0<m3d.ui.pCl[p][10].length)for(var t=0;t<m3d.ui.pCl[p][10].length;t++)if("tri"==m3d.ui.pCl[p][10][t].t){if(d=a-r.left,f=b-r.top,e=m3d.ui.pCl[p][10][t].d[0],g=m3d.ui.pCl[p][10][t].d[1],h=m3d.ui.pCl[p][10][t].d[2],m=m3d.ui.pCl[p][10][t].d[3],
q=m3d.ui.pCl[p][10][t].d[4],n=m3d.ui.pCl[p][10][t].d[5],l=(e-d)*(m-g)-(h-e)*(g-f),h=(h-d)*(n-m)-(q-h)*(m-f),f=(q-d)*(g-n)-(e-q)*(n-f),0<=l&&0<=h&&0<=f||0>=l&&0>=h&&0>=f)c=p}else"circ"==m3d.ui.pCl[p][10][t].t&&(d=a-r.left,f=b-r.top,e=m3d.ui.pCl[p][10][t].d[0],g=m3d.ui.pCl[p][10][t].d[1],l=m3d.ui.pCl[p][10][t].d[2],d-=e,f-=g,d*d+f*f<=l&&(c=p));else c=p}return c},controlsMouseMove:function(a,b,c){if(1==contr.blockMouseMove)contr.blockMouseMove=!1;else if(0==contr.touchMoveFlag&&1==m3dcache.v.mouse){var d=
m3dcache.setup.aspect.scale;b=a.clientX/d;d=a.clientY/d;0==contr.controlsProcFlag&&m3d.contr.renderIntersections();a=m3d.contr.getMouseObj(b,d,c);0==contr.mouseDnFlag?(-1==a&&(contr.clX=b,contr.clY=d,contr.mouseFun.bup()),mnButtonOver!=a&&(b=mnButtonOver,mnButtonOver=a,-1!=b&&m3d.contr.closeObj0(b,c),-1!=a&&m3d.contr.openObj0(a,c))):-1==a?(contr.clX=b,contr.clY=d,contr.blockMouseClick=!0,contr.mouseFun.bdn()):"undefined"!==typeof m3d.ui.pCl[a]&&(c=mn[m3d.ui.pCl[a][5]],1==c.slide&&(c.slided.x2=b,c.slided.y2=
d,c.cb[0](a)),mnButtonOver=-1)}},controlsMouseDownFix:function(){m3d.contr.controlsMouseDown({clientX:m3dcache.v.vw2,clientY:m3dcache.v.vh2})},controlsMouseDown:function(a,b,c){if(1==contr.blockMouseDown)contr.blockMouseDown=!1;else{var d=m3dcache.setup.aspect.scale;contr.oldclX=contr.clX;contr.oldclY=contr.clY;contr.mouseDnFlag=!0;m3d.lib.statLog("mouse down");b=a.clientX/d;a=a.clientY/d;c=m3d.contr.getMouseObj(b,a,c);-1!=c&&"undefined"!==typeof m3d.ui.pCl[c]&&(d=mn[m3d.ui.pCl[c][5]],1==d.multitouch&&
(d.touch1[m3d.ui.pCl[c][6]-2](c),contr.touchDownFlag=!0),1==d.slide&&(d.slided.x1=b,d.slided.y1=a),mnButtonOver=-1);contr.mouseDnTime=Date.now();apcontrolsRenderStart()}},controlsMouseUp:function(a,b,c){contr.mouseClickTime=Date.now()-contr.mouseDnTime;if(1==contr.blockMouseUp)contr.blockMouseUp=!1;else if(0==contr.touchMoveFlag){var d=m3dcache.setup.aspect.scale;contr.mouseDnFlag=!1;m3d.lib.statLog("mouse up");d=m3d.contr.getMouseObj(a.clientX/d,a.clientY/d,c);if(-1!=d&&"undefined"!==typeof m3d.ui.pCl[d]){var f=
mn[m3d.ui.pCl[d][5]];if(1==f.multitouch)f.touch2[m3d.ui.pCl[d][6]-2](d);mnButtonOver=-1}m3d.contr.controlsTouchButtonsOff();m3d.contr.controlsMouseClick(a,b,c);apcontrolsRenderStart()}},controlsMouseClick:function(a,b,c){300>contr.mouseClickTime&&(contr.blockMouseClick=!1);if(1==contr.blockMouseClick)contr.blockMouseClick=!1;else if(0==contr.touchMoveFlag&&(m3d.lib.statLog("click?"),1==m3dcache.v.mouse)){var d=m3dcache.setup.aspect.scale;b=a.clientX/d;a=a.clientY/d;c=m3d.contr.getMouseObj(b,a,c);
contr.oldclX=b;contr.oldclY=a;contr.clX=b;contr.clY=a;300>contr.mouseClickTime?m3d.contr.controlsMouseClickProc(c):m3d.contr.controlsMouseClickProcLong(c)}},controlsMouseClickProc:function(a){-1!=a?("undefined"!==typeof m3d.ui.pCl[a]&&0==mn[m3d.ui.pCl[a][5]].multitouch&&(m3d.lib.statLog("click proc"),m3d.ui.refBt(a,1,1,!0,!1),m3d.ui.pCl[a][7](a)),mnButtonOver=-1,elcanv.style.cursor="default"):m3d.contr.controlsMouseClickTapProc()},controlsMouseClickProcLong:function(a){-1!=a&&""!=mn[m3d.ui.pCl[a][5]].cblong&&
mn[m3d.ui.pCl[a][5]].cblong(m3d.ui.pCl[a][6]-1)},controlsMouseClickTapProc:function(){if(""!=apscene.scene&&(m3dcache.d.loc.curInt="",""!=apscene.INTERSECTED)){var a=apscene.INTERSECTED.id,b=apscene.INTERSECTED.intGroup;if("undefined"!=typeof m3dcache.d.loc.objInters[b][a]){var c=m3dcache.d.loc.objInters[b][a];if("menu"==c)if(a=m3dcache.d.loc.menu3dIds[a],b=ap.locd.menu3d[a][10],"goto"==b)a=ap.locd.menu3d[a][9],m3d.graph.navigateCam([[apscene.camera.position.x,apscene.camera.position.z,0],[a[0],a[2],
0]],20,15,function(){apscene.player.position.set(apscene.camera.position.x,apscene.camera.position.y,apscene.camera.position.z);contr.x=apscene.camera.position.x;contr.y=apscene.camera.position.y;contr.z=apscene.camera.position.z;contr.controlsUpdateCamera();m3d.contr.renderAll()});else{if("take"==b)ap.locd.menu3d[a][11]()}else"menu_sub1"==c?(a=m3dcache.d.loc.menu3dIds[a],b=ap.locd.menu3d[a][10],ap.controlsMouseClickTapProcSub1MyLocation(b)):(elcanv.style.cursor="default",ap.controlsClickObjMyLocation(m3dcache.d.loc.objInters2[b][a],
m3dcache.d.loc.objIntersDataId[0][a]))}}},setAnim:function(a){a*=1E3;contr.mouset=Date.now();contr.animstop=contr.mouset+a;contr.animFlag=!0},updateWorldObj:function(){},controlsClickObjHome:function(a,b){},controlsMouseDblClick:function(a){a.preventDefault();1==contr.blockMouseDblClick?contr.blockMouseDblClick=!1:m3d.lib.statLog("double click")},renderIntersections:function(){},renderIntersections2D:function(){},renderIntersections3D:function(){if(100<contr.mouset-contr.intersTm){contr.intersTm=
contr.mouset;var a=new THREE.Vector3(contr.clX,contr.clY,1);apscene.camera instanceof THREE.OrthographicCamera?(a.set(contr.clX/m3dcache.v.vw*2-1,2*-(contr.clY/m3dcache.v.vh)+1,-1),a.unproject(apscene.camera),dir.set(0,0,-1).transformDirection(apscene.camera.matrixWorld),apscene.raycaster.set(a,dir)):apscene.camera instanceof THREE.PerspectiveCamera&&(a.set(contr.clX/m3dcache.v.vw*2-1,2*-(contr.clY/m3dcache.v.vh)+1,.5),a.unproject(apscene.camera),apscene.raycaster.set(apscene.camera.position,a.sub(apscene.camera.position).normalize()));
for(var b=a="",c=-1,d=0;d<m3dcache.d.intersObjects.length;d++)a=apscene.raycaster.intersectObjects(m3dcache.d.intersObjects[d],!0),0<a.length&&a[0].distance<ap.locd.intsdistance&&(c=d,b=a[0].object);-1<c?apscene.INTERSECTED!=b&&(apscene.INTERSECTED=b,apscene.INTERSECTED.intGroup=c,mn.info.on=!0,m3d.core.mnInfoUpdate(c,apscene.INTERSECTED.id)):(apscene.INTERSECTED="",apscene.INTERSECTED.intGroup=-1,m3d.core.mnInfoHide())}},controlsCollisionDetectorSkip:function(){return[!1,[]]},controlsCollisionDetector:function(){},
controlsCollisionDetector2D:function(){},controlsCollisionDetector3D:function(){var a=!1,b=[],a=[!1,[]];if(10<contr.mouset-contr.collTm){contr.collTm=contr.mouset;for(var c=apscene.player.position.clone(),d=0;d<apscene.player.geometry.vertices.length;d++){var f=apscene.player.geometry.vertices[d].clone().applyMatrix4(apscene.player.matrix).sub(apscene.player.position),b=(new THREE.Raycaster(c,f.clone().normalize())).intersectObjects(m3dcache.d.collidableMeshList);0<b.length&&b[0].distance<f.length()+
contr.collisionR&&(a=!0,a=[a,b])}}return a},constrolsPointerDown:function(a){m3d.lib.statLog("pointer down")},openObj0:function(a,b){b.style.cursor="pointer";m3d.ui.refBt(a,2,1,!0,!1)},closeObj0:function(a,b){b.style.cursor="default";m3d.ui.pCl.length>a&&0==mn[m3d.ui.pCl[a][5]].block&&("undefined"!==typeof mn[m3d.ui.pCl[a][5]].hilightoff&&mn[m3d.ui.pCl[a][5]].hilightoff(),1==m3d.ui.pCl[a][8]&""==mn[m3d.ui.pCl[a][5]].hilight||(1==m3d.ui.pCl[a][4]?m3d.ui.refBt(a,1,1,!0,!1):m3d.ui.refBt(a,m3d.ui.pCl[a][4],
m3d.ui.pCl[a][4],!0,!1)))}},uf:{exitMenu:function(){},exitGame:function(){},mnMainExitVarOpenUser:function(){},mnMainExitVarCloseUser:function(){}}};
function apcontrolsRenderStart(){contr.liveFlagTotal=!1;contr.liveFlagUser=!1;if(1==contr.keyDownFlag||1==contr.mouseDnFlag||1==contr.touchMoveFlag||1==contr.touchDownFlag)contr.liveFlagTotal=!0,contr.liveFlagUser=!0;contr.renderSoft=!1;0==m3d.lib.globalTimerSoft.mode?contr.liveFlagTimer=!1:(contr.liveFlagTotal=!0,contr.liveFlagTimer=!0,0==contr.liveFlagUser&0==contr.liveFlagAnim&0==contr.animFlag?(0==contr.renderSoft&&contr.contrLiveFalse(),contr.renderSoft=!0):contr.renderSoft=!1);1==contr.liveFlagUser||
1==contr.liveFlagAnim||1==contr.liveFlagTimer||1==contr.animFlag?(contr.liveFlagTotal=!0,0==contr.controlsProcFlag&&0==contr.liveFlag&&(contr.liveFlag=!0,contr.mouset=Date.now(),contr.mouset0=contr.mouset,contr.mousetd=0,contr.mouset0_copy=contr.mouset0,contr.mouset0=contr.mouset,0==contr.renderSoft?apcontrolsRender():apcontrolsRenderSoft(!0))):0==contr.controlsProcFlag?contr.liveFlag=!1:contr.liveFlagTotal=!1}
function apcontrolsRenderSoft(a){contr.controlsProcFlag=!0;m3d.lib.globalTimerSoft.update();1==m3d.lib.anim.playing&&m3d.lib.anim.playF();1==contr.controlsMode&&1==a&&m3d.contr.renderAll();requestNextAnimationFrame(apcontrolsRenderBack)}
function apcontrolsRender(){contr.animstop<contr.mouset&&1==contr.animFlag&&(contr.animFlag=!1,contr.animStopF("tm"));contr.controlsProcFlag=!0;1==contr.touchMoveFlag?0!=m3dcache.v.mouse&&m3d.contr.controlsSetTouchMove():1==contr.mouseDnFlag&&m3d.contr.controlsSetMouse();1==contr.keyDownFlag&&0!=m3dcache.v.mouse&&m3d.contr.controlsSetKeys();1==contr.touchDownFlag&&0!=m3dcache.v.mouse&&m3d.contr.controlsSetTouch();var a=contr.collisionDetectorF();1==a[0]?m3d.contr.controlsCollisionF(a[1]):200<contr.mouset-
contr.mousetCollisions&&(contr.z0=contr.z1,contr.x0=contr.x1,contr.z1=contr.z,contr.x1=contr.x,contr.mousetCollisions=contr.mouset);1==m3d.lib.anim.playing&&m3d.lib.anim.playF();0==contr.controlsMode?requestNextAnimationFrame(apcontrolsRenderBack):1==contr.controlsMode?(apscene.player.position.set(apscene.camera.position.x,apscene.camera.position.y-11,apscene.camera.position.z),apscene.player.rotation.set(apscene.camera.rotation.x,apscene.camera.rotation.y,apscene.camera.rotation.z),0!=curDistrict&&
m3d.core.checkEdges(apscene.camera.position.x,apscene.camera.position.z),1==m3d.lib.globalTimerSoft.on&&m3d.lib.globalTimerSoft.update(),m3d.contr.updateWorldObj(),contr.controlsUpdateCamera(),m3d.contr.renderAll(),requestNextAnimationFrame(apcontrolsRenderBack)):2==contr.controlsMode?m3d.core.mnTeleportMapMove():3==contr.controlsMode?(m3d.contr.updateWorldObj(),m3d.contr.renderAll(),requestNextAnimationFrame(apcontrolsRenderBack)):4==contr.controlsMode&&(m3d.contr.renderAll2D(),requestNextAnimationFrame(apcontrolsRenderBack2D))}
function apcontrolsRenderBackAnim(){}
function apcontrolsRenderBack(){contr.mouset=Date.now();contr.mousetd=contr.mouset-contr.mouset0;contr.mouset0_copy=contr.mouset0;contr.mouset0=contr.mouset;var a=contr.mousetd_frame-contr.mousetd;0>a&&(a=0);var b=!1;1==m3d.lib.anim.playing?b=!0:1==contr.renderSoft&&(a=m3d.lib.globalTimerSoft.interval-(contr.mouset-m3d.lib.globalTimerSoft.t0)-a,0>a&&(a=0),0<a?b=!0:a=100,contr.mouset0=0,contr.mouset0_copy=contr.mouset0);setTimeout(function(){contr.controlsProcFlag=!1;1==contr.liveFlagTotal?0==contr.renderSoft?
apcontrolsRender():apcontrolsRenderSoft(b):0==contr.controlsProcFlag&&(contr.contrStop(),0==contr.idleFlag&&(contr.contrLiveFalse(),contr.idleFlag=!0),contr.liveFlag=!1,contr.liveFlagUser=!1)},a)}
function apcontrolsRenderBack2D(){if(0<m3dcache.v.mouse){contr.mouset=Date.now();contr.mousetd=contr.mouset-contr.mouset0;contr.mouset0_copy=contr.mouset0;contr.mouset0=contr.mouset;var a=contr.mousetd_frame-contr.mousetd;0>a&&(a=0);setTimeout(function(){contr.controlsProcFlag=!1;1==m3d.lib.anim.playing&&(contr.liveFlagTotal=!0);1==contr.liveFlagTotal?0==contr.renderSoft?apcontrolsRender():apcontrolsRenderSoft(renderScreen):0==contr.controlsProcFlag&&(contr.contrStop(),0==contr.idleFlag&&(contr.contrLiveFalse(),
contr.idleFlag=!0),contr.liveFlag=!1,contr.liveFlagUser=!1)},a)}else contr.idleFlag=!0,contr.liveFlag=!0,contr.controlsProcFlag=!1,contr.mouset0=0}
window.requestNextAnimationFrame=function(){var a=void 0,b=void 0,c=0,c=navigator.userAgent,d=0,f=this;window.webkitRequestAnimationFrame&&(b=function(a){void 0===a&&(a=+new Date);f.callback(a)},a=window.webkitRequestAnimationFrame,window.webkitRequestAnimationFrame=function(c,d){f.callback=c;a(b,d)});window.mozRequestAnimationFrame&&(d=c.indexOf("rv:"),-1!=c.indexOf("Gecko")&&(c=c.substr(d+3,3),"2.0"===c&&(window.mozRequestAnimationFrame=void 0)));return window.requestAnimationFrame||window.webkitRequestAnimationFrame||
window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){var c,d;window.setTimeout(function(){c=Date.now();a(c);d=Date.now();f.timeout=1E3/60-(d-c)},f.timeout)}}();var disposeDebugging=!1,disposeIndent="",disposeIndentLevel=0;apscene={camera:"",scene:"",renderer:"",stats:"",raycaster:"",rendererCSS:"",cssScene:""};k=10;function audioSpeak(){}m3dcache.i.parseConfig();
